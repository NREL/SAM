
\documentclass[report]{nrel}

\title{Errata for SAM Photovoltaic Model Technical Reference}
\author{P. Gilman}


\usepackage{array}

% -----------------------------------
\begin{document}

This document lists errors with corrections for the SAM photovoltaic reference manual available from the link at the bottom of this page or from the Performance Model Documentation page on the SAM website.

Gilman, P.; (2015) ``SAM Photovoltaic Model Technical Reference." TP-6A20-64102. Golden, CO: National Renewable Energy Laboratory.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Chapter 3: Irradiance and Weather Data}

In \textbf{Table 2 Weather Data} and \textbf{Table 3 Sun Position Variable Definitions}, the time zone and longitude should be degrees East of GMT and $0^\circ$ rather than West.

Also, the range of values for time zone is $-12 < \mathit{tz} < 12$, for longitude is $-180^\circ < \mathit{lon} < 180^\circ$, and for latitude is $ 0^\circ < \mathit{lat} < 90^\circ$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Section 4.2: Sun Angles}

In \textbf{Equation 4.18}, the final condition should be $a<-1$ instead of $a<1$.

Correct:
\begin{align*}
a &= \sin\delta \sin\left(\frac{\pi}{180}\mathit{lat}\right) + \cos\delta \cos\left(\frac{\pi}{180}\mathit{lat}\right) \cos\mathit{HA}\notag\\
\alpha_0 &=\left\{
  \begin{array}{ll}
    \arcsin a & \text{if $-1 \leq a \leq 1$}\\
    \frac{\pi}{2} & \text{if $a>1$}\\
    -\frac{\pi}{2} & \text{if $a<-1$}
  \end{array}
\right.
\end{align*}

Incorrect:
\begin{align*}
a &= \sin\delta \sin\left(\frac{\pi}{180}\mathit{lat}\right) + \cos\delta \cos\left(\frac{\pi}{180}\mathit{lat}\right) \cos\mathit{HA}\notag\\
\alpha_0 &=\left\{
  \begin{array}{ll}
    \arcsin a & \text{if $-1 \leq a \leq 1$}\\
    \frac{\pi}{2} & \text{if $a>1$}\\
    -\frac{\pi}{2} & \text{if $a<1$}
  \end{array}
\right.
\end{align*}

In \textbf{Equation 4.19} for the sun altitude angle corrected for refraction, the equation for refraction $r$ for the case $\alpha_{0d} > -0.56$ is incorrect.

Correct:
\begin{align*}\label{eqn-elvcorr}
\alpha_{0d} &= \frac{180}{\pi}\alpha_0\notag\\
r &= \left\{
\begin{array}{ll}
3.51561\left(0.1594 + 0.0196\alpha_{0d} + 0.00002\alpha_{0d}^2\right) \left(1 + 0.505\alpha_{0d} + 0.0845\alpha_{0d}^2\right)^{-1} & \text{if $\alpha_{0d}>-0.56$}\\
0.56 & \text{if $\alpha_{0d} \leq -0.56$}
\end{array}
\right.\notag\\
\alpha & = \left\{
\begin{array}{ll}
\frac{\pi}{2} & \text{if $\alpha_{0d} + r > 90$}\\
\frac{\pi}{180}\left(\alpha_{0d} + r\right) & \text{if $\alpha_{0d} + r \leq 90$}
\end{array}
\right.
\end{align*}

Incorrect:
\begin{align*}
\alpha_{0d} &= \frac{180}{\pi}\alpha_0\notag\\
r &= \left\{
\begin{array}{ll}
\alpha_{0d} + 3.51561\left(\frac{0.1594 + 0.0196\alpha_{0d} + 0.00002\alpha_{0d}^2}{1 + 0.505\alpha_{0d} + 0.0845\alpha_{0d}^2}\right) & \text{if $\alpha_{0d}>-0.56$}\\
0.56 & \text{if $\alpha_{0d} \leq -0.56$}
\end{array}
\right.\notag\\
\alpha & = \left\{
\begin{array}{ll}
\frac{\pi}{2} & \text{if $\alpha_{0d} + r > 90$}\\
\frac{\pi}{180}\left(\alpha_{0d} + r\right) & \text{if $\alpha_{0d} + r \leq 90$}
\end{array}
\right.
\end{align*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Section 4.3: Sunrise and Sunset Hours}

In \textbf{Equation 4.23} for the equation of time in hours, the equation for $a$ uses $\frac{\pi}{180}$ instead of $\frac{180}{\pi}$.

Correct:
\begin{align*}
a &= \frac{1}{15}\left(\mathit{mnlong} - \frac{180}{\pi}\mathit{ra}\right)\notag\\
\mathit{EOT} &= 
\left\{
   \begin{array}{ll}
     a & \text{if $-0.33 \leq a \leq 0.33$}\\
     a + 24 & \text{if $a<-0.33$}\\
     a - 24 & \text{if $a>0.33$}
   \end{array}
\right. 
\end{align*}

Incorrect:
\begin{align*}
a &= \frac{1}{15}\left(\mathit{mnlong} - \frac{\pi}{180}\mathit{ra}\right)\notag\\
\mathit{EOT} &= 
\left\{
   \begin{array}{ll}
     a & \text{if $-0.33 \leq a \leq 0.33$}\\
     a + 24 & \text{if $a<-0.33$}\\
     a - 24 & \text{if $a>0.33$}
   \end{array}
\right. 
\end{align*}

\textbf{Equation 4.24} and \textbf{Equation 4.25} use the undefined variable $\lambda$ for the longitude instead of $lon$.

Correct:
\begin{equation*}
t_{sunrise} = 12 - \frac{1}{15} \frac{180}{\pi}\mathit{HAR} - \left(\frac{\mathit{lon}}{15} - \mathit{tz}\right)-\mathit{EOT}
\end{equation*}

\begin{equation*}
t_{sunrise} = 12 + \frac{1}{15} \frac{180}{\pi}\mathit{HAR} - \left(\frac{\mathit{lon}}{15} - \mathit{tz}\right)-\mathit{EOT}
\end{equation*}

Incorrect:
\begin{equation*}
t_{sunrise} = 12 - \frac{1}{15} \frac{180}{\pi}\mathit{HAR} - \left(\frac{\lambda}{15} - \mathit{tz}\right)-\mathit{EOT}
\end{equation*}

\begin{equation*}
t_{sunrise} = 12 + \frac{1}{15} \frac{180}{\pi}\mathit{HAR} - \left(\frac{\lambda}{15} - \mathit{tz}\right)-\mathit{EOT}
\end{equation*}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Section 6.2.2 HDKR Model}

In \textbf{Equation 6.11}, the equation for the isotropic component incorrectly uses the angle of incidence $\mathit{AOI}$ instead of the subarray tilt angle $\beta_s$.

Correct:
\begin{align*}
\mathit{cir} &= E_d A_i R_b \notag\\
\mathit{iso} &= E_d \left( 1 - A_i \right) \frac{1 + \cos\ \beta_s}{2} \notag\\
\mathit{isohor} &= \mathit{iso} \left( 1 + f s \right)
\end{align*}

Incorrect:
\begin{align*}
\mathit{cir} &= E_d A_i R_b \notag\\
\mathit{iso} &= E_d \left( 1 - A_i \right) \frac{1 + \cos\mathit{AOI}}{2} \notag\\
\mathit{isohor} &= \mathit{iso} \left( 1 + f s \right)
\end{align*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Section 6.2.3 Perez 1990 Model}

\textbf{Equation 6.14} for the $a$ and $b$ parameters in the Perez 1990 sky diffuse irradiance model uses the angle of incidence $AOI$ instead of the sun zenith angle $Z$.

Correct:
\begin{align*}
a &= \max( 0, \cos \mathit{AOI} ) \notag\\
b & =\max( \cos85\degree, \cos Z) 
\end{align*}

Incorrect:
\begin{align*}
a &= \max( 0, \cos \mathit{AOI} ) \notag\\
b & =\max( \cos85\degree, \cos \mathit{AOI}) 
\end{align*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Section 8.3 Sky Diffuse POA Irradiance Reduction}

Parentheses are missing from \textbf{Equation 8.9} for the reduction in sky diffuse POA irradiance, which is part of the self-shading algorithm.

Correct:
\begin{equation*}
G_{sky,\text{red}} = G_d - G_{dh}\left(1 - \cos^2\frac{\psi}{2}\right)\frac{N_{rows} - 1}{N_{rows}}
\end{equation*}

Incorrect:
\begin{equation*}
G_{sky,\text{red}} = G_d - G_{dh}~ 1 - \cos^2\frac{\psi}{2}~ \frac{N_{rows} - 1}{N_{rows}}
\end{equation*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Section 8.6: Beam Self-shading DC Loss Factor}

The symbol for the submodule \textbf{fill factor} variable is inconsistent. It should be $F_{fill}$ instead of $\mathit{FF}_0$.

\textbf{Equation 8.23} uses $m_d$ for the number of bypass diodes instead of $d$. Note that the number of bypass diodes is fixed at $d=3$, as expained in Section 8.1.

Correct:
\begin{align*}
F_{dc1} &= 1-C_1S^2-C_2S \notag\\ %eqn5
F_{dc2} &= 
\left\{
   \begin{array}{ll}
      \dfrac{X-S\left(1+0.5 d V^{-1}_{mp}\right)}{X} & \text{if $X>0$}\\
      0 & \text{if $X=0$}\\
   \end{array}
\right. \notag\\ %eqn9
F_{dc3} &= C_3\left(S-1\right)+R_{dt} %eqn10
\end{align*}

Incorrect:
\begin{align*}
F_{dc1} &= 1-C_1S^2-C_2S \notag\\ %eqn5
F_{dc2} &= 
\left\{
   \begin{array}{ll}
      \dfrac{X-S\left(1+0.5 m_d V^{-1}_{mp}\right)}{X} & \text{if $X>0$}\\
      0 & \text{if $X=0$}\\
   \end{array}
\right. \notag\\ %eqn9
F_{dc3} &= C_3\left(S-1\right)+R_{dt} %eqn10
\end{align*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Section 9.4: Sandia Module Model}

\textbf{Equation 9.5} for effective irradiance is missing brackets to show the correct order of multiplication and addition.

Correct:
\begin{equation*}
E_e = \frac{I_{sc}}{I_{sc,ref} \left[1 + \alpha_{sc,ref} (T_c - 25)\right]}
\end{equation*}

Incorrect:
\begin{equation*}
E_e = \frac{I_{sc}}{I_{sc,ref}~1 + \alpha_{sc,ref} (T_c - 25)}
\end{equation*}

\textbf{Equation 9.6} is also missing brackets:

Correct:
\begin{equation*}
I_{mp} = I_{mp,ref} (C_0 E_e + C_1 E_e^2) \left[1 + \alpha_{sc,ref} (T_c - 25)\right]
\end{equation*}

Incorrect:
\begin{equation*}
I_{mp} = I_{mp,ref} (C_0 E_e + C_1 E_e^2)~1 + \alpha_{sc,ref} (T_c - 25)
\end{equation*}

The equation for \textbf{open circuit voltage} is missing. It should be between Equations 9.7 and 9.8:

\begin{equation*}
V_{oc} = V_{oc,ref}+ s~\Delta T_c \ln(E_e)+ \beta_{oc} (T_c - 25)
\end{equation*}

\textbf{Equation 9.8} for voltage at maximum power uses $\log$ instead of $\ln$. The logarithms  should be natural logarithms.

Correct:
\begin{equation*}
V_{mp} = V_{mp,ref} +
 C_2~s~\Delta T_c~\ln(E_e) +
 C_3~s~\left[\Delta T_c \ln(E_e)\right]^2 +
 \beta_{mp} (T_c - 25)
\end{equation*}

Incorrect:
\begin{equation*}
V_{mp} = V_{mp,ref} +
 C_2~s~\Delta T_c~\log(E_e) +
 C_3~s~\left[\Delta T_c \log(E_e)\right]^2 +
 \beta_{mp} (T_c - 25)
\end{equation*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Section 9.7: NOCT Cell Temperature Model}

\textbf{Equation 9.35} shows incorrect NOCT temperature adjustment for building integrated, greater than 3.5 in, or ground/rack mounted option.

Correct:
\begin{equation*}
T_{noct,adj} =\left\{
\begin{array}{ll}
T_{noct}  & \text{building integrated, greater than 3.5 in, or ground/rack mounted}\\
T_{noct} + 2 & \text{2.5 to 3.5 in} \\
T_{noct} + 6 & \text{1.5 to 2.5 in} \\
T_{noct} + 11 & \text{0.5 to 1.5 in} \\
T_{noct} + 18 & \text{less than 0.5 in} \\
\end{array}
\right.
\end{equation*}

Incorrect:
\begin{equation*}
T_{noct,adj} =\left\{
\begin{array}{ll}
T_{noct} + 2  & \text{building integrated, greater than 3.5 in, or ground/rack mounted}\\
T_{noct} + 2 & \text{2.5 to 3.5 in} \\
T_{noct} + 6 & \text{1.5 to 2.5 in} \\
T_{noct} + 11 & \text{0.5 to 1.5 in} \\
T_{noct} + 18 & \text{less than 0.5 in} \\
\end{array}
\right.
\end{equation*}

\textbf{Equation 9.36} is missing brackets to show correct order of multiplication.

Correct:
\begin{equation*}
T_c = T_a + \frac{G}{800} \left(T_{noct,adj} - 20 \right) \left(1-\frac{\eta_{ref}}{\tau \alpha}\right) \frac{9.5}{5.7+3.8v_{w,adj}}
\end{equation*}

Incorrect:
\begin{equation*}
T_c = T_a + \frac{G}{800} T_{noct,adj} - 20~ 1-\frac{\eta_{ref}}{\tau \alpha} \frac{9.5}{5.7+3.8v_{w,adj}}
\end{equation*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Section 11.2: Sandia Inverter Submodel}

\textbf{Equation 11.3} for Sandia inverter model parameters is missing closing parentheses.

Correct:
\begin{align*}
A &=P_{dc,0} \left[ 1+ C_1 ( V_{dc} - V_{dc,0} )\right] \notag\\
B &= P_{s,0}  \left[ 1+ C_2 ( V_{dc} - V_{dc,0} )\right] \notag\\
C &= C_0  \left[ 1+ C_3 ( V_{dc} - V_{dc,0} )\right]
\end{align*}

Incorrect:
%lib_sandia.cpp 329
\begin{align*}
A &=P_{dc,0} \left[ 1+ C_1 ( V_{dc} - V_{dc,0}\right] \notag\\
B &= P_{s,0}  \left[ 1+ C_2 ( V_{dc} - V_{dc,0}\right] \notag\\
C &= C_0  \left[ 1+ C_3 ( V_{dc} - V_{dc,0}\right]
\end{align*}

\end{document}

