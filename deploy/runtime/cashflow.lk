
// setup cashflow tables////////////////////////////////////////////////////////
function state_federal_depreciation_tables()
{
	cfrow("% of Total\nDepreciable Basis,Gross Amount\nAllocated,IBI\nReduction,CBI\nReduction,Depreciable Basis\nPrior to ITC,ITC Qualifying\nCosts,% of ITC\nQualifying Costs,ITC\nAmount,ITC Basis\nDisallowance,ITC\nAmount,ITC Basis\nDisallowance,State ITC\nReduction,Federal ITC\nReduction,Depreciable Basis\nAfter ITC Reduction,First Year Bonus\nDepreciation,Depreciable Basis\nAfter Bonus Reduction",-1);
	
	cfrow("State Depreciation & ITC",0);
	cfrow("5-yr MACRS,depr_stabas_percent_macrs_5,depr_alloc_macrs_5,depr_stabas_ibi_reduc_macrs_5,depr_stabas_cbi_reduc_macrs_5,depr_stabas_prior_itc_macrs_5,itc_sta_qual_macrs_5,depr_stabas_percent_qual_macrs_5,depr_stabas_percent_amount_macrs_5,itc_disallow_sta_percent_macrs_5,depr_stabas_fixed_amount_macrs_5,itc_disallow_sta_fixed_macrs_5,depr_stabas_itc_sta_reduction_macrs_5,depr_stabas_itc_fed_reduction_macrs_5,depr_stabas_after_itc_macrs_5,depr_stabas_first_year_bonus_macrs_5,depr_stabas_macrs_5");
	cfrow("15-yr MACRS,depr_stabas_percent_macrs_15,depr_alloc_macrs_15,depr_stabas_ibi_reduc_macrs_15,depr_stabas_cbi_reduc_macrs_15,depr_stabas_prior_itc_macrs_15,itc_sta_qual_macrs_15,depr_stabas_percent_qual_macrs_15,depr_stabas_percent_amount_macrs_15,itc_disallow_sta_percent_macrs_15,depr_stabas_fixed_amount_macrs_15,itc_disallow_sta_fixed_macrs_15,depr_stabas_itc_sta_reduction_macrs_15,depr_stabas_itc_fed_reduction_macrs_15,depr_stabas_after_itc_macrs_15,depr_stabas_first_year_bonus_macrs_15,depr_stabas_macrs_15");
	cfrow("5-yr Straight Line,depr_stabas_percent_sl_5,depr_alloc_sl_5,depr_stabas_ibi_reduc_sl_5,depr_stabas_cbi_reduc_sl_5,depr_stabas_prior_itc_sl_5,itc_sta_qual_sl_5,depr_stabas_percent_qual_sl_5,depr_stabas_percent_amount_sl_5,itc_disallow_sta_percent_sl_5,depr_stabas_fixed_amount_sl_5,itc_disallow_sta_fixed_sl_5,depr_stabas_itc_sta_reduction_sl_5,depr_stabas_itc_fed_reduction_sl_5,depr_stabas_after_itc_sl_5,depr_stabas_first_year_bonus_sl_5,depr_stabas_sl_5");
	cfrow("15-yr Straight Line,depr_stabas_percent_sl_15,depr_alloc_sl_15,depr_stabas_ibi_reduc_sl_15,depr_stabas_cbi_reduc_sl_15,depr_stabas_prior_itc_sl_15,itc_sta_qual_sl_15,depr_stabas_percent_qual_sl_15,depr_stabas_percent_amount_sl_15,itc_disallow_sta_percent_sl_15,depr_stabas_fixed_amount_sl_15,itc_disallow_sta_fixed_sl_15,depr_stabas_itc_sta_reduction_sl_15,depr_stabas_itc_fed_reduction_sl_15,depr_stabas_after_itc_sl_15,depr_stabas_first_year_bonus_sl_15,depr_stabas_sl_15");
	cfrow("20-yr Straight Line,depr_stabas_percent_sl_20,depr_alloc_sl_20,depr_stabas_ibi_reduc_sl_20,depr_stabas_cbi_reduc_sl_20,depr_stabas_prior_itc_sl_20,itc_sta_qual_sl_20,depr_stabas_percent_qual_sl_20,depr_stabas_percent_amount_sl_20,itc_disallow_sta_percent_sl_20,depr_stabas_fixed_amount_sl_20,itc_disallow_sta_fixed_sl_20,depr_stabas_itc_sta_reduction_sl_20,depr_stabas_itc_fed_reduction_sl_20,depr_stabas_after_itc_sl_20,depr_stabas_first_year_bonus_sl_20,depr_stabas_sl_20");
	cfrow("39-yr Straight Line,depr_stabas_percent_sl_39,depr_alloc_sl_39,depr_stabas_ibi_reduc_sl_39,depr_stabas_cbi_reduc_sl_39,depr_stabas_prior_itc_sl_39,itc_sta_qual_sl_39,depr_stabas_percent_qual_sl_39,depr_stabas_percent_amount_sl_39,itc_disallow_sta_percent_sl_39,depr_stabas_fixed_amount_sl_39,itc_disallow_sta_fixed_sl_39,depr_stabas_itc_sta_reduction_sl_39,depr_stabas_itc_fed_reduction_sl_39,depr_stabas_after_itc_sl_39,depr_stabas_first_year_bonus_sl_39,depr_stabas_sl_39");
	cfrow("Custom,depr_stabas_percent_custom,depr_alloc_custom,depr_stabas_ibi_reduc_custom,depr_stabas_cbi_reduc_custom,depr_stabas_prior_itc_custom,itc_sta_qual_custom,depr_stabas_percent_qual_custom,depr_stabas_percent_amount_custom,itc_disallow_sta_percent_custom,depr_stabas_fixed_amount_custom,itc_disallow_sta_fixed_custom,depr_stabas_itc_sta_reduction_custom,depr_stabas_itc_fed_reduction_custom,depr_stabas_after_itc_custom,depr_stabas_first_year_bonus_custom,depr_stabas_custom");
	cfrow("Total,depr_stabas_percent_total,depr_alloc_total,depr_stabas_ibi_reduc_total,depr_stabas_cbi_reduc_total,depr_stabas_prior_itc_total,itc_sta_qual_total,depr_stabas_percent_qual_total,depr_stabas_percent_amount_total,itc_disallow_sta_percent_total,depr_stabas_fixed_amount_total,itc_disallow_sta_fixed_total,depr_stabas_itc_sta_reduction_total,depr_stabas_itc_fed_reduction_total,depr_stabas_after_itc_total,depr_stabas_first_year_bonus_total,depr_stabas_total");
	
	cfrow("Federal Depreciation & ITC",0);
	cfrow("5-yr MACRS,depr_fedbas_percent_macrs_5,depr_alloc_macrs_5,depr_fedbas_ibi_reduc_macrs_5,depr_fedbas_cbi_reduc_macrs_5,depr_fedbas_prior_itc_macrs_5,itc_fed_qual_macrs_5,depr_fedbas_percent_qual_macrs_5,depr_fedbas_percent_amount_macrs_5,itc_disallow_fed_percent_macrs_5,depr_fedbas_fixed_amount_macrs_5,itc_disallow_fed_fixed_macrs_5,depr_fedbas_itc_fed_reduction_macrs_5,depr_fedbas_itc_fed_reduction_macrs_5,depr_fedbas_after_itc_macrs_5,depr_fedbas_first_year_bonus_macrs_5,depr_fedbas_macrs_5");
	cfrow("15-yr MACRS,depr_fedbas_percent_macrs_15,depr_alloc_macrs_15,depr_fedbas_ibi_reduc_macrs_15,depr_fedbas_cbi_reduc_macrs_15,depr_fedbas_prior_itc_macrs_15,itc_fed_qual_macrs_15,depr_fedbas_percent_qual_macrs_15,depr_fedbas_percent_amount_macrs_15,itc_disallow_fed_percent_macrs_15,depr_fedbas_fixed_amount_macrs_15,itc_disallow_fed_fixed_macrs_15,depr_fedbas_itc_fed_reduction_macrs_15,depr_fedbas_itc_fed_reduction_macrs_15,depr_fedbas_after_itc_macrs_15,depr_fedbas_first_year_bonus_macrs_15,depr_fedbas_macrs_15");
	cfrow("5-yr Straight Line,depr_fedbas_percent_sl_5,depr_alloc_sl_5,depr_fedbas_ibi_reduc_sl_5,depr_fedbas_cbi_reduc_sl_5,depr_fedbas_prior_itc_sl_5,itc_fed_qual_sl_5,depr_fedbas_percent_qual_sl_5,depr_fedbas_percent_amount_sl_5,itc_disallow_fed_percent_sl_5,depr_fedbas_fixed_amount_sl_5,itc_disallow_fed_fixed_sl_5,depr_fedbas_itc_fed_reduction_sl_5,depr_fedbas_itc_fed_reduction_sl_5,depr_fedbas_after_itc_sl_5,depr_fedbas_first_year_bonus_sl_5,depr_fedbas_sl_5");
	cfrow("15-yr Straight Line,depr_fedbas_percent_sl_15,depr_alloc_sl_15,depr_fedbas_ibi_reduc_sl_15,depr_fedbas_cbi_reduc_sl_15,depr_fedbas_prior_itc_sl_15,itc_fed_qual_sl_15,depr_fedbas_percent_qual_sl_15,depr_fedbas_percent_amount_sl_15,itc_disallow_fed_percent_sl_15,depr_fedbas_fixed_amount_sl_15,itc_disallow_fed_fixed_sl_15,depr_fedbas_itc_fed_reduction_sl_15,depr_fedbas_itc_fed_reduction_sl_15,depr_fedbas_after_itc_sl_15,depr_fedbas_first_year_bonus_sl_15,depr_fedbas_sl_15");
	cfrow("20-yr Straight Line,depr_fedbas_percent_sl_20,depr_alloc_sl_20,depr_fedbas_ibi_reduc_sl_20,depr_fedbas_cbi_reduc_sl_20,depr_fedbas_prior_itc_sl_20,itc_fed_qual_sl_20,depr_fedbas_percent_qual_sl_20,depr_fedbas_percent_amount_sl_20,itc_disallow_fed_percent_sl_20,depr_fedbas_fixed_amount_sl_20,itc_disallow_fed_fixed_sl_20,depr_fedbas_itc_fed_reduction_sl_20,depr_fedbas_itc_fed_reduction_sl_20,depr_fedbas_after_itc_sl_20,depr_fedbas_first_year_bonus_sl_20,depr_fedbas_sl_20");
	cfrow("39-yr Straight Line,depr_fedbas_percent_sl_39,depr_alloc_sl_39,depr_fedbas_ibi_reduc_sl_39,depr_fedbas_cbi_reduc_sl_39,depr_fedbas_prior_itc_sl_39,itc_fed_qual_sl_39,depr_fedbas_percent_qual_sl_39,depr_fedbas_percent_amount_sl_39,itc_disallow_fed_percent_sl_39,depr_fedbas_fixed_amount_sl_39,itc_disallow_fed_fixed_sl_39,depr_fedbas_itc_fed_reduction_sl_39,depr_fedbas_itc_fed_reduction_sl_39,depr_fedbas_after_itc_sl_39,depr_fedbas_first_year_bonus_sl_39,depr_fedbas_sl_39");
	cfrow("Custom,depr_fedbas_percent_custom,depr_alloc_custom,depr_fedbas_ibi_reduc_custom,depr_fedbas_cbi_reduc_custom,depr_fedbas_prior_itc_custom,itc_fed_qual_custom,depr_fedbas_percent_qual_custom,depr_fedbas_percent_amount_custom,itc_disallow_fed_percent_custom,depr_fedbas_fixed_amount_custom,itc_disallow_fed_fixed_custom,depr_fedbas_itc_fed_reduction_custom,depr_fedbas_itc_fed_reduction_custom,depr_fedbas_after_itc_custom,depr_fedbas_first_year_bonus_custom,depr_fedbas_custom");
	cfrow("Total,depr_fedbas_percent_total,depr_alloc_total,depr_fedbas_ibi_reduc_total,depr_fedbas_cbi_reduc_total,depr_fedbas_prior_itc_total,itc_fed_qual_total,depr_fedbas_percent_qual_total,depr_fedbas_percent_amount_total,itc_disallow_fed_percent_total,depr_fedbas_fixed_amount_total,itc_disallow_fed_fixed_total,depr_fedbas_itc_fed_reduction_total,depr_fedbas_itc_fed_reduction_total,depr_fedbas_after_itc_total,depr_fedbas_first_year_bonus_total,depr_fedbas_total");
}


function setup_incentives_cashflow()
{
	cfline( "ibi_total_fed,ibi_total_sta,ibi_total_uti,ibi_total_oth,ibi_total", -1 ); // -1 = use generic format
	cfline( '' ); // spacer 
	cfline( "cbi_total_fed,cbi_total_sta,cbi_total_uti,cbi_total_oth,cbi_total", -1 );
	cfline( '' ); // spacer 
	cfline( "cf_pbi_total_fed,cf_pbi_total_sta,cf_pbi_total_uti,cf_pbi_total_oth,cf_pbi_total", -1 );
	cfline( '' ); // spacer 
	cfline( "cf_ptc_fed,cf_ptc_sta,cf_ptc_total", -1 );
	cfline( '' ); // spacer 
	cfline( "itc_fed_total,itc_sta_total,itc_total", -1 );
	cfline( '' ); // spacer 
}

cashflow{ 'Residential' } = define()
{
	cfline( 'cf_energy_net', 1); // use one digit
	cfline( 'cf_energy_value');
	cfline( '' ); // spacer

	cfline( "Operating Expenses", 0 ); // header	
	cfline( 'cf_om_fixed_expense,cf_om_production_expense,cf_om_capacity_expense,cf_om_fuel_expense');
	cfline( 'cf_om_opt_fuel_1_expense' );
	cfline( 'cf_om_opt_fuel_2_expense' );
	
//	cfline( 'cf_property_tax_assessed_value');
	cfline( 'cf_property_tax_expense');
	cfline( 'cf_insurance_expense');
	cfline( 'cf_net_salvage_value');
	cfline( 'cf_operating_expenses');
	cfline( '' ); // spacer
	
	cfline( 'cf_deductible_expenses');
	cfline( '' ); // spacer
	
	cfline( "Financing", 0 ); // header
	cfline( 'cf_debt_balance');
	cfline( 'cf_debt_payment_interest');
	cfline( 'cf_debt_payment_principal');
	cfline( 'cf_debt_payment_total');

	// incentives
	setup_incentives_cashflow();
	
	cfline( "Tax Effect on Equity (State)", 0 ); // header
	cfline( 'cf_sta_depr_sched');
	cfline( 'cf_sta_depreciation');
	cfline( 'cf_sta_incentive_income_less_deductions');
	cfline( 'cf_sta_taxable_income_less_deductions');
	cfline( 'cf_sta_tax_savings');
	cfline( '' ); // spacer
	
	cfline( "Tax Effect on Equity (Federal)", 0 ); // header
	cfline( 'cf_fed_depr_sched' );
	cfline( 'cf_fed_depreciation');
	cfline( 'cf_fed_incentive_income_less_deductions');
	cfline( 'cf_fed_taxable_income_less_deductions');	
	cfline( 'cf_fed_tax_savings' );
	cfline( '' ); // spacer
	
	cfline( 'cf_after_tax_net_equity_cost_flow');
	cfline( 'cf_after_tax_cash_flow');
};

cashflow{ 'Commercial' } = define()
{
	cfline( 'cf_energy_net', 1); // use one digit
	cfline( 'cf_energy_value');
	cfline( '' ); // spacer

	cfline( "Operating Expenses", 0 ); // header	
	cfline( 'cf_om_fixed_expense,cf_om_production_expense,cf_om_capacity_expense,cf_om_fuel_expense');
	cfline( 'cf_om_opt_fuel_1_expense' );
	cfline( 'cf_om_opt_fuel_2_expense' );
	
//	cfline( 'cf_property_tax_assessed_value');
	cfline( 'cf_property_tax_expense');
	cfline( 'cf_insurance_expense');
	cfline( 'cf_net_salvage_value');
	cfline( 'cf_operating_expenses');
	cfline( '' ); // spacer
	
	cfline( 'cf_deductible_expenses');
	cfline( '' ); // spacer
	
	cfline( "Financing", 0 ); // header
	cfline( 'cf_debt_balance');
	cfline( 'cf_debt_payment_interest');
	cfline( 'cf_debt_payment_principal');
	cfline( 'cf_debt_payment_total');
	
	// incentives
	setup_incentives_cashflow();
	
	cfline( "Tax Effect on Equity (State)", 0 ); // header
	cfline( 'cf_sta_depr_sched');
	cfline( 'cf_sta_depreciation');
	cfline( 'cf_sta_incentive_income_less_deductions');
	cfline( 'cf_sta_taxable_income_less_deductions');
	cfline( 'cf_sta_tax_savings');
	cfline( '' ); // spacer
	
	cfline( "Tax Effect on Equity (Federal)", 0 ); // header
	cfline( 'cf_fed_depr_sched' );
	cfline( 'cf_fed_depreciation');
	cfline( 'cf_fed_incentive_income_less_deductions');
	cfline( 'cf_fed_taxable_income_less_deductions');	
	cfline( 'cf_fed_tax_savings' );
	cfline( '' ); // spacer
	
	cfline( 'cf_after_tax_net_equity_cost_flow');
	cfline( 'cf_after_tax_cash_flow');
};


cashflow{ 'Commercial PPA' } = define()
{
	cfline( 'cf_energy_net', 1); // use one digit
	cfline( 'cf_energy_price');
	cfline( 'cf_energy_value');
	cfline( '' ); // spacer

	cfline( "Operating Expenses", 0 ); // header	
	cfline( 'cf_om_fixed_expense,cf_om_production_expense,cf_om_capacity_expense,cf_om_fuel_expense');
	cfline( 'cf_om_opt_fuel_1_expense' );
	cfline( 'cf_om_opt_fuel_2_expense' );
	
//	cfline( 'cf_property_tax_assessed_value');
	cfline( 'cf_property_tax_expense');
	cfline( 'cf_insurance_expense');
	cfline( 'cf_net_salvage_value');
	cfline( 'cf_operating_expenses');
	cfline( '' ); // spacer
	
	cfline( 'cf_operating_income');
	cfline( '' ); // spacer
	
	cfline( "Financing", 0 ); // header
	cfline( 'cf_debt_balance');
	cfline( 'cf_debt_payment_interest');
	cfline( 'cf_debt_payment_principal');
	cfline( 'cf_debt_payment_total');
	
	// incentives
	setup_incentives_cashflow();
	
	cfline( "Tax Effect on Equity (State)", 0 ); // header
	cfline( 'cf_sta_depr_sched');
	cfline( 'cf_sta_depreciation');
	cfline( 'cf_sta_incentive_income_less_deductions');
	cfline( 'cf_sta_taxable_income_less_deductions');
	cfline( 'cf_sta_tax_savings');
	cfline( '' ); // spacer
	
	cfline( "Tax Effect on Equity (Federal)", 0 ); // header
	cfline( 'cf_fed_depr_sched' );
	cfline( 'cf_fed_depreciation');
	cfline( 'cf_fed_incentive_income_less_deductions');
	cfline( 'cf_fed_taxable_income_less_deductions');	
	cfline( 'cf_fed_tax_savings' );
	cfline( '' ); // spacer
	
	cfline( 'cf_after_tax_net_equity_cash_flow');
	cfline( 'cf_after_tax_net_equity_cost_flow');
	cfline( 'cf_after_tax_cash_flow');
};
cashflow{ 'Independent Power Producer' } = define()
{
	cfline( 'cf_energy_net', 1); // use one digit
	cfline( 'cf_energy_price');
	cfline( 'cf_energy_value');
	cfline( '' ); // spacer

	cfline( "Operating Expenses", 0 ); // header	
	cfline( 'cf_om_fixed_expense,cf_om_production_expense,cf_om_capacity_expense,cf_om_fuel_expense');
	cfline( 'cf_om_opt_fuel_1_expense' );
	cfline( 'cf_om_opt_fuel_2_expense' );
	
//	cfline( 'cf_property_tax_assessed_value');
	cfline( 'cf_property_tax_expense');
	cfline( 'cf_insurance_expense');
	cfline( 'cf_net_salvage_value');
	cfline( 'cf_operating_expenses');
	cfline( '' ); // spacer
	
	cfline( 'cf_operating_income');
	cfline( '' ); // spacer
	
	cfline( "Financing", 0 ); // header
	cfline( 'cf_debt_balance');
	cfline( 'cf_debt_payment_interest');
	cfline( 'cf_debt_payment_principal');
	cfline( 'cf_debt_payment_total');
	
	// incentives
	setup_incentives_cashflow();
	
	cfline( "Tax Effect on Equity (State)", 0 ); // header
	cfline( 'cf_sta_depr_sched');
	cfline( 'cf_sta_depreciation');
	cfline( 'cf_sta_incentive_income_less_deductions');
	cfline( 'cf_sta_taxable_income_less_deductions');
	cfline( 'cf_sta_tax_savings');
	cfline( '' ); // spacer
	
	cfline( "Tax Effect on Equity (Federal)", 0 ); // header
	cfline( 'cf_fed_depr_sched' );
	cfline( 'cf_fed_depreciation');
	cfline( 'cf_fed_incentive_income_less_deductions');
	cfline( 'cf_fed_taxable_income_less_deductions');	
	cfline( 'cf_fed_tax_savings' );
	cfline( '' ); // spacer
	
	cfline( 'cf_after_tax_net_equity_cash_flow');
	cfline( 'cf_after_tax_net_equity_cost_flow');
	cfline( 'cf_after_tax_cash_flow');
};

cashflow{ 'Single Owner' } = define()
{
    tech = technology();

    fueltech = ( tech != 'Flat Plate PV' && 
                 tech != 'PVWatts' && 
                 tech != 'High-X Concentrating PV' && 
                 tech != 'Solar Water Heating' && 
                 tech != 'Wind Power');
    
	cfline( 'cf_energy_net', 1); // use one digit
	cfline( 'cf_energy_price');
	cfline( 'cf_energy_value');
	// optional values used for pbi for debt service
	if (value('pbi_fed_for_ds')==1)	cfline( 'cf_pbi_total_fed');
	if (value('pbi_sta_for_ds')==1)	cfline( 'cf_pbi_total_sta');
	if (value('pbi_uti_for_ds')==1)	cfline( 'cf_pbi_total_uti');
	if (value('pbi_oth_for_ds')==1)	cfline( 'cf_pbi_total_oth');

	cfline( 'cf_net_salvage_value');
	cfline( 'cf_total_revenue');

	cfline( '' ); // spacer

	cfline( 'cf_property_tax_assessed_value');

	cfline( '' ); // spacer

	cfline( "Expenses", 0 ); // header	
	if (value('system_use_recapitalization')) cfline ('capitalization');
	cfline( 'cf_om_fixed_expense,cf_om_production_expense,cf_om_capacity_expense');
	if ( fueltech == true )cfline('cf_om_fuel_expense');
	if ( fueltech == true )cfline( 'cf_om_opt_fuel_1_expense' );
	if ( fueltech == true )cfline( 'cf_om_opt_fuel_2_expense' );
	cfline( 'cf_property_tax_expense');
	cfline( 'cf_insurance_expense');
	cfline( 'cf_operating_expenses');
	cfline( '' ); // spacer
	
	cfline( 'cf_ebitda');
	cfline( '' ); // spacer
	
	cfline( "Cash Flows from Operating Activities", 0 ); // header
	cfline( 'cf_reserve_interest');
	if (value('pbi_fed_for_ds')==0)	cfline( 'cf_pbi_total_fed');
	if (value('pbi_sta_for_ds')==0)	cfline( 'cf_pbi_total_sta');
	if (value('pbi_uti_for_ds')==0)	cfline( 'cf_pbi_total_uti');
	if (value('pbi_oth_for_ds')==0)	cfline( 'cf_pbi_total_oth');
	cfline('project_operating_activities');
	cfline( '' ); // spacer

	cfline( "Cash Flows from Investing Activities", 0);
	cfline( 'sv.purchase_of_property');
	cfline( '' ); // spacer
	cfline( 'cf.project_wcra');
	cfline('cf_project_me1ra');
	cfline('cf_project_me2ra');
	cfline('cf_project_me3ra');
	cfline('cf_project_ra');
	cfline( '' ); // spacer
	cfline('cf_project_me1cs');
	cfline('cf_project_me2cs');
	cfline('cf_project_me3cs');
	cfline('cf_project_mecs');
	cfline( '' ); // spacer
	cfline('cf_project_investing_activities');
	cfline( '' ); // spacer

	cfline( 'sv.TotalIBI');
	cfline( 'sv.TotalCBI');
	cfline( 'sv.issuance_of_equity');
	cfline('cf_project_financing_activities');
	cfline( '' ); // spacer
	cfline('cf_pretax_cashflow');
	cfline( '' ); // spacer

	cfline( 'Total Project Returns');
	cfline( 'Pre-Tax');
	cfline('cf_project_return_pretax');
	cfline('cf_project_return_pretax_irr');
	cfline('cf_project_return_pretax_npv');
	cfline( '' ); // spacer
	cfline( 'After-Tax');
	cfline('cf_project_return_aftertax_cash');
	cfline('cf_project_return_aftertax');
	cfline('cf_project_return_aftertax_irr');
	cfline('cf_project_return_aftertax_npv');
	cfline( '' ); // spacer
	cfline( '' ); // spacer

// LCOE
	cfline( 'LCOE');
	cfline('cf_energy_value');
	cfline('cf_energy');
	cfline( 'npv_ppa_revenue');
	cfline( 'npv_energy_nom');
	cfline( 'lcoe_nom');
	cfline( 'npv_energy_real');
	cfline( 'lcoe_real');
	cfline( '' ); // spacer


	// incentives
	cfline( 'Incentives');
	setup_incentives_cashflow();
	cfline( '' ); // spacer

	// debt
	cfline( 'Debt');
	cfline( 'sv.total_debt');
	cfline('cf_debt_payment_principal');
	cfline('cf_debt_balance');
	cfline( '' ); // spacer
	cfline('cf_debt_payment_principal');
	cfline('cf_debt_payment_interest');
	cfline('cf_debt_payment_total');
	cfline( '' ); // spacer
	

	// reserve accounts
	cfline( 'Reserve Accounts');
	cfline('cf_reserve_debtservice');
	cfline('cf_reserve_om');
	cfline('cf_reserve_equip1');
	cfline('cf_reserve_equip2');
	cfline('cf_reserve_equip3');
	cfline( '' ); // spacer
	cfline( '' ); // spacer

	// state and federal depreciation/itc tables
	state_federal_depreciation_tables();

};

cashflow{ 'All Equity Partnership Flip' } = define()
{
	cfline('Partial Income Statement: Project',0);

    	tech = technology();

    	fueltech = ( tech != 'Flat Plate PV' && 
                 tech != 'PVWatts' && 
                 tech != 'High-X Concentrating PV' && 
                 tech != 'Solar Water Heating' && 
                 tech != 'Wind Power');
    
	cfline( 'cf_energy_net'); // use one digit
	cfline( 'cf_energy_price');
	cfline( 'cf_energy_value');
	cfline( 'cf_net_salvage_value');

	cfline( 'cf_total_revenue');

	cfline( '' ); // spacer

	cfline( 'cf_property_tax_assessed_value');

	cfline( '' ); // spacer

	cfline( "Expenses", 0 ); // header	
	if (value('system_use_recapitalization')) cfline ('capitalization');
	cfline( 'cf_om_fixed_expense,cf_om_production_expense,cf_om_capacity_expense');
	if ( fueltech == true )cfline('cf_om_fuel_expense');
	if ( fueltech == true )cfline( 'cf_om_opt_fuel_1_expense' );
	if ( fueltech == true )cfline( 'cf_om_opt_fuel_2_expense' );
	cfline( 'cf_property_tax_expense');
	cfline( 'cf_insurance_expense');
	cfline( 'cf_operating_expenses');
	cfline( '' ); // spacer
	
	cfline( 'cf_ebitda');
	cfline( '' ); // spacer

	cfline('Cash Flow: Project',0);
	cfline('Cash Flows from Operating Activities',0);
	cfline( 'cf_ebitda');
	cfline( 'cf_reserve_interest');
	cfline('project_operating_activities');
	cfline( '' ); // spacer
	cfline( "Cash Flows from Investing Activities", 0);
	cfline( 'sv.purchase_of_property');
	cfline( '' ); // spacer
	cfline( 'cf.project_wcra');
	cfline('cf_project_me1ra');
	cfline('cf_project_me2ra');
	cfline('cf_project_me3ra');
	cfline('cf_project_ra');
	cfline( '' ); // spacer
	cfline('cf_project_me1cs');
	cfline('cf_project_me2cs');
	cfline('cf_project_me3cs');
	cfline('cf_project_mecs');
	cfline( '' ); // spacer
	cfline('cf_project_investing_activities');
	cfline( '' ); // spacer
	cfline( "Project Cash Flows From Financing Activities",0);
	cfline( 'sv.TotalIBI');
	cfline( 'sv.TotalCBI');
	cfline( 'sv.issuance_of_equity');
	cfline('cf_project_financing_activities');
	cfline( '' ); // spacer
	cfline('cf_pretax_cashflow');
	cfline( '' ); // spacer
	cfline( 'Total Project Returns');
	cfline( 'Pre-Tax');
	cfline('cf_project_return_pretax');
	cfline('cf_project_return_pretax_irr');
	cfline('cf_project_return_pretax_npv');
	cfline( '' ); // spacer
	cfline( 'After-Tax');
	cfline('cf_project_return_aftertax_cash');
	cfline('cf_project_return_aftertax');
	cfline('cf_project_return_aftertax_irr');
	cfline('cf_project_return_aftertax_npv');
	cfline( '' ); // spacer
	cfline( '' ); // spacer

// LCOE
	cfline( 'LCOE',0);
	cfline('cf_energy_value');
	cfline('cf_energy');
	cfline( 'npv_ppa_revenue');
	cfline( 'npv_energy_nom');
	cfline( 'lcoe_nom');
	cfline( 'npv_energy_real');
	cfline( 'lcoe_real');
	cfline( '' ); // spacer


	cfline('Partners Returns',0);
	cfline( 'Tax Invester Pre-tax Returns',0);
	cfline('cf_tax_investor_pretax');//"Total tax investor pre-tax returns");
	cfline('cf_tax_investor_pretax_irr');//"Tax investor cumulative IRR");
	cfline('cf_tax_investor_pretax_npv');//"Tax investor cumulative NPV");
	cfline( '' ); // spacer
	cfline( 'Tax Invester After-tax Returns',0);
	cfline('cf_tax_investor_aftertax_cash');//"Tax investor cash (total pre-tax returns)");
	cfline('cf_tax_investor_aftertax_itc');//"ITC");
	cfline('cf_tax_investor_aftertax_ptc');//"PTC");
	cfline('cf_tax_investor_aftertax_tax');//Tax investor share of project tax");
	cfline('cf_tax_investor_aftertax');//Total tax investor after-tax returns");
	cfline('cf_tax_investor_aftertax_irr');//Tax investor cumulative IRR");
	cfline('cf_tax_investor_aftertax_npv');//Tax investor cumulative NPV");
	cfline('cf_tax_investor_aftertax_max_irr');//Tax investor maximum IRR");
	cfline( '' ); // spacer


	cfline('Developer Capital Recovery',0);
	cfline('cf_sponsor_capital_recovery_cash');
	cfline('cf_sponsor_capital_recovery_balance');
	cfline( '' ); // spacer
	cfline('Developer Pre-tax Returns',0);
	cfline('sponsor_pretax_equity');//"Developer Pre-tax Returns");
	cfline('sponsor_pretax_development');//"Pre-tax development fee");
	cfline('cf_sponsor_pretax');//"Total developer pre-tax returns");
	cfline('cf_sponsor_pretax_irr');//"Developer pre-tax cumulative IRR");
	cfline('cf_sponsor_pretax_npv');//"Developer pre-tax cumulative NPV");
	cfline('sponsor_pretax_irr');//"Developer pre-tax IRR");
	cfline('sponsor_pretax_npv');//"Developer pre-tax NPV");
	cfline( '' ); // spacer
	cfline( 'Developer After-tax Returns',0);
	cfline('sponsor_aftertax_equity');//"Equity Investment");
	cfline('sponsor_aftertax_development');//"Development Fee");
	cfline('cf_sponsor_aftertax_cash');//"Cash");
	cfline('cf_sponsor_aftertax_itc');//"ITC");
	cfline('cf_sponsor_aftertax_ptc');//"PTC");
	cfline('cf_sponsor_aftertax_tax');//"Developer share of project tax");
	cfline('cf_sponsor_aftertax');//"Total developer after-tax returns");
	cfline('cf_sponsor_aftertax_irr');//"Developer after-tax cumulative IRR");
	cfline('cf_sponsor_aftertax_npv');//"Developer after-tax cumulative NPV");
	cfline('sponsor_aftertax_irr');//"Developer after-tax IRR");
	cfline('sponsor_aftertax_npv');//"Developer after-tax NPV");
	cfline( '' ); // spacer


	// incentives
	cfline( 'Incentives');
	setup_incentives_cashflow();
	cfline( '' ); // spacer

	// reserve accounts
	cfline( 'Reserve Accounts');
	cfline('cf_reserve_debtservice');
	cfline('cf_reserve_om');
	cfline('cf_reserve_equip1');
	cfline('cf_reserve_equip2');
	cfline('cf_reserve_equip3');
	cfline( '' ); // spacer
	cfline( '' ); // spacer

	// state and federal depreciation/itc tables
	state_federal_depreciation_tables();
};	

cashflow{ 'Leveraged Partnership Flip' } = define()
{
	cfline("Project Revenue",0);

    	tech = technology();

    	fueltech = ( tech != 'Flat Plate PV' && 
                 tech != 'PVWatts' && 
                 tech != 'High-X Concentrating PV' && 
                 tech != 'Solar Water Heating' && 
                 tech != 'Wind Power');
    
	cfline( 'cf_energy_net', 1); // use one digit
	cfline( 'cf_energy_price');
	cfline( 'cf_energy_value');
	// optional values used for pbi for debt service
	if (value('pbi_fed_for_ds')==1)	cfline( 'cf_pbi_total_fed');
	if (value('pbi_sta_for_ds')==1)	cfline( 'cf_pbi_total_sta');
	if (value('pbi_uti_for_ds')==1)	cfline( 'cf_pbi_total_uti');
	if (value('pbi_oth_for_ds')==1)	cfline( 'cf_pbi_total_oth');

	cfline( 'cf_net_salvage_value');
	cfline( 'cf_total_revenue');

	cfline( '' ); // spacer

	cfline( 'cf_property_tax_assessed_value');

	cfline( '' ); // spacer

	cfline("Project Expenses",0);

	if (value('system_use_recapitalization')) cfline ('capitalization');
	cfline( 'cf_om_fixed_expense,cf_om_production_expense,cf_om_capacity_expense');
	if ( fueltech == true )cfline('cf_om_fuel_expense');
	if ( fueltech == true )cfline( 'cf_om_opt_fuel_1_expense' );
	if ( fueltech == true )cfline( 'cf_om_opt_fuel_2_expense' );
	cfline( 'cf_property_tax_expense');
	cfline( 'cf_insurance_expense');
	cfline( 'cf_operating_expenses');
	cfline( '' ); // spacer
	
	cfline( 'cf_ebitda');
	cfline( '' ); // spacer


	cfline("Project Cash Flow",0);
	cfline("Project Cash Flow from Operating Activities",0);
	cfline( 'cf_ebitda');
	cfline( 'cf_reserve_interest');
	if (value('pbi_fed_for_ds')==0)	cfline( 'cf_pbi_total_fed');
	if (value('pbi_sta_for_ds')==0)	cfline( 'cf_pbi_total_sta');
	if (value('pbi_uti_for_ds')==0)	cfline( 'cf_pbi_total_uti');
	if (value('pbi_oth_for_ds')==0)	cfline( 'cf_pbi_total_oth');
	cfline('project_operating_activities');
	cfline( '' ); // spacer
	cfline( "Cash Flows from Investing Activities", 0);
	cfline( 'sv.purchase_of_property');
	cfline( '' ); // spacer
	cfline( 'cf.project_wcra');
	cfline('cf_project_me1ra');
	cfline('cf_project_me2ra');
	cfline('cf_project_me3ra');
	cfline('cf_project_ra');
	cfline( '' ); // spacer
	cfline('cf_project_me1cs');
	cfline('cf_project_me2cs');
	cfline('cf_project_me3cs');
	cfline('cf_project_mecs');
	cfline( '' ); // spacer
	cfline('cf_project_investing_activities');
	cfline( '' ); // spacer
	cfline( "Project Cash Flows From Financing Activities",0);
	cfline( 'TotalIBI');
	cfline( 'TotalCBI');
	cfline( 'issuance_of_equity');
	cfline('cf_project_financing_activities');
	cfline( '' ); // spacer
	cfline('cf_pretax_cashflow');
	cfline( '' ); // spacer
	cfline( 'Total Project Returns');
	cfline( 'Pre-Tax');
	cfline('cf_project_return_pretax');
	cfline('cf_project_return_pretax_irr');
	cfline('cf_project_return_pretax_npv');
	cfline( '' ); // spacer
	cfline( 'After-Tax');
	cfline('cf_project_return_aftertax_cash');
	cfline('cf_project_return_aftertax');
	cfline('cf_project_return_aftertax_irr');
	cfline('cf_project_return_aftertax_npv');
	cfline( '' ); // spacer
	cfline( '' ); // spacer

// LCOE
	cfline( 'LCOE',0);
	cfline('cf_energy_value');
	cfline('cf_energy');
	cfline( 'npv_ppa_revenue');
	cfline( 'npv_energy_nom');
	cfline( 'lcoe_nom');
	cfline( 'npv_energy_real');
	cfline( 'lcoe_real');
	cfline( '' ); // spacer


	cfline( 'Tax Invester Pre-tax Returns',0);
	cfline('cf_tax_investor_pretax');//"Total tax investor pre-tax returns");
	cfline('cf_tax_investor_pretax_irr');//"Tax investor cumulative IRR");
	cfline('cf_tax_investor_pretax_npv');//"Tax investor cumulative NPV");
	cfline( '' ); // spacer
	cfline( 'Tax Invester After-tax Returns',0);
	cfline('cf_tax_investor_aftertax_cash');//"Tax investor cash (total pre-tax returns)");
	cfline('cf_tax_investor_aftertax_itc');//"ITC");
	cfline('cf_tax_investor_aftertax_ptc');//"PTC");
	cfline('cf_tax_investor_aftertax_tax');//Tax investor share of project tax");
	cfline('cf_tax_investor_aftertax');//Total tax investor after-tax returns");
	cfline('cf_tax_investor_aftertax_irr');//Tax investor cumulative IRR");
	cfline('cf_tax_investor_aftertax_npv');//Tax investor cumulative NPV");
	cfline('cf_tax_investor_aftertax_max_irr');//Tax investor maximum IRR");
	cfline( '' ); // spacer

	cfline('Developer Pre-tax Returns',0);
	cfline('sponsor_pretax_equity');//"Developer Pre-tax Returns");
	cfline('sponsor_pretax_development');//"Pre-tax development fee");
	cfline('cf_sponsor_pretax');//"Total developer pre-tax returns");
	cfline('cf_sponsor_pretax_irr');//"Developer pre-tax cumulative IRR");
	cfline('cf_sponsor_pretax_npv');//"Developer pre-tax cumulative NPV");
	cfline('sponsor_pretax_irr');//"Developer pre-tax IRR");
	cfline('sponsor_pretax_npv');//"Developer pre-tax NPV");
	cfline( '' ); // spacer
	cfline( 'Developer After-tax Returns',0);
	cfline('sponsor_aftertax_equity');//"Equity Investment");
	cfline('sponsor_aftertax_development');//"Development Fee");
	cfline('cf_sponsor_aftertax_cash');//"Cash");
	cfline('cf_sponsor_aftertax_itc');//"ITC");
	cfline('cf_sponsor_aftertax_ptc');//"PTC");
	cfline('cf_sponsor_aftertax_tax');//"Developer share of project tax");
	cfline('cf_sponsor_aftertax');//"Total developer after-tax returns");
	cfline('cf_sponsor_aftertax_irr');//"Developer after-tax cumulative IRR");
	cfline('cf_sponsor_aftertax_npv');//"Developer after-tax cumulative NPV");
	cfline('sponsor_aftertax_irr');//"Developer after-tax IRR");
	cfline('sponsor_aftertax_npv');//"Developer after-tax NPV");
	cfline( '' ); // spacer



	// incentives
	cfline( 'Incentives');
	setup_incentives_cashflow();
	cfline( '' ); // spacer

	// debt
	cfline( 'Debt');
	cfline( 'sv.total_debt');
	cfline('cf_debt_payment_principal');
	cfline('cf_debt_balance');
	cfline( '' ); // spacer
	cfline('cf_debt_payment_principal');
	cfline('cf_debt_payment_interest');
	cfline('cf_debt_payment_total');
	cfline( '' ); // spacer
	

	// reserve accounts
	cfline( 'Reserve Accounts');
	cfline('cf_reserve_debtservice');
	cfline('cf_reserve_om');
	cfline('cf_reserve_equip1');
	cfline('cf_reserve_equip2');
	cfline('cf_reserve_equip3');
	cfline( '' ); // spacer
	cfline( '' ); // spacer

	// state and federal depreciation/itc tables
	state_federal_depreciation_tables();
};

cashflow{ 'Sale Leaseback' } = define()
{
	cfline('Partial Income Statement: Project',0);
   	tech = technology();

    	fueltech = ( tech != 'Flat Plate PV' && 
                 tech != 'PVWatts' && 
                 tech != 'High-X Concentrating PV' && 
                 tech != 'Solar Water Heating' && 
                 tech != 'Wind Power');
    
	cfline( 'cf_energy_net'); // use one digit
	cfline( 'cf_energy_price');
	cfline( 'cf_energy_value');
	cfline( 'cf_net_salvage_value');

	cfline( 'cf_total_revenue');

	cfline( '' ); // spacer

	cfline( 'cf_property_tax_assessed_value');

	cfline( '' ); // spacer

	cfline( "Expenses", 0 ); // header	
	if (value('system_use_recapitalization')) cfline ('capitalization');
	cfline( 'cf_om_fixed_expense,cf_om_production_expense,cf_om_capacity_expense');
	if ( fueltech == true )cfline('cf_om_fuel_expense');
	if ( fueltech == true )cfline( 'cf_om_opt_fuel_1_expense' );
	if ( fueltech == true )cfline( 'cf_om_opt_fuel_2_expense' );
	cfline( 'cf_property_tax_expense');
	cfline( 'cf_insurance_expense');
	cfline( 'cf_operating_expenses');
	cfline( '' ); // spacer

	cfline('cf_sponsor_operating_margin');
	cfline('');


	cfline('Cash Flow: Developer (Lessee LLC)',0);
	cfline('Cash Flows from Operating Activities',0);
	cfline('cf_sponsor_operating_margin');
	cfline('cf_reserve_interest');
	cfline('cf_sponsor_operating_activities');
	cfline('');
	cfline('Cash Flows from Investing Activities',0);
	cfline('sale_of_property');
	cfline('purchase_of_plant');
	cfline('distribution_of_development_fee');
	cfline('cf_net_salvage_value',-1,-1.0);
	cfline('');
	cfline('cf_sponsor_wcra');
	cfline('cf_sponsor_me1ra');
	cfline('cf_sponsor_me2ra');
	cfline('cf_sponsor_me3ra');
	cfline('cf_sponsor_ra');
	cfline('');
	cfline('cf_sponsor_me1cs');
	cfline('cf_sponsor_me2cs');
	cfline('cf_sponsor_me3cs');
	cfline('cf_sponsor_mecs');
	cfline('');
	cfline('cf_sponsor_investing_activities');
	cfline('');
	cfline('Cash Flows from Financing Activities',0);
	cfline('sponsor_equity_in_lessee_llc');
	cfline('cf_sponsor_financing_activities');
	cfline('cf_pretax_cashflow');
	cfline('cf_sponsor_adj_reserve_release');
	cfline('cf_pretax_operating_cashflow');
	cfline('');

	cfline('Cash Flow: Tax Investor (Lessor)',0);
	cfline('Cash Flows from Operating Activities',0);
	cfline('cf_pretax_operating_cashflow');
	cfline('cf_tax_investor_operating_activities');
	cfline('');
	cfline('Cash Flows from Investing Activities',0);
	cfline('sale_of_property', -1, -1.0);
	cfline('cf_net_salvage_value');
	cfline('cf_tax_investor_investing_activities');
	cfline('');
	cfline('Cash Flows from Financing Activities',0);
	cfline('issuance_of_equity');
	cfline('TotalIBI');
	cfline('TotalCBI');
	cfline('cf_tax_investor_financing_activities');
	cfline('');
	cfline('cf_tax_investor_pretax_cashflow');
	cfline('');
	cfline('');

// LCOE
	cfline('LCOE',0);
	cfline('cf_energy_value');
	cfline('cf_energy');
	cfline('npv_ppa_revenue');
	cfline('npv_energy_nom');
	cfline('lcoe_nom');
	cfline('npv_energy_real');
	cfline('lcoe_real');
	cfline('');

	cfline('Party Returns',0);
	cfline('Tax Investor (Lessor)',0);
	cfline('Pre-Tax',0);
	cfline('sale_of_property',-1, -1.0);
	cfline('TotalIBI');
	cfline('TotalCBI');
	cfline('cf_net_salvage_value');
	cfline('cf_pretax_operating_cashflow');
	cfline('cf_tax_investor_pretax');
	cfline('cf_tax_investor_pretax_irr');
	cfline('cf_tax_investor_pretax_npv');
	cfline('');
	cfline('After-Tax',0);
	cfline('Cash',0);
	cfline('sale_of_property',-1, -1.0);
	cfline('TotalIBI');
	cfline('TotalCBI');
	cfline('cf_net_salvage_value');
	cfline('cf_pretax_operating_cashflow');
	cfline('cf_tax_investor_aftertax_cash');
	cfline('cf_tax_investor_aftertax_itc');
	cfline('cf_tax_investor_aftertax_ptc');
	cfline('cf_tax_investor_aftertax_tax');
	cfline('cf_tax_investor_aftertax');
	cfline('cf_tax_investor_aftertax_irr');
	cfline('cf_tax_investor_aftertax_npv');
	cfline('cf_tax_investor_aftertax_max_irr');
	cfline('');

	cfline('Developer (Lessee LLC)',0);
	cfline('Pre-Tax',0);
	cfline('sponsor_equity_in_lessee_llc');
	cfline('distribution_of_development_fee');
	cfline('cf_disbursement_merr');
	cfline('cf_disbursement_om');
	cfline('cf_disbursement_leasepayment');
	cfline('cf_reserve_leasepayment_interest');
	cfline('cf_sponsor_margin');
	cfline('cf_sponsor_pretax');
	cfline('cf_sponsor_pretax_irr');
	cfline('cf_sponsor_pretax_npv');
	cfline('sponsor_pretax_irr');
	cfline('sponsor_pretax_npv", dp, r++, 0,"NPV',0);
	cfline('');
	cfline('After-Tax',0);
	cfline('Cash',0);
	cfline('sponsor_equity_in_lessee_llc');
	cfline('distribution_of_development_fee');
	cfline('cf_disbursement_merr');
	cfline('cf_disbursement_om');
	cfline('cf_disbursement_leasepayment');
	cfline('cf_reserve_leasepayment_interest');
	cfline('cf_sponsor_margin');
	cfline('cf_sponsor_aftertax_cash');
	cfline('cf_sponsor_aftertax_tax');
	cfline('cf_sponsor_aftertax_devfee');
	cfline('cf_sponsor_aftertax');
	cfline('cf_sponsor_aftertax_irr');
	cfline('cf_sponsor_aftertax_npv');
	cfline('sponsor_aftertax_irr');
	cfline('sponsor_aftertax_npv');
	cfline('');


	// incentives
	cfline( 'Incentives');
	setup_incentives_cashflow();
	cfline( '' ); // spacer

	// reserve accounts
	cfline( 'Reserve Accounts');
	cfline('cf_reserve_debtservice');
	cfline('cf_reserve_om');
	cfline('cf_reserve_equip1');
	cfline('cf_reserve_equip2');
	cfline('cf_reserve_equip3');
	cfline( '' ); // spacer
	cfline( '' ); // spacer

	// state and federal depreciation/itc tables
	state_federal_depreciation_tables();
};

function send_excel( xl, variable)
{
	xl_set( xl, value(variable), variable );
}

function send_excel_yesno( xl, variable )
{
	y_n = 'No';
	if ( value(variable) == 1 ) y_n = 'Yes';
	xl_set( xl, y_n, variable );
}

function send_excel_depr( xl, variable )
{
	depr = '5-yr MACRS';
	if ( value(variable) == 1 ) depr = '15-yr MACRS';
	elseif ( value(variable) == 2 ) depr = '5-yr SL';
	elseif ( value(variable) == 3 ) depr = '15-yr SL';
	elseif ( value(variable) == 4 ) depr = '20-yr SL';
	elseif ( value(variable) == 5 ) depr = '39-yr SL';
	elseif ( value(variable) == 6 ) depr = 'Custom';
	xl_set( xl, depr, variable );
}

function cashflow_to_excel_incentives(xl)
{
	// incentives section 
	xl_set( xl, (${cbi_fed_deprbas_fed}?'x':''), 'inFedCBIITCBasisFed');
	xl_set( xl, (${cbi_fed_deprbas_sta}?'x':''), 'inFedCBIITCBasisState');
	xl_set( xl, (${cbi_sta_deprbas_fed}?'x':''), 'inStateCBIITCBasisFed');
	xl_set( xl, (${cbi_sta_deprbas_sta}?'x':''), 'inStateCBIITCBasisState');
	xl_set( xl, (${cbi_uti_deprbas_fed}?'x':''), 'inUtilityCBIITCBasisFed');
	xl_set( xl, (${cbi_uti_deprbas_sta}?'x':''), 'inUtilityCBIITCBasisState');
	xl_set( xl, (${cbi_oth_deprbas_fed}?'x':''), 'inOtherCBIITCBasisFed');
	xl_set( xl, (${cbi_oth_deprbas_sta}?'x':''), 'inOtherCBIITCBasisState');
} 

cashflow_to_excel{ 'Single Owner' } = define() 
{
	source = runtimedir() + 'spreadsheets/single_owner.xlsm';
    destination = userlocaldatadir() + "/"+ case_name() + '.xlsm';

	destination = copy_file( source, destination );
	
	xlsm = xl_create( destination );

	// need year 1 energy to calculate out year energy from degradation in workbook
	ae = alloc(${analysis_period}); //array of length analysis_period
	for(i=0;i<#ae;i++)	{
		ae[i] = output('annual_energy');	}
	xl_set( xlsm, ae[0], 'AnnualEnergyYear1' );

	// degradation in sam may be specified as single value or schedule
	degrad = ${degradation};
	degradsched = alloc(${analysis_period});
	if (#degrad == 1)
	  for (i=0;i<#degradsched;i++)
	    degradsched[i] = degrad;
	else
	  degradsched = degrad;  
    xl_set( xlsm, degradsched, 'Degradation' );
	
	send_excel(       xlsm, 'analysis_period');
	send_excel(       xlsm, 'cbi_fed_amount');
	send_excel_yesno( xlsm, 'cbi_fed_deprbas_fed');
	send_excel_yesno( xlsm, 'cbi_fed_deprbas_sta');
	send_excel(       xlsm, 'cbi_fed_maxvalue');
	send_excel_yesno( xlsm, 'cbi_fed_tax_fed');
	send_excel_yesno( xlsm, 'cbi_fed_tax_sta');
	send_excel(       xlsm, 'cbi_oth_amount');
	send_excel_yesno( xlsm, 'cbi_oth_deprbas_fed');
	send_excel_yesno( xlsm, 'cbi_oth_deprbas_sta');
	send_excel(       xlsm, 'cbi_oth_maxvalue');
	send_excel_yesno( xlsm, 'cbi_oth_tax_fed');
	send_excel_yesno( xlsm, 'cbi_oth_tax_sta');
	send_excel(       xlsm, 'cbi_sta_amount');
	send_excel_yesno( xlsm, 'cbi_sta_deprbas_fed');
	send_excel_yesno( xlsm, 'cbi_sta_deprbas_sta');
	send_excel(       xlsm, 'cbi_sta_maxvalue');
	send_excel_yesno( xlsm, 'cbi_sta_tax_fed');
	send_excel_yesno( xlsm, 'cbi_sta_tax_sta');
	send_excel(       xlsm, 'cbi_uti_amount');
	send_excel_yesno( xlsm, 'cbi_uti_deprbas_fed');
	send_excel_yesno( xlsm, 'cbi_uti_deprbas_sta');
	send_excel(       xlsm, 'cbi_uti_maxvalue');
	send_excel_yesno( xlsm, 'cbi_uti_tax_fed');
	send_excel_yesno( xlsm, 'cbi_uti_tax_sta');
	send_excel(       xlsm, 'construction_financing_cost');
	send_excel(       xlsm, 'cost_debt_closing');
	send_excel(       xlsm, 'cost_debt_fee');
	send_excel(       xlsm, 'cost_other_financing');
	send_excel(       xlsm, 'degradation');
	send_excel(       xlsm, 'depr_alloc_macrs_15_percent');
	send_excel(       xlsm, 'depr_alloc_macrs_5_percent');
	send_excel(       xlsm, 'depr_alloc_sl_15_percent');
	send_excel(       xlsm, 'depr_alloc_sl_20_percent');
	send_excel(       xlsm, 'depr_alloc_sl_39_percent');
	send_excel(       xlsm, 'depr_alloc_sl_5_percent');
	send_excel(       xlsm, 'depr_bonus_fed');
	send_excel(       xlsm, 'depr_bonus_fed_macrs_15');
	send_excel(       xlsm, 'depr_bonus_fed_macrs_5');
	send_excel(       xlsm, 'depr_bonus_fed_sl_15');
	send_excel(       xlsm, 'depr_bonus_fed_sl_20');
	send_excel(       xlsm, 'depr_bonus_fed_sl_39');
	send_excel(       xlsm, 'depr_bonus_fed_sl_5');
	send_excel(       xlsm, 'depr_bonus_sta');
	send_excel(       xlsm, 'depr_bonus_sta_macrs_15');
	send_excel(       xlsm, 'depr_bonus_sta_macrs_5');
	send_excel(       xlsm, 'depr_bonus_sta_sl_15');
	send_excel(       xlsm, 'depr_bonus_sta_sl_20');
	send_excel(       xlsm, 'depr_bonus_sta_sl_39');
	send_excel(       xlsm, 'depr_bonus_sta_sl_5');
	send_excel(       xlsm, 'depr_itc_fed_macrs_15');
	send_excel(       xlsm, 'depr_itc_fed_macrs_5');
	send_excel(       xlsm, 'depr_itc_fed_sl_15');
	send_excel(       xlsm, 'depr_itc_fed_sl_20');
	send_excel(       xlsm, 'depr_itc_fed_sl_39');
	send_excel(       xlsm, 'depr_itc_fed_sl_5');
	send_excel(       xlsm, 'depr_itc_sta_macrs_15');
	send_excel(       xlsm, 'depr_itc_sta_macrs_5');
	send_excel(       xlsm, 'depr_itc_sta_sl_15');
	send_excel(       xlsm, 'depr_itc_sta_sl_20');
	send_excel(       xlsm, 'depr_itc_sta_sl_39');
	send_excel(       xlsm, 'depr_itc_sta_sl_5');
	send_excel(       xlsm, 'DeprAllocNone');
	send_excel(       xlsm, 'dscr');
	send_excel(       xlsm, 'dscr_reserve_months');
	send_excel_depr(  xlsm, 'equip_reserve_depr_fed');
	send_excel_depr(  xlsm, 'equip_reserve_depr_sta');
	send_excel(       xlsm, 'equip1_reserve_cost');
	send_excel(       xlsm, 'equip1_reserve_freq');
	send_excel(       xlsm, 'equip2_reserve_cost');
	send_excel(       xlsm, 'equip2_reserve_freq');
	send_excel(       xlsm, 'equip3_reserve_cost');
	send_excel(       xlsm, 'equip3_reserve_freq');
	send_excel(       xlsm, 'federal_tax_rate');
	send_excel(       xlsm, 'flip_target_percent');
	send_excel(       xlsm, 'flip_target_year');
	send_excel(       xlsm, 'ibi_fed_amount');
	send_excel_yesno( xlsm, 'ibi_fed_amount_deprbas_fed');
	send_excel_yesno( xlsm, 'ibi_fed_amount_deprbas_sta');
	send_excel(       xlsm, 'ibi_fed_amount_tax_fed');
	send_excel(       xlsm, 'ibi_fed_amount_tax_sta');
	send_excel(       xlsm, 'ibi_fed_percent');
	send_excel_yesno( xlsm, 'ibi_fed_percent_deprbas_fed');
	send_excel_yesno( xlsm, 'ibi_fed_percent_deprbas_sta');
	send_excel(       xlsm, 'ibi_fed_percent_maxvalue');
	send_excel(       xlsm, 'ibi_fed_percent_tax_fed');
	send_excel(       xlsm, 'ibi_fed_percent_tax_sta');
	send_excel(       xlsm, 'ibi_oth_amount');
	send_excel_yesno( xlsm, 'ibi_oth_amount_deprbas_fed');
	send_excel_yesno( xlsm, 'ibi_oth_amount_deprbas_sta');
	send_excel(       xlsm, 'ibi_oth_amount_tax_fed');
	send_excel(       xlsm, 'ibi_oth_amount_tax_sta');
	send_excel(       xlsm, 'ibi_oth_percent');
	send_excel_yesno( xlsm, 'ibi_oth_percent_deprbas_fed');
	send_excel_yesno( xlsm, 'ibi_oth_percent_deprbas_sta');
	send_excel(       xlsm, 'ibi_oth_percent_maxvalue');
	send_excel(       xlsm, 'ibi_oth_percent_tax_fed');
	send_excel(       xlsm, 'ibi_oth_percent_tax_sta');
	send_excel(       xlsm, 'ibi_sta_amount');
	send_excel_yesno( xlsm, 'ibi_sta_amount_deprbas_fed');
	send_excel_yesno( xlsm, 'ibi_sta_amount_deprbas_sta');
	send_excel(       xlsm, 'ibi_sta_amount_tax_fed');
	send_excel(       xlsm, 'ibi_sta_amount_tax_sta');
	send_excel(       xlsm, 'ibi_sta_percent');
	send_excel_yesno( xlsm, 'ibi_sta_percent_deprbas_fed');
	send_excel_yesno( xlsm, 'ibi_sta_percent_deprbas_sta');
	send_excel(       xlsm, 'ibi_sta_percent_maxvalue');
	send_excel(       xlsm, 'ibi_sta_percent_tax_fed');
	send_excel(       xlsm, 'ibi_sta_percent_tax_sta');
	send_excel(       xlsm, 'ibi_uti_amount');
	send_excel_yesno( xlsm, 'ibi_uti_amount_deprbas_fed');
	send_excel_yesno( xlsm, 'ibi_uti_amount_deprbas_sta');
	send_excel(       xlsm, 'ibi_uti_amount_tax_fed');
	send_excel(       xlsm, 'ibi_uti_amount_tax_sta');
	send_excel(       xlsm, 'ibi_uti_percent');
	send_excel_yesno( xlsm, 'ibi_uti_percent_deprbas_fed');
	send_excel_yesno( xlsm, 'ibi_uti_percent_deprbas_sta');
	send_excel(       xlsm, 'ibi_uti_percent_maxvalue');
	send_excel(       xlsm, 'ibi_uti_percent_tax_fed');
	send_excel(       xlsm, 'ibi_uti_percent_tax_sta');
	send_excel(       xlsm, 'inflation_rate');
	send_excel(       xlsm, 'insurance_rate');
	send_excel(       xlsm, 'itc_fed_amount');
	send_excel_yesno( xlsm, 'itc_fed_amount_deprbas_fed');
	send_excel_yesno( xlsm, 'itc_fed_amount_deprbas_sta');
	send_excel(       xlsm, 'itc_fed_percent');
	send_excel_yesno( xlsm, 'itc_fed_percent_deprbas_fed');
	send_excel_yesno( xlsm, 'itc_fed_percent_deprbas_sta');
	send_excel(       xlsm, 'itc_fed_percent_maxvalue');
	send_excel(       xlsm, 'itc_sta_amount');
	send_excel_yesno( xlsm, 'itc_sta_amount_deprbas_fed');
	send_excel_yesno( xlsm, 'itc_sta_amount_deprbas_sta');
	send_excel(       xlsm, 'itc_sta_percent');
	send_excel_yesno( xlsm, 'itc_sta_percent_deprbas_fed');
	send_excel_yesno( xlsm, 'itc_sta_percent_deprbas_sta');
	send_excel(       xlsm, 'itc_sta_percent_maxvalue');
	send_excel(       xlsm, 'months_working_reserve');
	send_excel(       xlsm, 'NominalDiscountRate');
	send_excel(       xlsm, 'om_capacity');
	send_excel(       xlsm, 'om_capacity_escal');
	send_excel(       xlsm, 'om_fixed');
	send_excel(       xlsm, 'om_fixed_escal');
	send_excel(       xlsm, 'om_fuel_cost');
	send_excel(       xlsm, 'om_fuel_cost_escal');
	send_excel(       xlsm, 'om_production');
	send_excel(       xlsm, 'om_production_escal');
	send_excel(       xlsm, 'pbi_fed_amount');
	send_excel(       xlsm, 'pbi_fed_escal');
	send_excel_yesno( xlsm, 'pbi_fed_for_ds');
	send_excel_yesno( xlsm, 'pbi_fed_tax_fed');
	send_excel_yesno( xlsm, 'pbi_fed_tax_sta');
	send_excel(       xlsm, 'pbi_fed_term');
	send_excel(       xlsm, 'pbi_oth_amount');
	send_excel(       xlsm, 'pbi_oth_escal');
	send_excel_yesno( xlsm, 'pbi_oth_for_ds');
	send_excel_yesno( xlsm, 'pbi_oth_tax_fed');
	send_excel_yesno( xlsm, 'pbi_oth_tax_sta');
	send_excel(       xlsm, 'pbi_oth_term');
	send_excel(       xlsm, 'pbi_sta_amount');
	send_excel(       xlsm, 'pbi_sta_escal');
	send_excel_yesno( xlsm, 'pbi_sta_for_ds');
	send_excel_yesno( xlsm, 'pbi_sta_tax_fed');
	send_excel_yesno( xlsm, 'pbi_sta_tax_sta');
	send_excel(       xlsm, 'pbi_sta_term');
	send_excel(       xlsm, 'pbi_uti_amount');
	send_excel(       xlsm, 'pbi_uti_escal');
	send_excel_yesno( xlsm, 'pbi_uti_for_ds');
	send_excel_yesno( xlsm, 'pbi_uti_tax_fed');
	send_excel_yesno( xlsm, 'pbi_uti_tax_sta');
	send_excel(       xlsm, 'pbi_uti_term');
	send_excel(       xlsm, 'ppa_escalation');
	send_excel(       xlsm, 'prop_tax_assessed_decline');
	send_excel(       xlsm, 'prop_tax_cost_assessed_percent');
	send_excel(       xlsm, 'property_tax_rate');
	send_excel(       xlsm, 'ptc_fed_amount');
	send_excel(       xlsm, 'ptc_fed_term');
	send_excel(       xlsm, 'ptc_sta_amount');
	send_excel(       xlsm, 'ptc_sta_term');
	send_excel(       xlsm, 'real_discount_rate');
	send_excel(       xlsm, 'reserves_interest');
	send_excel(       xlsm, 'sales_tax_rate');
	send_excel(       xlsm, 'salvage_percentage');
	send_excel(       xlsm, 'state_tax_rate');
	send_excel(       xlsm, 'system_capacity');
	send_excel(       xlsm, 'system_heat_rate');
	send_excel(       xlsm, 'term_int_rate');
	send_excel(       xlsm, 'term_tenor');
	send_excel(       xlsm, 'total_installed_cost');

	xl_free( xlsm );
};

cashflow_to_excel{ 'Independent Power Producer' } = define() 
{
	source = runtimedir() + 'spreadsheets/utility_ipp.xls';
	destination = userlocaldatadir() + "/"+ case_name() + '.xls';
	
	destination = copy_file( source, destination );
	
	xl = xl_create( destination );
	xl_set( xl, ${analysis_period}, 'inAnalysisPeriod' );
	// annual energy for degradation to be applied in spreadsheet
	ae = alloc(${analysis_period});
	for(i=0;i<#ae;i++)	{
		ae[i] = output('annual_energy');	}
	xl_set( xl, ae, 'inSystemOutput' );
//	xl_set( xl, output('cf_energy_net'), 'inSystemOutput' );
	xl_set( xl, output('cf_energy_value'), 'inEnergyValue' );
	
	// for single value or schedule items
	degrad = ${degradation};
//	xl_set( xl, degrad, 'inDegradation' );
	xl_set( xl, ((#degrad == 1) ? degrad[0]/100 : 1), 'inDegradation' );
	xl_set( xl, ((#degrad == 1) ? 0 : output('cf_degradation')), 'inDegradationSched' );
	
	cashflow_to_excel_incentives(xl);

	xl_free( xl );
};