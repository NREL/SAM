
// setup cashflow tables////////////////////////////////////////////////////////
function state_federal_depreciation_tables()
{
	cfrow("% of Total Depreciable Basis,Gross Amount Allocated,Reduction: IBI,Reduction: CBI,Depreciable Basis Prior to ITC,ITC Qualifying Costs,% of ITC Qualifying Costs,ITC Amount,ITC Basis Disallowance,ITC Amount	,ITC Basis Disallowance,ITC Reduction: State,ITC Reduction: Federal,Depreciable Basis After ITC Reduction,First Year Bonus Depreciation,Depreciable Basis After Bonus Reduction",-1);
	
	cfrow("State Depreciation & ITC",0);
	cfrow("5-yr MACRS,depr_stabas_percent_macrs_5,depr_alloc_macrs_5,depr_stabas_ibi_reduc_macrs_5,depr_stabas_cbi_reduc_macrs_5,depr_stabas_prior_itc_macrs_5,itc_sta_qual_macrs_5,depr_stabas_percent_qual_macrs_5,depr_stabas_percent_amount_macrs_5,itc_disallow_sta_percent_macrs_5,depr_stabas_fixed_amount_macrs_5,itc_disallow_sta_fixed_macrs_5,depr_stabas_itc_sta_reduction_macrs_5,depr_stabas_itc_fed_reduction_macrs_5,depr_stabas_after_itc_macrs_5,depr_stabas_first_year_bonus_macrs_5,depr_stabas_macrs_5");
	cfrow("15-yr MACRS,depr_stabas_percent_macrs_15,depr_alloc_macrs_15,depr_stabas_ibi_reduc_macrs_15,depr_stabas_cbi_reduc_macrs_15,depr_stabas_prior_itc_macrs_15,itc_sta_qual_macrs_15,depr_stabas_percent_qual_macrs_15,depr_stabas_percent_amount_macrs_15,itc_disallow_sta_percent_macrs_15,depr_stabas_fixed_amount_macrs_15,itc_disallow_sta_fixed_macrs_15,depr_stabas_itc_sta_reduction_macrs_15,depr_stabas_itc_fed_reduction_macrs_15,depr_stabas_after_itc_macrs_15,depr_stabas_first_year_bonus_macrs_15,depr_stabas_macrs_15");
	cfrow("5-yr Straight Line,depr_stabas_percent_sl_5,depr_alloc_sl_5,depr_stabas_ibi_reduc_sl_5,depr_stabas_cbi_reduc_sl_5,depr_stabas_prior_itc_sl_5,itc_sta_qual_sl_5,depr_stabas_percent_qual_sl_5,depr_stabas_percent_amount_sl_5,itc_disallow_sta_percent_sl_5,depr_stabas_fixed_amount_sl_5,itc_disallow_sta_fixed_sl_5,depr_stabas_itc_sta_reduction_sl_5,depr_stabas_itc_fed_reduction_sl_5,depr_stabas_after_itc_sl_5,depr_stabas_first_year_bonus_sl_5,depr_stabas_sl_5");
	cfrow("15-yr Straight Line,depr_stabas_percent_sl_15,depr_alloc_sl_15,depr_stabas_ibi_reduc_sl_15,depr_stabas_cbi_reduc_sl_15,depr_stabas_prior_itc_sl_15,itc_sta_qual_sl_15,depr_stabas_percent_qual_sl_15,depr_stabas_percent_amount_sl_15,itc_disallow_sta_percent_sl_15,depr_stabas_fixed_amount_sl_15,itc_disallow_sta_fixed_sl_15,depr_stabas_itc_sta_reduction_sl_15,depr_stabas_itc_fed_reduction_sl_15,depr_stabas_after_itc_sl_15,depr_stabas_first_year_bonus_sl_15,depr_stabas_sl_15");
	cfrow("20-yr Straight Line,depr_stabas_percent_sl_20,depr_alloc_sl_20,depr_stabas_ibi_reduc_sl_20,depr_stabas_cbi_reduc_sl_20,depr_stabas_prior_itc_sl_20,itc_sta_qual_sl_20,depr_stabas_percent_qual_sl_20,depr_stabas_percent_amount_sl_20,itc_disallow_sta_percent_sl_20,depr_stabas_fixed_amount_sl_20,itc_disallow_sta_fixed_sl_20,depr_stabas_itc_sta_reduction_sl_20,depr_stabas_itc_fed_reduction_sl_20,depr_stabas_after_itc_sl_20,depr_stabas_first_year_bonus_sl_20,depr_stabas_sl_20");
	cfrow("39-yr Straight Line,depr_stabas_percent_sl_39,depr_alloc_sl_39,depr_stabas_ibi_reduc_sl_39,depr_stabas_cbi_reduc_sl_39,depr_stabas_prior_itc_sl_39,itc_sta_qual_sl_39,depr_stabas_percent_qual_sl_39,depr_stabas_percent_amount_sl_39,itc_disallow_sta_percent_sl_39,depr_stabas_fixed_amount_sl_39,itc_disallow_sta_fixed_sl_39,depr_stabas_itc_sta_reduction_sl_39,depr_stabas_itc_fed_reduction_sl_39,depr_stabas_after_itc_sl_39,depr_stabas_first_year_bonus_sl_39,depr_stabas_sl_39");
	cfrow("Custom,depr_stabas_percent_custom,depr_alloc_custom,depr_stabas_ibi_reduc_custom,depr_stabas_cbi_reduc_custom,depr_stabas_prior_itc_custom,itc_sta_qual_custom,depr_stabas_percent_qual_custom,depr_stabas_percent_amount_custom,itc_disallow_sta_percent_custom,depr_stabas_fixed_amount_custom,itc_disallow_sta_fixed_custom,depr_stabas_itc_sta_reduction_custom,depr_stabas_itc_fed_reduction_custom,depr_stabas_after_itc_custom,depr_stabas_first_year_bonus_custom,depr_stabas_custom");
	cfrow("Total,depr_stabas_percent_total,depr_alloc_total,depr_stabas_ibi_reduc_total,depr_stabas_cbi_reduc_total,depr_stabas_prior_itc_total,itc_sta_qual_total,depr_stabas_percent_qual_total,depr_stabas_percent_amount_total,itc_disallow_sta_percent_total,depr_stabas_fixed_amount_total,itc_disallow_sta_fixed_total,depr_stabas_itc_sta_reduction_total,depr_stabas_itc_fed_reduction_total,depr_stabas_after_itc_total,depr_stabas_first_year_bonus_total,depr_stabas_total");
	
	cfrow("Federal Depreciation & ITC",0);
	cfrow("5-yr MACRS,depr_fedbas_percent_macrs_5,depr_alloc_macrs_5,depr_fedbas_ibi_reduc_macrs_5,depr_fedbas_cbi_reduc_macrs_5,depr_fedbas_prior_itc_macrs_5,itc_fed_qual_macrs_5,depr_fedbas_percent_qual_macrs_5,depr_fedbas_percent_amount_macrs_5,itc_disallow_fed_percent_macrs_5,depr_fedbas_fixed_amount_macrs_5,itc_disallow_fed_fixed_macrs_5,depr_fedbas_itc_fed_reduction_macrs_5,depr_fedbas_itc_fed_reduction_macrs_5,depr_fedbas_after_itc_macrs_5,depr_fedbas_first_year_bonus_macrs_5,depr_fedbas_macrs_5");
	cfrow("15-yr MACRS,depr_fedbas_percent_macrs_15,depr_alloc_macrs_15,depr_fedbas_ibi_reduc_macrs_15,depr_fedbas_cbi_reduc_macrs_15,depr_fedbas_prior_itc_macrs_15,itc_fed_qual_macrs_15,depr_fedbas_percent_qual_macrs_15,depr_fedbas_percent_amount_macrs_15,itc_disallow_fed_percent_macrs_15,depr_fedbas_fixed_amount_macrs_15,itc_disallow_fed_fixed_macrs_15,depr_fedbas_itc_fed_reduction_macrs_15,depr_fedbas_itc_fed_reduction_macrs_15,depr_fedbas_after_itc_macrs_15,depr_fedbas_first_year_bonus_macrs_15,depr_fedbas_macrs_15");
	cfrow("5-yr Straight Line,depr_fedbas_percent_sl_5,depr_alloc_sl_5,depr_fedbas_ibi_reduc_sl_5,depr_fedbas_cbi_reduc_sl_5,depr_fedbas_prior_itc_sl_5,itc_fed_qual_sl_5,depr_fedbas_percent_qual_sl_5,depr_fedbas_percent_amount_sl_5,itc_disallow_fed_percent_sl_5,depr_fedbas_fixed_amount_sl_5,itc_disallow_fed_fixed_sl_5,depr_fedbas_itc_fed_reduction_sl_5,depr_fedbas_itc_fed_reduction_sl_5,depr_fedbas_after_itc_sl_5,depr_fedbas_first_year_bonus_sl_5,depr_fedbas_sl_5");
	cfrow("15-yr Straight Line,depr_fedbas_percent_sl_15,depr_alloc_sl_15,depr_fedbas_ibi_reduc_sl_15,depr_fedbas_cbi_reduc_sl_15,depr_fedbas_prior_itc_sl_15,itc_fed_qual_sl_15,depr_fedbas_percent_qual_sl_15,depr_fedbas_percent_amount_sl_15,itc_disallow_fed_percent_sl_15,depr_fedbas_fixed_amount_sl_15,itc_disallow_fed_fixed_sl_15,depr_fedbas_itc_fed_reduction_sl_15,depr_fedbas_itc_fed_reduction_sl_15,depr_fedbas_after_itc_sl_15,depr_fedbas_first_year_bonus_sl_15,depr_fedbas_sl_15");
	cfrow("20-yr Straight Line,depr_fedbas_percent_sl_20,depr_alloc_sl_20,depr_fedbas_ibi_reduc_sl_20,depr_fedbas_cbi_reduc_sl_20,depr_fedbas_prior_itc_sl_20,itc_fed_qual_sl_20,depr_fedbas_percent_qual_sl_20,depr_fedbas_percent_amount_sl_20,itc_disallow_fed_percent_sl_20,depr_fedbas_fixed_amount_sl_20,itc_disallow_fed_fixed_sl_20,depr_fedbas_itc_fed_reduction_sl_20,depr_fedbas_itc_fed_reduction_sl_20,depr_fedbas_after_itc_sl_20,depr_fedbas_first_year_bonus_sl_20,depr_fedbas_sl_20");
	cfrow("39-yr Straight Line,depr_fedbas_percent_sl_39,depr_alloc_sl_39,depr_fedbas_ibi_reduc_sl_39,depr_fedbas_cbi_reduc_sl_39,depr_fedbas_prior_itc_sl_39,itc_fed_qual_sl_39,depr_fedbas_percent_qual_sl_39,depr_fedbas_percent_amount_sl_39,itc_disallow_fed_percent_sl_39,depr_fedbas_fixed_amount_sl_39,itc_disallow_fed_fixed_sl_39,depr_fedbas_itc_fed_reduction_sl_39,depr_fedbas_itc_fed_reduction_sl_39,depr_fedbas_after_itc_sl_39,depr_fedbas_first_year_bonus_sl_39,depr_fedbas_sl_39");
	cfrow("Custom,depr_fedbas_percent_custom,depr_alloc_custom,depr_fedbas_ibi_reduc_custom,depr_fedbas_cbi_reduc_custom,depr_fedbas_prior_itc_custom,itc_fed_qual_custom,depr_fedbas_percent_qual_custom,depr_fedbas_percent_amount_custom,itc_disallow_fed_percent_custom,depr_fedbas_fixed_amount_custom,itc_disallow_fed_fixed_custom,depr_fedbas_itc_fed_reduction_custom,depr_fedbas_itc_fed_reduction_custom,depr_fedbas_after_itc_custom,depr_fedbas_first_year_bonus_custom,depr_fedbas_custom");
	cfrow("Total,depr_fedbas_percent_total,depr_alloc_total,depr_fedbas_ibi_reduc_total,depr_fedbas_cbi_reduc_total,depr_fedbas_prior_itc_total,itc_fed_qual_total,depr_fedbas_percent_qual_total,depr_fedbas_percent_amount_total,itc_disallow_fed_percent_total,depr_fedbas_fixed_amount_total,itc_disallow_fed_fixed_total,depr_fedbas_itc_fed_reduction_total,depr_fedbas_itc_fed_reduction_total,depr_fedbas_after_itc_total,depr_fedbas_first_year_bonus_total,depr_fedbas_total");
}


function setup_incentives_cashflow()
{
	cfline( "ibi_total_fed,ibi_total_sta,ibi_total_uti,ibi_total_oth,ibi_total", -1 ); // -1 = use generic format
	cfline( '' ); // spacer 
	cfline( "cbi_total_fed,cbi_total_sta,cbi_total_uti,cbi_total_oth,cbi_total", -1 );
	cfline( '' ); // spacer 
	cfline( "cf_pbi_total_fed,cf_pbi_total_sta,cf_pbi_total_uti,cf_pbi_total_oth,cf_pbi_total", -1 );
	cfline( '' ); // spacer 
	cfline( "cf_ptc_fed,cf_ptc_sta,cf_ptc_total", -1 );
	cfline( '' ); // spacer 
	cfline( "itc_fed_total,itc_sta_total,itc_total", -1 );
	cfline( '' ); // spacer 
}

cashflow{ 'Residential' } = define()
{
	cfline( 'cf_energy_net', 1); // use one digit
	cfline( 'cf_energy_value');
	cfline( '' ); // spacer

	cfline( "Operating Expenses", 0 ); // header	
	cfline( 'cf_om_fixed_expense,cf_om_production_expense,cf_om_capacity_expense,cf_om_fuel_expense');
	cfline( 'cf_om_opt_fuel_1_expense' );
	cfline( 'cf_om_opt_fuel_2_expense' );
	
//	cfline( 'cf_property_tax_assessed_value');
	cfline( 'cf_property_tax_expense');
	cfline( 'cf_insurance_expense');
	cfline( 'cf_net_salvage_value');
	cfline( 'cf_operating_expenses');
	cfline( '' ); // spacer
	
	cfline( 'cf_deductible_expenses');
	cfline( '' ); // spacer
	
	cfline( "Financing", 0 ); // header
	cfline( 'cf_debt_balance');
	cfline( 'cf_debt_payment_interest');
	cfline( 'cf_debt_payment_principal');
	cfline( 'cf_debt_payment_total');

	// incentives
	setup_incentives_cashflow();
	
	cfline( "Tax Effect on Equity (State)", 0 ); // header
	cfline( 'cf_sta_depr_sched');
	cfline( 'cf_sta_depreciation');
	cfline( 'cf_sta_incentive_income_less_deductions');
	cfline( 'cf_sta_taxable_income_less_deductions');
	cfline( 'cf_sta_tax_savings');
	cfline( '' ); // spacer
	
	cfline( "Tax Effect on Equity (Federal)", 0 ); // header
	cfline( 'cf_fed_depr_sched' );
	cfline( 'cf_fed_depreciation');
	cfline( 'cf_fed_incentive_income_less_deductions');
	cfline( 'cf_fed_taxable_income_less_deductions');	
	cfline( 'cf_fed_tax_savings' );
	cfline( '' ); // spacer
	
	cfline( 'cf_after_tax_net_equity_cost_flow');
	cfline( 'cf_after_tax_cash_flow');
};

cashflow{ 'Commercial' } = define()
{
	cfline( 'cf_energy_net', 1); // use one digit
	cfline( 'cf_energy_value');
	cfline( '' ); // spacer

	cfline( "Operating Expenses", 0 ); // header	
	cfline( 'cf_om_fixed_expense,cf_om_production_expense,cf_om_capacity_expense,cf_om_fuel_expense');
	cfline( 'cf_om_opt_fuel_1_expense' );
	cfline( 'cf_om_opt_fuel_2_expense' );
	
//	cfline( 'cf_property_tax_assessed_value');
	cfline( 'cf_property_tax_expense');
	cfline( 'cf_insurance_expense');
	cfline( 'cf_net_salvage_value');
	cfline( 'cf_operating_expenses');
	cfline( '' ); // spacer
	
	cfline( 'cf_deductible_expenses');
	cfline( '' ); // spacer
	
	cfline( "Financing", 0 ); // header
	cfline( 'cf_debt_balance');
	cfline( 'cf_debt_payment_interest');
	cfline( 'cf_debt_payment_principal');
	cfline( 'cf_debt_payment_total');
	
	// incentives
	setup_incentives_cashflow();
	
	cfline( "Tax Effect on Equity (State)", 0 ); // header
	cfline( 'cf_sta_depr_sched');
	cfline( 'cf_sta_depreciation');
	cfline( 'cf_sta_incentive_income_less_deductions');
	cfline( 'cf_sta_taxable_income_less_deductions');
	cfline( 'cf_sta_tax_savings');
	cfline( '' ); // spacer
	
	cfline( "Tax Effect on Equity (Federal)", 0 ); // header
	cfline( 'cf_fed_depr_sched' );
	cfline( 'cf_fed_depreciation');
	cfline( 'cf_fed_incentive_income_less_deductions');
	cfline( 'cf_fed_taxable_income_less_deductions');	
	cfline( 'cf_fed_tax_savings' );
	cfline( '' ); // spacer
	
	cfline( 'cf_after_tax_net_equity_cost_flow');
	cfline( 'cf_after_tax_cash_flow');
};


cashflow{ 'Commercial PPA' } = define()
{
	cfline( 'cf_energy_net', 1); // use one digit
	cfline( 'cf_energy_price');
	cfline( 'cf_energy_value');
	cfline( '' ); // spacer

	cfline( "Operating Expenses", 0 ); // header	
	cfline( 'cf_om_fixed_expense,cf_om_production_expense,cf_om_capacity_expense,cf_om_fuel_expense');
	cfline( 'cf_om_opt_fuel_1_expense' );
	cfline( 'cf_om_opt_fuel_2_expense' );
	
//	cfline( 'cf_property_tax_assessed_value');
	cfline( 'cf_property_tax_expense');
	cfline( 'cf_insurance_expense');
	cfline( 'cf_net_salvage_value');
	cfline( 'cf_operating_expenses');
	cfline( '' ); // spacer
	
	cfline( 'cf_operating_income');
	cfline( '' ); // spacer
	
	cfline( "Financing", 0 ); // header
	cfline( 'cf_debt_balance');
	cfline( 'cf_debt_payment_interest');
	cfline( 'cf_debt_payment_principal');
	cfline( 'cf_debt_payment_total');
	
	// incentives
	setup_incentives_cashflow();
	
	cfline( "Tax Effect on Equity (State)", 0 ); // header
	cfline( 'cf_sta_depr_sched');
	cfline( 'cf_sta_depreciation');
	cfline( 'cf_sta_incentive_income_less_deductions');
	cfline( 'cf_sta_taxable_income_less_deductions');
	cfline( 'cf_sta_tax_savings');
	cfline( '' ); // spacer
	
	cfline( "Tax Effect on Equity (Federal)", 0 ); // header
	cfline( 'cf_fed_depr_sched' );
	cfline( 'cf_fed_depreciation');
	cfline( 'cf_fed_incentive_income_less_deductions');
	cfline( 'cf_fed_taxable_income_less_deductions');	
	cfline( 'cf_fed_tax_savings' );
	cfline( '' ); // spacer
	
	cfline( 'cf_after_tax_net_equity_cash_flow');
	cfline( 'cf_after_tax_net_equity_cost_flow');
	cfline( 'cf_after_tax_cash_flow');
};
cashflow{ 'Independent Power Producer' } = define()
{
	cfline( 'cf_energy_net', 1); // use one digit
	cfline( 'cf_energy_price');
	cfline( 'cf_energy_value');
	cfline( '' ); // spacer

	cfline( "Operating Expenses", 0 ); // header	
	cfline( 'cf_om_fixed_expense,cf_om_production_expense,cf_om_capacity_expense,cf_om_fuel_expense');
	cfline( 'cf_om_opt_fuel_1_expense' );
	cfline( 'cf_om_opt_fuel_2_expense' );
	
//	cfline( 'cf_property_tax_assessed_value');
	cfline( 'cf_property_tax_expense');
	cfline( 'cf_insurance_expense');
	cfline( 'cf_net_salvage_value');
	cfline( 'cf_operating_expenses');
	cfline( '' ); // spacer
	
	cfline( 'cf_operating_income');
	cfline( '' ); // spacer
	
	cfline( "Financing", 0 ); // header
	cfline( 'cf_debt_balance');
	cfline( 'cf_debt_payment_interest');
	cfline( 'cf_debt_payment_principal');
	cfline( 'cf_debt_payment_total');
	
	// incentives
	setup_incentives_cashflow();
	
	cfline( "Tax Effect on Equity (State)", 0 ); // header
	cfline( 'cf_sta_depr_sched');
	cfline( 'cf_sta_depreciation');
	cfline( 'cf_sta_incentive_income_less_deductions');
	cfline( 'cf_sta_taxable_income_less_deductions');
	cfline( 'cf_sta_tax_savings');
	cfline( '' ); // spacer
	
	cfline( "Tax Effect on Equity (Federal)", 0 ); // header
	cfline( 'cf_fed_depr_sched' );
	cfline( 'cf_fed_depreciation');
	cfline( 'cf_fed_incentive_income_less_deductions');
	cfline( 'cf_fed_taxable_income_less_deductions');	
	cfline( 'cf_fed_tax_savings' );
	cfline( '' ); // spacer
	
	cfline( 'cf_after_tax_net_equity_cash_flow');
	cfline( 'cf_after_tax_net_equity_cost_flow');
	cfline( 'cf_after_tax_cash_flow');
};

//TODO - all DHF model updates to 2014.1.14 release
cashflow{ 'Single Owner' } = define()
{
    tech = technology();

    fueltech = ( tech != 'Flat Plate PV' && 
                 tech != 'PVWatts' && 
                 tech != 'High-X Concentrating PV' && 
                 tech != 'Solar Water Heating' && 
                 tech != 'Wind Power');
    
	cfline( 'cf_energy_net', 1); // use one digit
	cfline( 'cf_energy_price');
	cfline( 'cf_energy_value');
	// optional values used for pbi for debt service
	if (value('pbi_fed_for_ds')==1)	cfline( 'cf_pbi_total_fed');
	if (value('pbi_sta_for_ds')==1)	cfline( 'cf_pbi_total_sta');
	if (value('pbi_uti_for_ds')==1)	cfline( 'cf_pbi_total_uti');
	if (value('pbi_oth_for_ds')==1)	cfline( 'cf_pbi_total_oth');

	cfline( 'cf_net_salvage_value');
	cfline( 'cf_total_revenue');

	cfline( '' ); // spacer

	cfline( 'cf_property_tax_assessed_value');

	cfline( '' ); // spacer

	cfline( "Expenses", 0 ); // header	
	if (value('system_use_recapitalization')) cfline ('capitalization');
	cfline( 'cf_om_fixed_expense,cf_om_production_expense,cf_om_capacity_expense');
	if ( fueltech == true )cfline('cf_om_fuel_expense');
	if ( fueltech == true )cfline( 'cf_om_opt_fuel_1_expense' );
	if ( fueltech == true )cfline( 'cf_om_opt_fuel_2_expense' );
	cfline( 'cf_property_tax_expense');
	cfline( 'cf_insurance_expense');
	cfline( 'cf_operating_expenses');
	cfline( '' ); // spacer
	
	cfline( 'cf_ebitda');
	cfline( '' ); // spacer
	
	cfline( "Cash Flows from Operating Activities", 0 ); // header
	cfline( 'cf_reserve_interest');
	if (value('pbi_fed_for_ds')==0)	cfline( 'cf_pbi_total_fed');
	if (value('pbi_sta_for_ds')==0)	cfline( 'cf_pbi_total_sta');
	if (value('pbi_uti_for_ds')==0)	cfline( 'cf_pbi_total_uti');
	if (value('pbi_oth_for_ds')==0)	cfline( 'cf_pbi_total_oth');
	cfline('project_operating_activities');
	cfline( '' ); // spacer

	cfline( "Cash Flows from Investing Activities", 0);
	cfline( 'sv.purchase_of_property');
	cfline( '' ); // spacer
	cfline( 'cf.project_wcra');
	cfline('cf_project_me1ra');
	cfline('cf_project_me2ra');
	cfline('cf_project_me3ra');
	cfline('cf_project_ra');
	cfline( '' ); // spacer
	cfline('cf_project_me1cs');
	cfline('cf_project_me2cs');
	cfline('cf_project_me3cs');
	cfline('cf_project_mecs');
	cfline( '' ); // spacer
	cfline('cf_project_investing_activities');
	cfline( '' ); // spacer

	cfline( 'sv.TotalIBI');
	cfline( 'sv.TotalCBI');
	cfline( 'sv.issuance_of_equity');
	cfline('cf_project_financing_activities');
	cfline( '' ); // spacer
	cfline('cf_pretax_cashflow');
	cfline( '' ); // spacer

	cfline( 'Total Project Returns');
	cfline( 'Pre-Tax');
	cfline('cf_project_return_pretax');
	cfline('cf_project_return_pretax_irr');
	cfline('cf_project_return_pretax_npv');
	cfline( '' ); // spacer
	cfline( 'After-Tax');
	cfline('cf_project_return_aftertax_cash');
	cfline('cf_project_return_aftertax');
	cfline('cf_project_return_aftertax_irr');
	cfline('cf_project_return_aftertax_npv');
	cfline( '' ); // spacer
	cfline( '' ); // spacer

// LCOE
	cfline( 'LCOE');
	cfline('cf_energy_value');
	cfline('cf_energy');
	cfline( 'sv.npv_ppa_revenue');
	cfline( 'sv.npv_energy_nom');
	cfline( 'sv.lcoe_nom');
	cfline( 'sv.npv_energy_real');
	cfline( 'sv.lcoe_real');
	cfline( '' ); // spacer


	// incentives
	cfline( 'Incentives');
	setup_incentives_cashflow();
	cfline( '' ); // spacer

	// debt
	cfline( 'Debt');
	cfline( 'sv.total_debt');
	cfline('cf_debt_payment_principal');
	cfline('cf_debt_balance');
	cfline( '' ); // spacer
	cfline('cf_debt_payment_principal');
	cfline('cf_debt_payment_interest');
	cfline('cf_debt_payment_total');
	cfline( '' ); // spacer
	

	// reserve accounts
	cfline( 'Reserve Accounts');
	cfline('cf_reserve_debtservice');
	cfline('cf_reserve_om');
	cfline('cf_reserve_equip1');
	cfline('cf_reserve_equip2');
	cfline('cf_reserve_equip3');
	cfline( '' ); // spacer
	cfline( '' ); // spacer

	// state and federal depreciation/itc tables
	state_federal_depreciation_tables();

};

cashflow{ 'All Equity Partnership Flip' } = define()
{
	cfline( 'cf_energy_net', 1); // use one digit
	cfline( 'cf_energy_price');
	cfline( 'cf_energy_value');
	cfline( '' ); // spacer

	cfline( "Operating Expenses", 0 ); // header	
	cfline( 'cf_om_fixed_expense,cf_om_production_expense,cf_om_capacity_expense,cf_om_fuel_expense');
	cfline( 'cf_om_opt_fuel_1_expense' );
	cfline( 'cf_om_opt_fuel_2_expense' );
	
	cfline( 'cf_property_tax_assessed_value');
	cfline( 'cf_property_tax_expense');
	cfline( 'cf_insurance_expense');
	cfline( 'cf_net_salvage_value');
	cfline( 'cf_operating_expenses');
	cfline( '' ); // spacer
	
	cfline( 'cf_operating_income');
	cfline( '' ); // spacer
	
	cfline( "Financing", 0 ); // header
	cfline( 'cf_debt_balance');
	cfline( 'cf_debt_payment_interest');
	cfline( 'cf_debt_payment_principal');
	cfline( 'cf_debt_payment_total');
	
	// incentives
	setup_incentives_cashflow();
	
	cfline( "Tax Effect on Equity (State)", 0 ); // header
	cfline( 'cf_sta_depr_sched');
	cfline( 'cf_sta_depreciation');
	cfline( 'cf_sta_incentive_income_less_deductions');
	cfline( 'cf_sta_taxable_income_less_deductions');
	cfline( 'cf_sta_tax_savings');
	cfline( '' ); // spacer
	
	cfline( "Tax Effect on Equity (Federal)", 0 ); // header
	cfline( 'cf_fed_depr_sched' );
	cfline( 'cf_fed_depreciation');
	cfline( 'cf_fed_incentive_income_less_deductions');
	cfline( 'cf_fed_taxable_income_less_deductions');	
	cfline( 'cf_fed_tax_savings' );
	cfline( '' ); // spacer
	
	cfline( 'cf_after_tax_net_equity_cash_flow');
	cfline( 'cf_after_tax_net_equity_cost_flow');
	cfline( 'cf_after_tax_cash_flow');
};	

cashflow{ 'Leveraged Partnership Flip' } = define()
{
	cfline( 'cf_energy_net', 1); // use one digit
	cfline( 'cf_energy_price');
	cfline( 'cf_energy_value');
	cfline( '' ); // spacer

	cfline( "Operating Expenses", 0 ); // header	
	cfline( 'cf_om_fixed_expense,cf_om_production_expense,cf_om_capacity_expense,cf_om_fuel_expense');
	cfline( 'cf_om_opt_fuel_1_expense' );
	cfline( 'cf_om_opt_fuel_2_expense' );
	
	cfline( 'cf_property_tax_assessed_value');
	cfline( 'cf_property_tax_expense');
	cfline( 'cf_insurance_expense');
	cfline( 'cf_net_salvage_value');
	cfline( 'cf_operating_expenses');
	cfline( '' ); // spacer
	
	cfline( 'cf_operating_income');
	cfline( '' ); // spacer
	
	cfline( "Financing", 0 ); // header
	cfline( 'cf_debt_balance');
	cfline( 'cf_debt_payment_interest');
	cfline( 'cf_debt_payment_principal');
	cfline( 'cf_debt_payment_total');
	
	// incentives
	setup_incentives_cashflow();
	
	cfline( "Tax Effect on Equity (State)", 0 ); // header
	cfline( 'cf_sta_depr_sched');
	cfline( 'cf_sta_depreciation');
	cfline( 'cf_sta_incentive_income_less_deductions');
	cfline( 'cf_sta_taxable_income_less_deductions');
	cfline( 'cf_sta_tax_savings');
	cfline( '' ); // spacer
	
	cfline( "Tax Effect on Equity (Federal)", 0 ); // header
	cfline( 'cf_fed_depr_sched' );
	cfline( 'cf_fed_depreciation');
	cfline( 'cf_fed_incentive_income_less_deductions');
	cfline( 'cf_fed_taxable_income_less_deductions');	
	cfline( 'cf_fed_tax_savings' );
	cfline( '' ); // spacer
	
	cfline( 'cf_after_tax_net_equity_cash_flow');
	cfline( 'cf_after_tax_net_equity_cost_flow');
	cfline( 'cf_after_tax_cash_flow');
	
	
};

cashflow{ 'Sale Leaseback' } = define()
{
	cfline( 'cf_energy_net', 1); // use one digit
	cfline( 'cf_energy_price');
	cfline( 'cf_energy_value');
	cfline( '' ); // spacer

	cfline( "Operating Expenses", 0 ); // header	
	cfline( 'cf_om_fixed_expense,cf_om_production_expense,cf_om_capacity_expense,cf_om_fuel_expense');
	cfline( 'cf_om_opt_fuel_1_expense' );
	cfline( 'cf_om_opt_fuel_2_expense' );
	
	cfline( 'cf_property_tax_assessed_value');
	cfline( 'cf_property_tax_expense');
	cfline( 'cf_insurance_expense');
	cfline( 'cf_net_salvage_value');
	cfline( 'cf_operating_expenses');
	cfline( '' ); // spacer
	
	cfline( 'cf_operating_income');
	cfline( '' ); // spacer
	
	cfline( "Financing", 0 ); // header
	cfline( 'cf_debt_balance');
	cfline( 'cf_debt_payment_interest');
	cfline( 'cf_debt_payment_principal');
	cfline( 'cf_debt_payment_total');
	
	// incentives
	setup_incentives_cashflow();
	
	cfline( "Tax Effect on Equity (State)", 0 ); // header
	cfline( 'cf_sta_depr_sched');
	cfline( 'cf_sta_depreciation');
	cfline( 'cf_sta_incentive_income_less_deductions');
	cfline( 'cf_sta_taxable_income_less_deductions');
	cfline( 'cf_sta_tax_savings');
	cfline( '' ); // spacer
	
	cfline( "Tax Effect on Equity (Federal)", 0 ); // header
	cfline( 'cf_fed_depr_sched' );
	cfline( 'cf_fed_depreciation');
	cfline( 'cf_fed_incentive_income_less_deductions');
	cfline( 'cf_fed_taxable_income_less_deductions');	
	cfline( 'cf_fed_tax_savings' );
	cfline( '' ); // spacer
	
	cfline( 'cf_after_tax_net_equity_cash_flow');
	cfline( 'cf_after_tax_net_equity_cost_flow');
	cfline( 'cf_after_tax_cash_flow');
};



function cashflow_to_excel_incentives(xl)
{
	// incentives section 
	xl_set( xl, (${cbi_fed_deprbas_fed}?'x':''), 'inFedCBIITCBasisFed');
	xl_set( xl, (${cbi_fed_deprbas_sta}?'x':''), 'inFedCBIITCBasisState');
	xl_set( xl, (${cbi_sta_deprbas_fed}?'x':''), 'inStateCBIITCBasisFed');
	xl_set( xl, (${cbi_sta_deprbas_sta}?'x':''), 'inStateCBIITCBasisState');
	xl_set( xl, (${cbi_uti_deprbas_fed}?'x':''), 'inUtilityCBIITCBasisFed');
	xl_set( xl, (${cbi_uti_deprbas_sta}?'x':''), 'inUtilityCBIITCBasisState');
	xl_set( xl, (${cbi_oth_deprbas_fed}?'x':''), 'inOtherCBIITCBasisFed');
	xl_set( xl, (${cbi_oth_deprbas_sta}?'x':''), 'inOtherCBIITCBasisState');
} 

cashflow_to_excel{ 'Independent Power Producer' } = define() 
{
	source = runtimedir() + 'spreadsheets/utility_ipp.xls';
	destination = userlocaldatadir() + "/"+ case_name() + '.xls';
	
	destination = copy_file( source, destination );
	
	xl = xl_create( destination );
	xl_set( xl, ${analysis_period}, 'inAnalysisPeriod' );
	// annual energy for degradation to be applied in spreadsheet
	ae = alloc(${analysis_period});
	for(i=0;i<#ae;i++)	{
		ae[i] = output('annual_energy');	}
	xl_set( xl, ae, 'inSystemOutput' );
//	xl_set( xl, output('cf_energy_net'), 'inSystemOutput' );
	xl_set( xl, output('cf_energy_value'), 'inEnergyValue' );
	
	// for single value or schedule items
	degrad = ${degradation};
//	xl_set( xl, degrad, 'inDegradation' );
	xl_set( xl, ((#degrad == 1) ? degrad[0]/100 : 1), 'inDegradation' );
	xl_set( xl, ((#degrad == 1) ? 0 : output('cf_degradation')), 'inDegradationSched' );
	
	cashflow_to_excel_incentives(xl);

	xl_free( xl );
};