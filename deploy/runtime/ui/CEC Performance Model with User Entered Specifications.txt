CEC Performance Model with User Entered Specifications
1170
875
52
Numeric

1
17
Name
5
9
6par_aisc
X
3
981
Y
3
621
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
17
6par_aisc_display
X
3
354
Y
3
318
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
10
Choice

1
9
Name
5
15
6par_aisc_units
X
3
456
Y
3
318
Width
3
64
Height
3
21
Tool Tip
5
0
Items
6
2
A/째C
%/째C
Selection
3
0
TabOrder
3
0
Numeric

1
17
Name
5
9
6par_area
X
3
402
Y
3
78
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
3
Numeric

1
17
Name
5
37
6par_bifacial_ground_clearance_height
X
3
354
Y
3
561
Width
3
99
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
33
6par_bifacial_transmission_factor
X
3
354
Y
3
507
Width
3
99
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
16
6par_bifaciality
X
3
354
Y
3
534
Width
3
99
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
9
6par_bvoc
X
3
981
Y
3
594
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
17
6par_bvoc_display
X
3
354
Y
3
294
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
9
Choice

1
9
Name
5
15
6par_bvoc_units
X
3
456
Y
3
294
Width
3
64
Height
3
21
Tool Tip
5
0
Items
6
2
V/째C
%/째C
Selection
3
0
TabOrder
3
0
Choice

1
9
Name
5
13
6par_celltech
X
3
402
Y
3
54
Width
3
100
Height
3
21
Tool Tip
5
0
Items
6
6
monoSi
multiSi
CdTe
CIS
CIGS
Amorphous
Selection
3
1
TabOrder
3
2
TextEntry

1
11
Name
5
18
6par_data_filename
X
3
258
Y
3
825
Width
3
275
Height
3
24
Tool Tip
5
0
Text
5
0
Editable
2
0
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
9
6par_gpmp
X
3
354
Y
3
342
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
11
Numeric

1
17
Name
5
8
6par_imp
X
3
354
Y
3
222
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
6
CheckBox

1
9
Name
5
16
6par_is_bifacial
X
3
24
Y
3
510
Width
3
147
Height
3
24
Tool Tip
5
0
Caption
5
18
Module is bifacial
State
2
0
TabOrder
3
4294967295
Numeric

1
17
Name
5
8
6par_isc
X
3
354
Y
3
270
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
8
TextEntry

1
11
Name
5
16
6par_module_name
X
3
147
Y
3
27
Width
3
388
Height
3
21
Tool Tip
5
0
Text
5
30
Generic polycrystalline module
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
1
Choice

1
9
Name
5
13
6par_mounting
X
3
237
Y
3
642
Width
3
280
Height
3
21
Tool Tip
5
0
Items
6
0
Selection
3
4294967295
TabOrder
3
14
Numeric

1
17
Name
5
10
6par_mpeff
X
3
699
Y
3
54
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
16
Numeric

1
17
Name
5
9
6par_nser
X
3
354
Y
3
366
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
0
Format
3
0
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
12
Numeric

1
17
Name
5
8
6par_pmp
X
3
699
Y
3
30
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
15
Numeric

1
17
Name
5
15
6par_result_Adj
X
3
981
Y
3
567
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
14
6par_result_Il
X
3
645
Y
3
594
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
14
6par_result_Io
X
3
645
Y
3
621
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
14
6par_result_Rs
X
3
645
Y
3
648
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
15
6par_result_Rsh
X
3
645
Y
3
675
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
13
6par_result_a
X
3
645
Y
3
567
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Choice

1
9
Name
5
13
6par_standoff
X
3
237
Y
3
618
Width
3
280
Height
3
21
Tool Tip
5
0
Items
6
0
Selection
3
4294967295
TabOrder
3
13
Numeric

1
17
Name
5
10
6par_tnoct
X
3
402
Y
3
102
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4
Numeric

1
17
Name
5
38
6par_transient_thermal_model_unit_mass
X
3
660
Y
3
753
Width
3
99
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
0
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
8
6par_vmp
X
3
354
Y
3
198
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
5
Numeric

1
17
Name
5
8
6par_voc
X
3
354
Y
3
246
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
7
GroupBox

1
8
Name
5
9
GroupBox1
X
3
9
Y
3
9
Width
3
533
Height
3
143
Tool Tip
5
0
Caption
5
19
General Information
Bold
2
1
GroupBox

1
8
Name
5
9
GroupBox2
X
3
9
Y
3
159
Width
3
533
Height
3
320
Tool Tip
5
0
Caption
5
25
Electrical Specifications
Bold
2
1
GroupBox

1
8
Name
5
11
GroupBox213
X
3
9
Y
3
798
Width
3
533
Height
3
66
Tool Tip
5
0
Caption
5
16
Save / Load Data
Bold
2
1
GroupBox

1
8
Name
5
9
GroupBox3
X
3
9
Y
3
600
Width
3
533
Height
3
71
Tool Tip
5
0
Caption
5
22
Mounting Configuration
Bold
2
1
GroupBox

1
8
Name
5
9
GroupBox4
X
3
549
Y
3
9
Width
3
401
Height
3
80
Tool Tip
5
0
Caption
5
42
Nominal Maximum Power Point Ratings at STC
Bold
2
1
GroupBox

1
8
Name
5
9
GroupBox5
X
3
549
Y
3
96
Width
3
608
Height
3
620
Tool Tip
5
0
Caption
5
34
Current-Voltage (I-V) Curve at STC
Bold
2
1
Button

1
8
Name
5
14
btnCalcIVCurve
X
3
561
Y
3
132
Width
3
164
Height
3
24
Tool Tip
5
0
Caption
5
18
Calculate and plot
TabOrder
3
17
Button

1
8
Name
5
15
btnLoad6parData
X
3
141
Y
3
825
Width
3
111
Height
3
24
Tool Tip
5
0
Caption
5
17
Load from file...
TabOrder
3
4294967295
Button

1
8
Name
5
15
btnSave6parData
X
3
27
Y
3
825
Width
3
111
Height
3
24
Tool Tip
5
0
Caption
5
15
Save to file...
TabOrder
3
4294967295
Button

1
8
Name
5
16
copy_from_cec_db
X
3
63
Y
3
438
Width
3
420
Height
3
24
Tool Tip
5
0
Caption
5
61
Copy module specs from currently selected CEC database module
TabOrder
3
4294967295
GroupBox

1
8
Name
5
5
group
X
3
9
Y
3
678
Width
3
533
Height
3
114
Tool Tip
5
0
Caption
5
10
References
Bold
2
1
Plot

1
6
Name
5
6
ivplot
X
3
561
Y
3
168
Width
3
582
Height
3
351
Tool Tip
5
0
Hyperlink

1
9
Name
5
9
object 14
X
3
27
Y
3
762
Width
3
498
Height
3
21
Tool Tip
5
0
Caption
5
51
Performance Model Documentation page on SAM website
URL
5
32
https://sam.nrel.gov/performance
TabOrder
3
4294967295
Divider

1
10
Name
5
9
object 21
X
3
573
Y
3
537
Width
3
555
Height
3
16
Tool Tip
5
0
Orientation
3
0
Colour
4
120
120
120
255
Caption
5
44
Calculated STC Single Diode Model Parameters
Bold
2
0
GroupBox

1
8
Name
5
8
object 4
X
3
549
Y
3
723
Width
3
609
Height
3
75
Tool Tip
5
0
Caption
5
34
Transient Thermal Model Correction
Bold
2
1
GroupBox

1
8
Name
5
10
object 448
X
3
9
Y
3
486
Width
3
533
Height
3
111
Tool Tip
5
0
Caption
5
23
Bifacial Specifications
Bold
2
1
Label

1
13
Name
5
8
object 7
X
3
18
Y
3
390
Width
3
516
Height
3
36
Tool Tip
5
0
Caption
5
124
The model assumes a reference bandgap voltage Eg_ref = 1.121 eV, and temperature coefficient for bandgap of -0.0002677 eV/K.
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Label

1
13
Name
5
10
object 737
X
3
27
Y
3
699
Width
3
498
Height
3
60
Tool Tip
5
0
Caption
5
181
For information about the CEC module model inputs, see Help. For details about the model implementation, see Gilman (2015) on the SAM website's Performance Model Documentation page:
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Label

1
13
Name
5
12
object 73738
X
3
15
Y
3
978
Width
3
924
Height
3
24
Tool Tip
5
0
Caption
5
124
The model assumes a reference bandgap voltage Eg_ref = 1.121 eV, and temperature coefficient for bandgap of -0.0002677 eV/K.
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Label

1
13
Name
5
31
transient_thermal_model_message
X
3
807
Y
3
738
Width
3
348
Height
3
48
Tool Tip
5
0
Caption
5
176
The module unit mass is used for the transient thermal model, which is only applied for weather file time steps less than or equal to 20 minutes. The default value is 11 kg/m짼.
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1

32
6par_aisc
3
1
Temperature coefficient of Isc
A/C 
PV Module (CEC User Specified)
0
10
1
1
1
1
0.004
Numeric
6par_aisc_display
3
1
Temperature coefficient of Isc
 
PV Module (CEC User Specified)
0
0
1
1
1
1
0.004
Default
6par_aisc_units
3
1
aIsc Temp Coeff Units
 
PV Module (CEC User Specified)
9
A/째C|%/째C
1
1
1
1
1
0
Choice
6par_area
3
1
Module area
m짼
PV Module (CEC User Specified)
0
2
1
1
1
1
1.3
Numeric
6par_bifacial_ground_clearance_height
3
1
Ground clearance height
m
PV Module (CEC User Specified)
0
2
1
1
1
1
1
Numeric
6par_bifacial_transmission_factor
3
1
Transmission fraction
0-1
PV Module (CEC User Specified)
0
2
1
1
1
1
0.013
Default
6par_bifaciality
3
1
Bifaciality
0-1
PV Module (CEC User Specified)
0
2
1
1
1
1
0.65
Default
6par_bvoc
3
1
Temperature coefficient of Voc
V/C
PV Module (CEC User Specified)
0
10
1
1
1
1
-0.11
Numeric
6par_bvoc_display
3
1
Temperature coefficient of Voc
 
PV Module (CEC User Specified)
0
0
1
1
1
1
-0.11
Default
6par_bvoc_units
3
1
bVoc Temp Coeff Units
 
PV Module (CEC User Specified)
9
V/째C|%/째C
1
1
1
1
1
0
Choice
6par_celltech
3
1
Cell type
 
PV Module (CEC User Specified)
38
monoSi|multiSi|CdTe|CIS|CIGS|Amorphous
0
1
1
1
1
1
Choice
6par_data_filename
3
4
 
 
PV Module (CEC User Specified)
0
0
1
4
0
TextEntry
6par_gpmp
3
1
Temperature coefficient of max. power point
%/째C
PV Module (CEC User Specified)
0
2
1
1
1
1
-0.41
Numeric
6par_imp
3
1
Maximum power point current (Imp)
A
PV Module (CEC User Specified)
0
2
1
1
1
1
6
Numeric
6par_is_bifacial
3
1
Use Bifacial Modules
 
PV Module (CEC User Specified)
0
1
1
1
1
1
0
Default
6par_isc
3
1
Short circuit current (Isc)
A
PV Module (CEC User Specified)
0
2
1
1
1
1
7
Numeric
6par_module_name
3
4
Module name
 
PV Module (CEC User Specified)
0
0
1
4
38
Generic polycrystalline silicon module
TextEntry
6par_mounting
3
1
Approximate installation height
 
PV Module (CEC User Specified)
70
One story building height or lower|Two story building height or higher
2
1
1
1
1
0
Choice
6par_mpeff
3
1
Efficiency
%
PV Module (CEC User Specified)
0
8
1
1
1
1
0
Numeric
6par_nser
3
1
Number of cells in series
 
PV Module (CEC User Specified)
0
2
1
1
1
1
60
Numeric
6par_pmp
3
1
Power
Wdc
PV Module (CEC User Specified)
0
8
1
1
1
1
0
Numeric
6par_result_Adj
3
1
Adjust
%
 
0
4
1
1
1
1
0
Default
6par_result_Il
3
1
Il
A
 
0
4
1
1
1
1
0
Default
6par_result_Io
3
1
Io
A
 
0
4
1
1
1
1
0
Default
6par_result_Rs
3
1
Rs
Ohm
 
0
4
1
1
1
1
0
Default
6par_result_Rsh
3
1
Rsh
Ohm 
 
0
4
1
1
1
1
0
Default
6par_result_a
3
1
a
V
 
0
4
1
1
1
1
0
Default
6par_standoff
3
1
Standoff height
 
PV Module (CEC User Specified)
112
Building integrated|Greater than 3.5 in|2.5-3.5 in|1.5-2.5 in|0.5-1.5 in|Less than 0.5 in|Ground or rack mounted
2
1
1
1
1
6
Choice
6par_tnoct
3
1
Nominal operating cell temperature
째C
PV Module (CEC User Specified)
0
2
1
1
1
1
46
Numeric
6par_transient_thermal_model_unit_mass
3
1
Module unit mass
kg/m짼
PV Module (CEC User Specified)
0
2
1
1
1
1
0
Default
6par_vmp
3
1
Maximum power point voltage (Vmp)
V
PV Module (CEC User Specified)
0
2
1
1
1
1
30
Numeric
6par_voc
3
1
Open circuit voltage (Voc)
V
PV Module (CEC User Specified)
0
2
1
1
1
1
37
Numeric

513
equations{ '6par_mpeff' } = define() {
	return 100.0*${6par_vmp}*${6par_imp}/${6par_area}/1000.0; };

equations{ '6par_pmp' } = define() {
	return ${6par_vmp}*${6par_imp}; };
	
equations{ '6par_bvoc' } = define() {
	return ?${6par_bvoc_units} [${6par_bvoc_display}, 
	0.01 * ${6par_bvoc_display} * ${6par_voc} ]; };
	
equations{ '6par_aisc' } = define() {
	return ?${6par_aisc_units} [${6par_aisc_display}, 
	0.01 * ${6par_aisc_display} * ${6par_isc} ]; };
	
equations{'6par_step'} = define() {
	return ${step};};
7843
on_load{'CEC Performance Model with User Entered Specifications'} = define() {

	enable_bifacial();
	enable('6par_transient_thermal_model_unit_mass',value('step') <= 1200);
};

on_change{'6par_is_bifacial'} = define(){
	enable_bifacial();
};

function cec_model_ivcurve( Irr, TcC,
		a, Il, Io, Rs, Rsh, Adj, alpha, I_mp_ref,
		vmax, np,
		x, y )
{
	V = 0;
	T_cell = TcC+273.15;
	const q = 1.6*10^-19;
	const KB = 1.38*10^-23;
	const Tc_ref = 25+273.15;
	const eg0 = 1.12;
	const I_ref = 1000;
	muIsc = alpha * (1-Adj/100);
	
	EG = eg0 * (1-0.0002677*(T_cell-Tc_ref));
	IO_oper = Io * pow(T_cell/Tc_ref, 3) * exp( 1/KB*(eg0/Tc_ref - EG/T_cell) );
	A_oper = a * T_cell / Tc_ref;
	Rsh_oper = Rsh*(I_ref/Irr);
	IL_oper = Irr/I_ref *( Il + muIsc*(T_cell-Tc_ref) );
	if (IL_oper < 0.0) IL_oper = 0.0;
	
	/*
	logmsg( '@ ' + Irr + ',' + TcC + ':: vmax, IL_oper, IO_oper, Rs, A_oper, Rsh_oper, I_mp_ref' );
	logmsg( vmax );
	logmsg( IL_oper );
	logmsg( IO_oper );
	logmsg( Rs );
	logmsg( A_oper );
	logmsg( Rsh_oper );
	logmsg( I_mp_ref );
	*/
	
	incr = vmax/(np-1);
	for(i=0;i<np;i++)
	{
		x[i] = V;
		y[i] = current_at_voltage_cec( V, IL_oper, IO_oper, Rs, A_oper, Rsh_oper, I_mp_ref );		
		V += incr;
	}
	
}


function cec_model_make_plot( a, Il, Io, Rs, Rsh, Adj, alpha, beta, vmax, imax, I_mp_ref)
{
	curves = [ [ 1000, 25, 'black' ],
			   [ 800,  25, 'blue' ],
			   [ 600,  25, 'red' ],
			   [ 400,  25, 'forest green' ],
			   [ 200,  25, 'orange' ] ];
		
	const np = 150;
	xx = alloc(np);
	yy = alloc(np);

	for( i=0;i<#curves;i++ )
	{	
		Irr = curves[i][0];
		Tc = curves[i][1];
		cec_model_ivcurve( Irr, Tc,	 
			a, Il, Io, Rs, Rsh, Adj, alpha, I_mp_ref,
			vmax, np,
			xx, yy );
			
		plot(xx,yy,{'series'=sprintf('%g W/m^2, %g ^\\deg  C', Irr, Tc),
			size= (Irr==1000 ? 3:1 ), "color"=curves[i][2]});

	}
		
	
	//Make the plot
	plotopt({"title"='IV curves',"popup"=true,"backcolor"=[255,255,255],"legend"=true, 'legendpos'='bottom'});
	axis('x1', {'label'='Voltage (V)', 'min'=0, 'max'=ceil(vmax*1.01)});
	axis('y1', {'label'='Current (A)', 'min'=0, 'max'= (imax*1.05)});
}


on_change{'btnCalcIVCurve'} = define() {

	//calculate inputs
	celltype= ?${6par_celltech}[
		'monoSi', 'multiSi/polySi', 'cdte', 'cis', 'cigs', 'amorphous'];
	
	//call 6parsolve module
	obj = ssc_create();
	ssc_var(obj, 'celltype', celltype);
	ssc_var(obj, 'Vmp', ${6par_vmp});
	ssc_var(obj, 'Imp', ${6par_imp});
	ssc_var(obj, 'Voc', ${6par_voc});
	ssc_var(obj, 'Isc', ${6par_isc});
	ssc_var(obj, 'alpha_isc', ${6par_aisc});
	ssc_var(obj, 'beta_voc', ${6par_bvoc});
	ssc_var(obj, 'gamma_pmp', ${6par_gpmp});
	ssc_var(obj, 'Nser', ${6par_nser});
	ssc_var(obj, 'Tref', 25);
	result= ssc_exec(obj, '6parsolve', {'show_dialog'=true, 'hold_dialog'=true} );
	if(result != 0)
	{
		msgbox('Failed to solve for module coefficients. Please check your inputs.');
		return;
	}
	a = ssc_var(obj, 'a');
	Il = ssc_var(obj, 'Il');
	Io = ssc_var(obj, 'Io');
	Rs = ssc_var(obj, 'Rs');
	Rsh = ssc_var(obj, 'Rsh');
	Adj = ssc_var(obj, 'Adj');
	
	ssc_free(obj);
	
	${6par_result_a} = a;
	${6par_result_Il} = Il;
	${6par_result_Io} = Io;
	${6par_result_Rs} = Rs;
	${6par_result_Rsh} = Rsh;
	${6par_result_Adj} = Adj;
	
	
	//Make the plot
	setplot("ivplot");
	clearplot("ivplot");
	
	cec_model_make_plot(
		a, Il, Io, Rs, Rsh, Adj, 
		${6par_aisc}, ${6par_bvoc}, 
		${6par_voc}, ${6par_isc}, ${6par_imp});
};


on_change{'btnSave6parData'} = define() {
	logmsg('running btnSave6parData');
	file = choose_file( '', 'Save CEC Module Performance Data As', 
		'Data Files (*.csv)|*.csv', true);
		
	if ( file != '' ) {
		file = replace(file, '\\', '/');
		if (group_write('PV Module (CEC User Specified)',file))
		{	
			value( '6par_data_filename', file );
			msgbox("Data saved! \n");
		}
		else
		{
			value( '6par_data_filename', "" );
			msgbox("Data save failed! \n");
		}
	}
};

on_change{'btnLoad6parData'} = define() {
	logmsg('running btnLoad6parData');
	file = choose_file( '', 'Open CEC Module Performance File', 
		'Data Files (*.csv)|*.csv');
		
	if ( file != '' ) {
		file = replace(file, '\\', '/');
		if (group_read('PV Module (CEC User Specified)',file))
		{	
			value( '6par_data_filename', file );
			msgbox("Data loaded! \n");
		}
		else
		{
			value( '6par_data_filename', "" );
			msgbox("Data load failed! \n");
		}
	}
};

function enable_bifacial()
{
	enable('6par_bifaciality', value('6par_is_bifacial'));
	enable('6par_bifacial_transmission_factor', value('6par_is_bifacial'));
	enable('6par_bifacial_ground_clearance_height', value('6par_is_bifacial'));
}

on_change{'copy_from_cec_db'} = define () {

	value( '6par_isc', value('cec_i_sc_ref') );
	value( '6par_is_bifacial', value('cec_is_bifacial') );
	value( '6par_voc', value('cec_v_oc_ref') );
	value( '6par_aisc_display', value('cec_alpha_sc') );
	value( '6par_bifaciality', value('cec_bifaciality') );
	value( '6par_aisc_units', 0 ); // always A/'C
	value( '6par_gpmp', value('cec_gamma_r') );
	value( '6par_area', value('cec_area') );
	value( '6par_bifacial_ground_clearance_height', value('cec_bifacial_ground_clearance_height') );
	value( '6par_bifacial_transmission_factor', value('cec_bifacial_transmission_factor') );
	value( '6par_bvoc_display', value('cec_beta_oc') );
	value( '6par_bvoc_units', 0 ); // always V/'C
	
	celltech = 0;
	
	m = lower(value('cec_material'));
	if( strpos(m,'mono')>=0 ) celltech = 0;
	elseif ( strpos(m, 'multi') >= 0 ) celltech = 1;
	elseif( strpos(m, 'thin')>=0 ) celltech=2;
	elseif( strpos(m, 'cis')>=0) celltech=3;
	elseif( strpos(m, 'cigs')>=0) celltech=4;
	elseif( strpos(m, 'a-si')>=0) celltech=5;
	else
	{
		msgbox( 'pls check cell type.  could not translate unrecognized value from CEC database:' + m );
	}
	
/*	Multi-c-Si
	Mono-c-Si
	Thin Film
	a-Si/nc
	CIS
	CIGS
	1-a-Si
	CdTe
	a-Si
	2-a-Si
	3-a-Si
	HIT-Si
	*/

	
	// 0:monoSi,1:multiSi,2:CdTe,3:CIS,4:CIGS,5:Amorphous
	value( '6par_celltech', celltech );	
	value( '6par_imp',  value('cec_i_mp_ref'));
	value( '6par_module_name', value('module_name') + ' (from CEC database)' );
	value( '6par_mounting', value('cec_height') );
	value( '6par_nser', value( 'cec_n_s') );
	value( '6par_standoff', value('cec_standoff') );
	value( '6par_tnoct', value('cec_t_noct') );
	value( '6par_vmp', value('cec_v_mp_ref') );
	
	
	on_change{'btnCalcIVCurve'}();
	msgbox('Copied module specs for ' + value('module_name') + ' from CEC database.');
	
	/*
	
	alpha_sc_calc	 	%/째C
beta_oc_calc	 	%/째C
cec_a_ref	A_ref	V
cec_adjust	Adjust	%
cec_alpha_sc	 	A/째C
cec_area	Module area	m짼
cec_array_cols	Columns of modules in array	 
cec_array_rows	Rows of modules in array	 
cec_backside_temp	Temperature behind the module	째C
cec_beta_oc	 	V/째C
cec_bifacial_ground_clearance_height	Ground clearance height	m
cec_bifacial_transmission_factor	Transmission fraction	0-1
cec_bifaciality	Bifaciality	0-1
cec_eff	Nominal efficiency	%
cec_gamma_r	 	%/째C
cec_gap_spacing	Space between module back and roof surface	m
cec_heat_transfer	Heat transfer dimensions	 
cec_height	Array height	 
cec_i_l_ref	I_L_ref	A
cec_i_mp_ref	Max power current (Imp)	Adc
cec_i_o_ref	I_o_ref	A
cec_i_sc_ref	Short circuit current (Isc)	Adc
cec_is_bifacial	Use Bifacial Modules	 
cec_material	Material	 
cec_module_length	Module length	m
cec_module_width	Module width	m
cec_mounting_config	Mounting configuration	 
cec_mounting_orientation	Mounting structure orientation	 
cec_n_s	Number of cells	 
cec_p_mp_ref	Maximum power (Pmp)	Wdc
cec_r_s	R_s	Ohm
cec_r_sh_ref	R_sh_ref	Ohm
cec_standoff	Mounting standoff	 
cec_t_noct	T_noct	째C
cec_temp_corr_mode	Temperature Correction Model	 
cec_v_mp_ref	Max power voltage (Vmp)	Vdc
cec_v_oc_ref	Open circuit voltage (Voc)	Vdc
gamma_r_calc	 	W/째C
lbl_bifacial	Label indicating bifacial module from library 	 
lib_is_bifacial	Bifacial designation from CEC module library	 
module_name	Module Name	 
ref_conditions	 	 

*/
};
