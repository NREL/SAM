IEC61853 Single Diode Model
1031
902
48
Button

1
8
Name
5
21
btn_calc_iec65153_par
X
3
330
Y
3
318
Width
3
159
Height
3
28
Tool Tip
5
0
Caption
5
20
Calculate parameters
TabOrder
3
4294967295
Button

1
8
Name
5
15
btn_update_plot
X
3
321
Y
3
627
Width
3
135
Height
3
28
Tool Tip
5
0
Caption
5
11
Update plot
TabOrder
3
4294967295
Plot

1
6
Name
5
13
iec61853_plot
X
3
477
Y
3
390
Width
3
541
Height
3
387
Tool Tip
5
0
DataMatrix

1
27
Name
5
18
iec61853_test_data
X
3
18
Y
3
30
Width
3
481
Height
3
249
Tool Tip
5
0
PasteAppendRows
2
0
PasteAppendCols
2
0
ShowButtons
2
1
ShowRows
2
1
ShowRowLabels
2
0
RowLabels
5
0
ShadeR0C0
2
0
VerticalLabel
5
0
HorizontalLabel
5
0
ShadeC0
2
0
ShowCols
2
0
ShowColLabels
2
1
ColLabels
5
43
Irr(W/m2),Tc(C),Pmp(W),Vmp(V),Voc(V),Isc(A)
NumRowsLabel
5
5
Rows:
NumColsLabel
5
5
Cols:
Layout
3
1
ChoiceColumn
3
4294967295
Choices
5
15
Choice1,Choice2
HideColumn
3
4294967295
ShowColumn
3
4294967295
ColorMap
2
0
Hyperlink

1
9
Name
5
9
object 14
X
3
24
Y
3
855
Width
3
402
Height
3
21
Tool Tip
5
0
Caption
5
51
Performance Model Documentation page on SAM website
URL
5
32
https://sam.nrel.gov/performance
TabOrder
3
4294967295
Divider

1
10
Name
5
9
object 22
X
3
24
Y
3
282
Width
3
474
Height
3
16
Tool Tip
5
0
Orientation
3
0
Colour
4
120
120
120
255
Caption
5
47
Additional information for parameter estimation
Bold
2
1
GroupBox

1
8
Name
5
8
object 4
X
3
9
Y
3
792
Width
3
1017
Height
3
102
Tool Tip
5
0
Caption
5
10
References
Bold
2
1
GroupBox

1
8
Name
5
10
object 413
X
3
9
Y
3
375
Width
3
1017
Height
3
411
Tool Tip
5
0
Caption
5
52
Calculated model parameters from IEC-61853 test data
Bold
2
1
GroupBox

1
8
Name
5
10
object 414
X
3
525
Y
3
273
Width
3
501
Height
3
93
Tool Tip
5
0
Caption
5
29
Optical and spectral behavior
Bold
2
1
GroupBox

1
8
Name
5
10
object 415
X
3
525
Y
3
126
Width
3
501
Height
3
141
Tool Tip
5
0
Caption
5
33
Installation and thermal behavior
Bold
2
1
GroupBox

1
8
Name
5
10
object 416
X
3
525
Y
3
9
Width
3
501
Height
3
114
Tool Tip
5
0
Caption
5
31
STC parameters (from test data)
Bold
2
1
GroupBox

1
8
Name
5
10
object 437
X
3
9
Y
3
9
Width
3
501
Height
3
357
Tool Tip
5
0
Caption
5
41
Module test data (according to IEC-61853)
Bold
2
1
Label

1
13
Name
5
8
object 7
X
3
24
Y
3
810
Width
3
972
Height
3
42
Tool Tip
5
0
Caption
5
200
For more information about the IEC 61853 module model inputs, see Help. For a detailed description of the model, see Gilman (2015) and Dobos (2014) on the SAM website's Performance Documentation page:
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Label

1
13
Name
5
10
object 719
X
3
132
Y
3
654
Width
3
126
Height
3
24
Tool Tip
5
0
Caption
5
13
Rs parameters
TextColour
4
0
0
0
255
Bold
2
1
FontSize
3
0
WordWrap
2
0
AlignRight
2
0
AlignTop
2
0
Label

1
13
Name
5
10
object 720
X
3
312
Y
3
408
Width
3
129
Height
3
24
Tool Tip
5
0
Caption
5
15
STC temp coeffs
TextColour
4
0
0
0
255
Bold
2
1
FontSize
3
0
WordWrap
2
0
AlignRight
2
0
AlignTop
2
0
Label

1
13
Name
5
10
object 725
X
3
129
Y
3
405
Width
3
129
Height
3
24
Tool Tip
5
0
Caption
5
14
STC parameters
TextColour
4
0
0
0
255
Bold
2
1
FontSize
3
0
WordWrap
2
0
AlignRight
2
0
AlignTop
2
0
Label

1
13
Name
5
10
object 726
X
3
129
Y
3
543
Width
3
129
Height
3
24
Tool Tip
5
0
Caption
5
14
Rsh parameters
TextColour
4
0
0
0
255
Bold
2
1
FontSize
3
0
WordWrap
2
0
AlignRight
2
0
AlignTop
2
0
Numeric

1
17
Name
5
12
sd11par_AMa0
X
3
681
Y
3
330
Width
3
63
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
12
sd11par_AMa1
X
3
747
Y
3
330
Width
3
63
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
12
sd11par_AMa2
X
3
813
Y
3
330
Width
3
63
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
12
sd11par_AMa3
X
3
879
Y
3
330
Width
3
63
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
12
sd11par_AMa4
X
3
945
Y
3
330
Width
3
63
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
13
sd11par_Egref
X
3
168
Y
3
510
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
10
sd11par_Il
X
3
168
Y
3
456
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
12
sd11par_Imp0
X
3
633
Y
3
87
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
10
sd11par_Io
X
3
168
Y
3
483
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
12
sd11par_Isc0
X
3
918
Y
3
60
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
12
sd11par_Pmp0
X
3
633
Y
3
33
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
12
sd11par_Vmp0
X
3
633
Y
3
60
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
12
sd11par_Voc0
X
3
918
Y
3
33
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
16
sd11par_alphaIsc
X
3
351
Y
3
432
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
12
sd11par_area
X
3
747
Y
3
150
Width
3
111
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
15
sd11par_betaVoc
X
3
351
Y
3
459
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
10
sd11par_c1
X
3
168
Y
3
567
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
10
sd11par_c2
X
3
168
Y
3
594
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
10
sd11par_c3
X
3
168
Y
3
621
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
10
sd11par_d1
X
3
168
Y
3
678
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
10
sd11par_d2
X
3
168
Y
3
705
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
10
sd11par_d3
X
3
168
Y
3
732
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
11
sd11par_eff
X
3
918
Y
3
87
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
16
sd11par_gammaPmp
X
3
351
Y
3
486
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Choice

1
9
Name
5
13
sd11par_glass
X
3
681
Y
3
300
Width
3
213
Height
3
24
Tool Tip
5
0
Items
6
0
Selection
3
4294967295
TabOrder
3
4294967295
Choice

1
9
Name
5
16
sd11par_mounting
X
3
747
Y
3
231
Width
3
243
Height
3
24
Tool Tip
5
0
Items
6
0
Selection
3
4294967295
TabOrder
3
4294967295
Numeric

1
17
Name
5
9
sd11par_n
X
3
168
Y
3
429
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
12
sd11par_nser
X
3
189
Y
3
303
Width
3
111
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Choice

1
9
Name
5
16
sd11par_standoff
X
3
747
Y
3
204
Width
3
243
Height
3
24
Tool Tip
5
0
Items
6
0
Selection
3
4294967295
TabOrder
3
4294967295
Numeric

1
17
Name
5
13
sd11par_tnoct
X
3
747
Y
3
177
Width
3
111
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Choice

1
9
Name
5
12
sd11par_type
X
3
189
Y
3
330
Width
3
114
Height
3
24
Tool Tip
5
0
Items
6
0
Selection
3
4294967295
TabOrder
3
4294967295

34
iec61853_test_data
3
3
Matrix of test data for IEC 61853 model
 
IEC-68153 PV Module Model
0
1
1
3
28
6
100 15 6.69435 63.8967 79.5398 0.117528 
100 25 6.48283 61.6303 77.0356 0.118 
100 50 5.9371 55.8834 70.7751 0.11918 
100 75 5.36686 50.0207 64.5146 0.12036 
200 15 13.889 66.2978 82.4388 0.235056 
200 25 13.5153 64.2559 80.0352 0.236 
200 50 12.5576 59.1117 74.0262 0.23836 
200 75 11.5662 53.9109 68.0172 0.24072 
400 15 28.1891 67.3057 85.3378 0.470112 
400 25 27.4968 65.39 83.0348 0.472 
400 50 25.7322 60.5878 77.2773 0.47672 
400 75 23.9194 55.7673 71.5198 0.48144 
600 15 42.2315 67.2495 87.0336 0.705168 
600 25 41.211 65.3619 84.7894 0.708 
600 50 38.6155 60.639 79.1791 0.71508 
600 75 35.9568 55.9104 73.5687 0.72216 
800 15 56.0107 66.9205 88.2367 0.940224 
800 25 54.6491 65.0325 86.0344 0.944 
800 50 51.1889 60.3117 80.5284 0.95344 
800 75 47.6484 55.5899 75.0224 0.96288 
1000 15 69.5457 66.5 89.17 1.17528 
1000 25 67.83 64.6 87 1.18 
1000 50 63.4709 59.85 81.575 1.1918 
1000 75 59.0121 55.1 76.15 1.2036 
1100 15 76.2278 66.2764 89.5686 1.29281 
1100 25 74.3304 64.3682 87.4125 1.298 
1100 50 69.5095 59.5974 82.022 1.31098 
1100 75 64.5782 54.8265 76.6316 1.32396 

DataMatrix
sd11par_AMa0
3
1
Air mass modifiers
 
IEC-68153 PV Module Model
0
0
1
1
1
1
0.9417
Numeric
sd11par_AMa1
3
1
Air mass modifiers for IEC-61853 model
 
IEC-68153 PV Module Model
0
1
1
1
1
1
0.6516
Numeric
sd11par_AMa2
3
1
Air mass modifiers for IEC-61853 model
 
IEC-68153 PV Module Model
0
1
1
1
1
1
-0.02022
Numeric
sd11par_AMa3
3
1
Air mass modifiers for IEC-61853 model
 
IEC-68153 PV Module Model
0
1
1
1
1
1
0.00219
Numeric
sd11par_AMa4
3
1
Air mass modifiers for IEC-61853 model
 
IEC-68153 PV Module Model
0
1
1
1
1
1
-9.1e-05
Numeric
sd11par_Egref
3
1
Bandgap voltage (Eg)
eV
IEC-68153 PV Module Model
0
0
1
1
1
1
0.737668
Numeric
sd11par_Il
3
1
Light current (Il)
A
IEC-68153 PV Module Model
0
0
1
1
1
1
1.18951
Numeric
sd11par_Imp0
3
1
Current (Imp)
A
IEC-68153 PV Module Model
0
8
1
1
1
1
0
Numeric
sd11par_Io
3
1
Saturation current (Io)
A
IEC-68153 PV Module Model
0
0
1
1
1
1
2.08522e-09
Numeric
sd11par_Isc0
3
1
Short circuit current (Isc)
A
IEC-68153 PV Module Model
0
8
1
1
1
1
0
Numeric
sd11par_Pmp0
3
1
Power (Pmp)
W
IEC-68153 PV Module Model
0
8
1
1
1
1
0
Numeric
sd11par_Vmp0
3
1
Voltage (Vmp)
V
IEC-68153 PV Module Model
0
8
1
1
1
1
0
Numeric
sd11par_Voc0
3
1
Open circuit voltage (Voc)
V
IEC-68153 PV Module Model
0
8
1
1
1
1
0
Numeric
sd11par_alphaIsc
3
1
alpha
A/C
IEC-68153 PV Module Model
0
0
1
1
1
1
0.000472
Numeric
sd11par_area
3
1
Area
m2
IEC-68153 PV Module Model
0
0
1
1
1
1
0.72
Numeric
sd11par_betaVoc
3
1
beta
V/C
IEC-68153 PV Module Model
0
0
1
1
1
1
-0.217
Numeric
sd11par_c1
3
1
C1
 
IEC-68153 PV Module Model
0
0
1
1
1
1
1930.15
Numeric
sd11par_c2
3
1
C2
 
IEC-68153 PV Module Model
0
0
1
1
1
1
474.64
Numeric
sd11par_c3
3
1
C3
 
IEC-68153 PV Module Model
0
0
1
1
1
1
1.48746
Numeric
sd11par_d1
3
1
D1
 
IEC-68153 PV Module Model
0
0
1
1
1
1
13.5504
Numeric
sd11par_d2
3
1
D2
 
IEC-68153 PV Module Model
0
0
1
1
1
1
-0.076973
Numeric
sd11par_d3
3
1
D3
 
IEC-68153 PV Module Model
0
0
1
1
1
1
0.237327
Numeric
sd11par_eff
3
1
Efficiency
%
IEC-68153 PV Module Model
0
8
1
1
1
1
0
Numeric
sd11par_gammaPmp
3
1
gamma
%/C
IEC-68153 PV Module Model
0
0
1
1
1
1
-0.258849
Numeric
sd11par_glass
3
1
Module cover
 
IEC-68153 PV Module Model
43
Standard glass|Anti-reflective (AR) coating
0
1
1
1
1
0
Choice
sd11par_mounting
3
1
Approximate mounting height
 
IEC-68153 PV Module Model
70
One story building height or lower|Two story building height or higher
0
1
1
1
1
0
Choice
sd11par_n
3
1
Diode factor (n)
 
IEC-68153 PV Module Model
0
0
1
1
1
1
1.45071
Numeric
sd11par_nser
3
1
Number of cells in series
 
IEC-68153 PV Module Model
0
0
1
1
1
1
116
Numeric
sd11par_standoff
3
1
Standoff height
 
IEC-68153 PV Module Model
112
Building integrated|Greater than 3.5 in|2.5-3.5 in|1.5-2.5 in|0.5-1.5 in|Less than 0.5 in|Ground or rack mounted
0
1
1
1
1
6
Choice
sd11par_tnoct
3
1
Nominal operating cell temp
C
IEC-68153 PV Module Model
0
0
1
1
1
1
44.9
Numeric
sd11par_transient_thermal_model_unit_mass
3
1
Module unit mass
kg/m^2
IEC-68153 PV Module Model
0
2
1
1
1
1
0
Default
sd11par_type
3
1
Type
 
IEC-68153 PV Module Model
39
monoSi|multiSi|CdTe|CIS|CIGS|Amorphous 
0
1
1
1
1
2
Choice
step_sd11par
3
1
 
 
IEC-68153 PV Module Model
0
8
1
1
1
1
0
Default

667
equations{ 'sd11par_eff' } = define() {
	return 0.1*${sd11par_Pmp0}/${sd11par_area};
};

equations{'$MIMO$ stc_parametesr'} = define() {

	input = ${iec61853_test_data};
	nr = #input;
	idx=0;
	while( idx < nr )
	{
		if ( input[idx][0] == 1000
			&& input[idx][1] == 25 )
			break;
		idx++;
	}
	
	pmp = -999;
	vmp = -999;
	imp = -999;
	voc = -999;
	isc = -999;
		
	if ( idx < nr )
	{
		pmp = input[idx][2];
		vmp = input[idx][3];
		voc = input[idx][4];
		isc = input[idx][5];
	}
	
	${sd11par_Pmp0} = pmp;
	${sd11par_Vmp0} = vmp;
	${sd11par_Isc0} = isc;
	${sd11par_Voc0} = voc;
	${sd11par_Imp0} = pmp/vmp;

};

equations{'sd11par_step'} = define() {
	return ${step};
};
3325

function iec61853_ivcurve( Irr, TcC,
		aisc, n, Io, Il, C, D, Egref, Imp0, nser,
		vmax, np,
		x, y )
{
	V = 0;
	logmsg('creating ivcurve ' + Irr + ' '  + Tc);
	
	Tc = TcC+273.15;
	const q = 1.6*10^-19;
	const k = 1.38*10^-23;
	const aop = nser*n*k*Tc/q;
	const Ilop = Irr/1000*(Il + aisc*(Tc-298.15));
	const Egop = (1-0.0002677*(Tc-298.15))*Egref;
	const Ioop = Io*(Tc/298.15)^3*exp( 11600 * (Egref/298.15 - Egop/Tc));
	const Rsop = D[0] + D[1]*(Tc-298.15) + D[2]*( 1-Irr/1000.0)*(1000.0/Irr)^2;
	const Rshop = C[0] + C[1]*( (1000.0/Irr)^C[2]-1 );
	
	incr = vmax/(np-1);
	for(i=0;i<np;i++)
	{
		x[i] = V;
		y[i] = current_at_voltage_cec( V, Ilop, Ioop, Rsop, aop, Rshop, Imp0 );		
		V += incr;
	}
	
}


function iec61853_update_plot()
{
	curves = [ [ 1000, 25, 'black' ],
			   [ 800,  25, 'blue' ],
			   [ 600,  25, 'red' ],
			   [ 400,  25, 'forest green' ],
			   [ 200,  25, 'orange' ] ];
			   
	setplot( 'iec61853_plot' );
	clearplot();
		
	aisc = ${sd11par_alphaIsc};
	n = ${sd11par_n};
	Il = ${sd11par_Il};
	Io = ${sd11par_Io};
	Cvec = [ ${sd11par_c1},${sd11par_c2},${sd11par_c3} ];
	Dvec = [ ${sd11par_d1},${sd11par_d2},${sd11par_d3} ];
	Egref = ${sd11par_Egref};
	Imp0 = ${sd11par_Imp0};
	nser = ${sd11par_nser};
	
	vmax = ${sd11par_Voc0};
	imax = ${sd11par_Isc0};
	
	logmsg('creating arrays');
	
	const np = 150;
	xx = alloc(np);
	yy = alloc(np);
	for( i=0;i<#curves;i++ )
	{	
		Irr = curves[i][0];
		Tc = curves[i][1];
		iec61853_ivcurve( Irr, Tc, 
			aisc, n, Io, Il, Cvec, Dvec, Egref, Imp0, nser,
			vmax, np,
			xx, yy );
			
		plot(xx,yy,{'series'=sprintf('@ %g W/m2, %g C', Irr, Tc),
			"thick"=1, "scale"=true,"color"=curves[i][2]});

	}
		
	
	//Make the plot
	plotopt({"title"='IV curves',"popup"=true,"backcolor"=[255,255,255],"legend"=true, 'legendpos'='southwest'});
	axis('x1', {'label'='Voltage (V)', 'min'=0, 'max'=ceil(vmax*1.02)});
	axis('y1', {'label'='Current (A)', 'min'=0, 'max'= (imax*1.07)});
}

on_load{ 'IEC61853 Single Diode Model' } = define() {	
	iec61853_update_plot();
	//on_change{'step_sd11par'}();
};

/*on_change{'step_sd11par'} = define() {
	time_step = value('step_sd11par');
	enable('sd11par_transient_thermal_model_unit_mass',time_step <= 1200);
	show('transient_thermal_model_message',time_step <= 1200);
	refresh();
};*/

on_change{'btn_update_plot'} = define() {	
	iec61853_update_plot();
};

on_change{'btn_calc_iec65153_par'} = define()
{
	S = ssc_create();
	ssc_var( S, 'input', ${iec61853_test_data} );
	ssc_var( S, 'nser', ${sd11par_nser} );
	ssc_var( S, 'type', ${sd11par_type} );
	ssc_var( S, 'verbose', 1 );
	code = ssc_exec( S, 'iec61853par', {'show_dialog'=true,'hold_dialog'=true});
	if( code == 0 )
	{
		${sd11par_alphaIsc} = ssc_var( S, 'alphaIsc' );
		${sd11par_betaVoc} = ssc_var( S, 'betaVoc' );
		${sd11par_gammaPmp} = ssc_var( S, 'gammaPmp' );
		${sd11par_n} = ssc_var( S, 'n' );
		${sd11par_Il} = ssc_var( S, 'Il' );
		${sd11par_Io} = ssc_var( S, 'Io' );
		${sd11par_Egref} = ssc_var( S, 'Egref' );
		${sd11par_c1} = ssc_var( S, 'C1' );
		${sd11par_c2} = ssc_var( S, 'C2' );
		${sd11par_c3} = ssc_var( S, 'C3' );
		${sd11par_d1} = ssc_var( S, 'D1' );
		${sd11par_d2} = ssc_var( S, 'D2' );
		${sd11par_d3} = ssc_var( S, 'D3' );
	}
	else msgbox('Error estimating parameters.  Values were not updated.');
	ssc_free( S );
	
	iec61853_update_plot();

};
