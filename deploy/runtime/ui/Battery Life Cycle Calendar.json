{
    "Name": "Battery Life Cycle Calendar",
    "Width": 1054.0,
    "Height": 683.0,
    "FormObjects": {
        "GroupBox": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": ""
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 6.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 3.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 1042.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 672.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "Cycle and Calendar Degradation"
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 1.0
                }
            }
        },
        "RadioChoice": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "batt_calendar_choice"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 39.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 387.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 156.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 75.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Selection": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "Items": {
                    "Type": 6.0,
                    "StringList": "No calendar degradation|Empirical|Custom"
                },
                "ShowCaptions": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "Horizontal": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": 1.0
                }
            }
        },
        "Plot": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "batt_calendar_life_plot"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 555.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 378.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 400.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 250.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                }
            }
        },
        "Divider": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "batt_calendar_lifetime_label"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 21.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 360.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 966.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 22.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Orientation": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "Colour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 120.0,
                        "Green": 120.0,
                        "Blue": 120.0,
                        "Alpha": 255.0
                    }
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "Calendar Degradation"
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 1.0
                }
            }
        },
        "DataMatrix": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "batt_calendar_lifetime_matrix"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 51.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 468.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 450.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 194.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "PasteAppendRows": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "PasteAppendCols": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "ShowButtons": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "ShowRows": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "ShowRowLabels": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "RowLabels": {
                    "Type": 5.0,
                    "String": ""
                },
                "ShadeR0C0": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "VerticalLabel": {
                    "Type": 5.0,
                    "String": ""
                },
                "HorizontalLabel": {
                    "Type": 5.0,
                    "String": ""
                },
                "ShadeC0": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "ShowCols": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "ShowColLabels": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "ColLabels": {
                    "Type": 5.0,
                    "String": "Battery age (days),Capacity (%)"
                },
                "NumRowsLabel": {
                    "Type": 5.0,
                    "String": "Rows:"
                },
                "NumColsLabel": {
                    "Type": 5.0,
                    "String": "Cols:"
                },
                "Layout": {
                    "Type": 3.0,
                    "Integer": 1.0
                },
                "ChoiceColumn": {
                    "Type": 3.0,
                    "Integer": -1.0
                },
                "Choices": {
                    "Type": 5.0,
                    "String": "Choice1,Choice2"
                },
                "HideColumn": {
                    "Type": 3.0,
                    "Integer": -1.0
                },
                "ShowColumn": {
                    "Type": 3.0,
                    "Integer": -1.0
                },
                "ColorMap": {
                    "Type": 2.0,
                    "Boolean": 0.0
                }
            }
        },
        "Divider": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "batt_cycle_lifetime_label"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 12.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 78.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 966.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 22.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Orientation": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "Colour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 120.0,
                        "Green": 120.0,
                        "Blue": 120.0,
                        "Alpha": 255.0
                    }
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "Cycle Degradation"
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 1.0
                }
            }
        },
        "DataMatrix": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "batt_lifetime_matrix"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 33.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 99.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 450.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 200.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "PasteAppendRows": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "PasteAppendCols": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "ShowButtons": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "ShowRows": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "ShowRowLabels": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "RowLabels": {
                    "Type": 5.0,
                    "String": ""
                },
                "ShadeR0C0": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "VerticalLabel": {
                    "Type": 5.0,
                    "String": ""
                },
                "HorizontalLabel": {
                    "Type": 5.0,
                    "String": ""
                },
                "ShadeC0": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "ShowCols": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "ShowColLabels": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "ColLabels": {
                    "Type": 5.0,
                    "String": "Depth-of-discharge (%),Cycles Elapsed, Capacity (%)"
                },
                "NumRowsLabel": {
                    "Type": 5.0,
                    "String": "Rows:"
                },
                "NumColsLabel": {
                    "Type": 5.0,
                    "String": "Cols:"
                },
                "Layout": {
                    "Type": 3.0,
                    "Integer": 1.0
                },
                "ChoiceColumn": {
                    "Type": 3.0,
                    "Integer": -1.0
                },
                "Choices": {
                    "Type": 5.0,
                    "String": "Choice1,Choice2"
                },
                "HideColumn": {
                    "Type": 3.0,
                    "Integer": -1.0
                },
                "ShowColumn": {
                    "Type": 3.0,
                    "Integer": -1.0
                },
                "ColorMap": {
                    "Type": 2.0,
                    "Boolean": 0.0
                }
            }
        },
        "Label": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "lbl_cycle_calendar"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 15.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 24.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 990.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 48.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "Use the options and tables below to define cycle degradation and calendar degradation curves. SAM automatically updates these inputs when you choose a battery type on the Battery Cell and System page. The empirical calendar degradation model is suitable for Lithium-ion batteries. See help for details."
                },
                "TextColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 0.0,
                        "Green": 0.0,
                        "Blue": 0.0,
                        "Alpha": 255.0
                    }
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "FontSize": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "WordWrap": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "AlignRight": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "AlignTop": {
                    "Type": 2.0,
                    "Boolean": 1.0
                }
            }
        },
        "Label": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "lbl_empirical_equation1"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 201.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 387.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 249.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 24.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": ""
                },
                "TextColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 0.0,
                        "Green": 0.0,
                        "Blue": 0.0,
                        "Alpha": 255.0
                    }
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "FontSize": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "WordWrap": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "AlignRight": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "AlignTop": {
                    "Type": 2.0,
                    "Boolean": 0.0
                }
            }
        },
        "Label": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "lbl_empirical_equation2"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 201.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 411.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 342.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 24.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": ""
                },
                "TextColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 0.0,
                        "Green": 0.0,
                        "Blue": 0.0,
                        "Alpha": 255.0
                    }
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "FontSize": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "WordWrap": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "AlignRight": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "AlignTop": {
                    "Type": 2.0,
                    "Boolean": 0.0
                }
            }
        },
        "Plot": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "plot_cap_vs_cycle"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 555.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 99.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 400.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 250.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                }
            }
        }
    },
    "VarDatabase": {
        "batt_calendar_a": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Battery empirical calendar life parameter a",
            "Units": "1/sqrt(day)",
            "Group": "Battery Life",
            "IndexLabels": "",
            "Flags": 2.0,
            "DefaultValue": 0.00266,
            "UIObject": "Numeric",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "batt_calendar_b": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Battery empirical calendar life parameter b",
            "Units": "K",
            "Group": "Battery Life",
            "IndexLabels": "",
            "Flags": 2.0,
            "DefaultValue": -7280.0,
            "UIObject": "Numeric",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "batt_calendar_c": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Battery empirical calendar life parameter c",
            "Units": "K",
            "Group": "Battery Life",
            "IndexLabels": "",
            "Flags": 2.0,
            "DefaultValue": 930.0,
            "UIObject": "Numeric",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "batt_calendar_choice": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Calendar degradation options",
            "Units": " ",
            "Group": "Battery Life",
            "IndexLabels": "None|Empirical|Custom",
            "Flags": 3.0,
            "DefaultValue": 0.0,
            "UIObject": "RadioChoice",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "batt_calendar_lifetime_matrix": {
            "Version": 4.0,
            "Type": 3.0,
            "Label": "Calendar lifetime matrix",
            "Units": " ",
            "Group": "Battery Life",
            "IndexLabels": "",
            "Flags": 3.0,
            "DefaultValue": [
                [
                    0.0,
                    100.0
                ],
                [
                    3650.0,
                    80.0
                ],
                [
                    7300.0,
                    50.0
                ]
            ],
            "UIObject": "DataMatrix",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "batt_calendar_q0": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Battery empirical calendar life parameter q0",
            "Units": "fraction",
            "Group": "Battery Life",
            "IndexLabels": "",
            "Flags": 0.0,
            "DefaultValue": 1.02,
            "UIObject": "Numeric",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "batt_lifetime_matrix": {
            "Version": 4.0,
            "Type": 3.0,
            "Label": "Lifetime matrix",
            "Units": " ",
            "Group": "Battery Life",
            "IndexLabels": "",
            "Flags": 3.0,
            "DefaultValue": [
                [
                    30.0,
                    0.0,
                    100.0
                ],
                [
                    30.0,
                    1100.0,
                    90.0
                ],
                [
                    30.0,
                    1200.0,
                    50.0
                ],
                [
                    50.0,
                    0.0,
                    100.0
                ],
                [
                    50.0,
                    400.0,
                    90.0
                ],
                [
                    50.0,
                    500.0,
                    50.0
                ],
                [
                    100.0,
                    0.0,
                    100.0
                ],
                [
                    100.0,
                    100.0,
                    90.0
                ],
                [
                    100.0,
                    150.0,
                    50.0
                ]
            ],
            "UIObject": "DataMatrix",
            "sscVariableName": "",
            "sscVariableValue": ""
        }
    },
    "Equations": [
        "// Set these values because users are unlikely to have this data",
        "// q = q0 - k_cal * sqrt(t)",
        "// k_cal = a * exp[b(1/T - 1/296)] * exp[c(SOC/T - 1/296)]",
        "equations{'batt_calendar_q0'} = define() { return 1.02; };",
        "equations{'batt_calendar_a'} = define() { return 0.00266; }; // 1/sqrt(day)",
        "equations{'batt_calendar_b'} = define() { return -7280; }; // K",
        "equations{'batt_calendar_c'} = define() { return 939; }; // K",
        ""
    ],
    "Callbacks": [
        "on_load{'Battery Life Cycle Calendar'} = define() {",
        "\ton_change{'batt_lifetime_matrix'}(); ",
        "\ton_change{'batt_calendar_choice'}();",
        "\ton_change{'batt_calendar_lifetime_matrix'}();",
        "\tcycle_calendar_message();",
        "\tvalue('batt_life_model',0);",
        "};",
        "",
        "on_change{'batt_calendar_lifetime_matrix'} = define(){",
        "\tplot_calendar_life();",
        "};",
        "",
        "on_change{'batt_calendar_choice'} = define(){",
        "",
        "\tbattery_type_message();",
        "\t",
        "\t// calendar degradation with lead acid or flow batteries may cause SSC error",
        "\tif (${batt_calendar_choice} != 0 && ${batt_chem} !=1)",
        "\t{",
        "\t\tx = yesno('Calendar Degradation\\nThe Empirical degradation model is designed for Li-ion batteries, not Lead-acid or Flow batteries.\\n\\nDo you want to use it anyway?');",
        "\t\tif ( !x )",
        "\t\t{",
        "\t\t\tvalue('batt_calendar_choice', 0);",
        "\t\t\treturn;",
        "\t\t}\t",
        "\t}",
        "\t",
        "\tshow('batt_calendar_lifetime_matrix', ${batt_calendar_choice} == 2);",
        "\trefresh();\t",
        "\teq1 = '';",
        "\teq2 = '';",
        "\tif ( ${batt_calendar_choice} == 1 )",
        "\t{",
        "\t\teq1 = 'q = 1.02 - k_cal * sqrt(t)'; ",
        "\t\teq2 = 'k_cal = 0.00266*exp[-7280*(1/T-1/296)]*exp[939*(SOC/T-1/296)]';",
        "\t}",
        "\tproperty('lbl_empirical_equation1', 'Caption', eq1);",
        "\tproperty('lbl_empirical_equation2', 'Caption', eq2);",
        "\t",
        "\tplot_calendar_life();",
        "};",
        "",
        "function cycle_calendar_message()",
        "{",
        "\tmsg = 'Use the options and tables below to define cycle degradation and calendar degradation curves. SAM automatically updates these inputs when you choose a battery type on the Battery Cell and System page. The empirical calendar degradation model is suitable for Lithium-ion batteries. See help for details.';",
        "\tclr = 'Black';",
        "\tif ( technology() == 'Fuel Cell' && ${ui_batt_life_model} != 0 )",
        "\t{",
        "\t\tlife_options = ['Cycle and Calendar Degradation','Li-ion NMC/Graphite','Li-ion LMO/LTO'];",
        "\t\tmsg = 'Disregard these inputs because the Cycle and Calendar degradation curves are not used for the ' + life_options[${ui_batt_life_model}] + ' option.';",
        "\t\tclr = 'Red';",
        "\t}",
        "\tproperty('lbl_cycle_calendar', 'Caption', msg);",
        "\tproperty('lbl_cycle_calendar', 'TextColour', clr);",
        "\tenable_cycle_calendar_inputs();",
        "}",
        "",
        "function enable_cycle_calendar_inputs()",
        "{",
        "\tis_calendar_life = ( ${ui_batt_life_model} == 0 );",
        "\tenable('batt_lifetime_matrix',is_calendar_life);",
        "\tenable('batt_calendar_lifetime_matrix',is_calendar_life);",
        "\tenable('batt_calendar_choice',is_calendar_life);",
        "\tshow('plot_cap_vs_cycle',is_calendar_life);",
        "\tshow('batt_calendar_life_plot',is_calendar_life);",
        "\trefresh();",
        "}",
        "",
        "function plot_calendar_life()",
        "{",
        "\tclearplot('batt_calendar_life_plot');",
        "\tsetplot('batt_calendar_life_plot');",
        "\t",
        "\t// vectors to plot",
        "\tt = [];",
        "\tq = [];",
        "\t",
        "\tT_vec = [];",
        "\tSOC_vec = [];",
        "\tcolor_string = [];",
        "\tlegend_string = [];",
        "\t",
        "\tif ( ${batt_calendar_choice} == 0 )",
        "\t{",
        "\t\tplotopt( { 'title'='No Calendar Degradation', 'legend'=false });",
        "\t}",
        "\telseif ( ${batt_calendar_choice} == 1 )",
        "\t{",
        "\t\ta = value('batt_calendar_a');",
        "\t\tb = value('batt_calendar_b');",
        "\t\tc = value('batt_calendar_c');",
        "\t\tq0 = value('batt_calendar_q0');",
        "\t\t",
        "\t\tdt_day = 10; // assume timestep of 10 days",
        "\t\tdq_old = 0;",
        "\t\tcount = 0;",
        "\t\tyears = 10;",
        "\t\t",
        "\t\tT_vec = [293, 303, 313, 323]; ",
        "\t\tSOC_vec = [0.5, 1.0, 0.5, 1.0];",
        "\t\ttable = cell_voltage_vs_dod();",
        "\t\tV = table{'V'};",
        "\t\tDOD = table{'DOD'};",
        "\t\t",
        "\t\tV_vec = [];",
        "\t\tfor (j = 0; j < #SOC_vec; j++)",
        "\t\t{",
        "\t\t\tV_vec[j] = 0;",
        "\t\t\tfor (i = 0; i < #DOD; i++)",
        "\t\t\t{",
        "\t\t\t\tif (1 - DOD[i]*0.01 == SOC_vec[j])",
        "\t\t\t\t{",
        "\t\t\t\t\tV_vec[j] = V[i];",
        "\t\t\t\t}",
        "\t\t\t}",
        "\t\t}",
        "\t\t\t",
        "\t\tcolor_string = ['blue', 'green', 'red', 'yellow'];",
        "\t\tlegend_string[0] = [ 'T=20C, SOC=50%'];",
        "\t\tlegend_string[1] = [ 'T=30C, SOC=100%'];",
        "\t\tlegend_string[2] = [ 'T=40C, SOC=50%'];",
        "\t\tlegend_string[3] = [ 'T=50C, SOC=100%'];",
        "\t",
        "\t\tt_max = 0;",
        "\t\t",
        "\t\tfor (scenario=0; scenario != #T_vec; scenario++)",
        "\t\t{",
        "\t\t",
        "\t\t\tT = T_vec[scenario];",
        "\t\t\tSOC = SOC_vec[scenario]; ",
        "\t\t\tV = V_vec[scenario];",
        "\t\t\tk_cal = a * exp(b*(1/T - 1/296)) * exp(c*(SOC/T - SOC/296));",
        "\t\t\tq = [];",
        "\t\t\tt = [];",
        "\t\t",
        "\t\t\tfor (day = 0; day != years * 360; day+=10)",
        "\t\t\t{",
        "\t\t\t\tdq_new = 0;",
        "\t\t\t\tif (day == 0)",
        "\t\t\t\t\tdq_new = k_cal*sqrt(dt_day);",
        "\t\t\t\telse",
        "\t\t\t\t\tdq_new = (0.5 * pow(k_cal, 2) / dq_old) * dt_day + dq_old;",
        "\t\t\t\t",
        "\t\t\t\tdq_old = dq_new;",
        "",
        "\t\t\t\tq_tmp = (q0 - dq_new)*100;",
        "\t\t\t\t",
        "\t\t\t\tif (q >=0)",
        "\t\t\t\t{",
        "\t\t\t\t\tq[count] = q_tmp;",
        "\t\t\t\t\tt[count] = day;",
        "\t\t\t\t}",
        "\t\t\t\telse",
        "\t\t\t\t{",
        "\t\t\t\t\tif (day > t_max)",
        "\t\t\t\t\t\tt_max = day;",
        "\t\t\t\t\tbreak;",
        "\t\t\t\t}",
        "\t\t\t\t\t",
        "\t\t\t\tcount++;",
        "\t\t\t}",
        "\t\t\tplot(t, q, {'thick'=2, 'type'='line', 'color'=color_string[scenario], 'series'=legend_string[scenario]});\t",
        "\t\t}",
        "\t\tplotopt( { 'title'='Empirical Calendar Degradation', 'legend'=true, 'legendpos'='right' });",
        "\t\taxis( 'x1', {'label'='Age of battery (days)', 'min'=0, 'max'=max(t)+10});",
        "\t\taxis( 'y1', {'label'='Effective capacity (%)', 'min'=0, 'max'=100});",
        "\t}",
        "\telseif (${batt_calendar_choice} == 2)",
        "\t{",
        "\t\tT_vec = [293];",
        "\t\tSOC_vec = [0.5];",
        "\t\tcolor_string = ['blue'];",
        "\t\t",
        "\t\tdata = value('batt_calendar_lifetime_matrix');\t\t\t\t",
        "\t\tif (#data < 2)",
        "\t\t\tbreak;",
        "\t\t\t",
        "\t\tfor (i = 0; i != #data; i++)",
        "\t\t{",
        "\t\t\tt[i] = data[i][0];",
        "\t\t\tq[i] = data[i][1];",
        "\t\t}",
        "\t\tt_max = max(t);",
        "\t\tplot(t, q, {'thick'=2, 'type'='line', 'color'=color_string[0]});\t",
        "\t\tplotopt( { 'title'='Custom Calendar Degradation', 'legend'=false });",
        "\t\taxis( 'x1', {'label'='Age of battery (days)', 'min'=0, 'max'=max(t)+10});",
        "\t\taxis( 'y1', {'label'='Effective capacity (%)', 'min'=0, 'max'=100});",
        "\t}",
        "}",
        "",
        "on_change{ 'batt_lifetime_matrix' } = define() {",
        "",
        "\tsetplot( 'plot_cap_vs_cycle' );",
        "\t",
        "\tblm = ${batt_lifetime_matrix};",
        "\tfor( i=0;i<#blm;i++ ) {",
        "\t\tD[i] = blm[i][0];",
        "\t\tn[i] = blm[i][1];",
        "\t\tC[i] = blm[i][2];",
        "\t\t// logmsg('D: ' + D[i] + ' n: ' + n[i] + ' C: ' + C[i]);",
        "\t}",
        "\tD_unique[0] = D[0];",
        "\tlegend_string[0] = 'DoD: ' + to_string(D[0]) +'%';",
        "\tindex = 1;",
        "\tfor ( i=0;i<#D;i++){",
        "\t\tcontained = false;",
        "\t\tfor ( j=0;j<#D_unique;j++){",
        "\t\t\tif ( D[i] == D_unique[j] )",
        "\t\t\t{",
        "\t\t\t\tcontained = true;",
        "\t\t\t\tbreak;",
        "\t\t\t}",
        "\t\t}",
        "\t\tif (contained == false)",
        "\t\t{",
        "\t\t\tD_unique[index] = D[i];",
        "\t\t\tlegend_string[index] = 'DoD: ' + to_string(D[i]) +'%';",
        "\t\t\tindex++;",
        "\t\t\t//logmsg('D_unique: ' + D_unique);",
        "\t\t}",
        "\t}",
        "",
        "\tclearplot();",
        "\tcolor_string_array = ['blue', 'green', 'red', 'yellow', 'black'];",
        "\t",
        "\tindex = 0;",
        "\tfor (i = 0; i<#D_unique; i++){",
        "\t\tn_plot = [];",
        "\t\tC_plot = [];",
        "\t\tD_plot = [];",
        "\t\tfor (j = 0; j<#D; j++){",
        "\t\t\tif (D[j] == D_unique[i])",
        "\t\t\t{",
        "\t\t\t\tn_plot[index] = n[j];",
        "\t\t\t\tC_plot[index] = C[j];",
        "\t\t\t\tD_plot[index] = D[j];",
        "\t\t\t\tindex++;",
        "\t\t\t}",
        "\t\t}",
        "\t\tplot( n_plot, C_plot, {'thick'=2, 'type'='line', 'color'=color_string_array[i], 'series'=legend_string[i]});",
        "",
        "\t}",
        "\tplotopt( {'title'='Cycle Degradation', 'legend'=true, 'legendpos'='right'});",
        "\tmax_y = max(max(C), 100);",
        "\taxis( 'x1', {'label'='Cycle number', 'min'=0, 'max'=max(n)+100});",
        "\taxis( 'y1', {'label'='Effective capacity (%)', 'min'=0, 'max'=max_y});",
        "};",
        ""
    ]
}