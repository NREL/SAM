{
    "Name": "Battery Dispatch Options FOM",
    "Width": 1053.0,
    "Height": 169.0,
    "FormObjects": {
        "CheckBox": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "batt_dispatch_auto_can_charge"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 306.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 81.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 348.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 21.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "Battery can charge from system"
                },
                "State": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": 7.0
                }
            }
        },
        "CheckBox": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "batt_dispatch_auto_can_clipcharge"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 306.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 102.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 348.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 21.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "Battery can charge from clipped system power"
                },
                "State": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": 11.0
                }
            }
        },
        "CheckBox": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "batt_dispatch_auto_can_fuelcellcharge"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 306.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 123.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 348.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 21.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "Battery can charge from fuel cell"
                },
                "State": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": 8.0
                }
            }
        },
        "CheckBox": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "batt_dispatch_auto_can_gridcharge"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 306.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 60.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 348.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 21.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "Battery can charge from grid"
                },
                "State": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": 6.0
                }
            }
        },
        "RadioChoice": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "batt_dispatch_choice_ui"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 15.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 57.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 288.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 100.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Selection": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "Items": {
                    "Type": 6.0,
                    "StringList": "Automated dispatch|PV smoothing|Dispatch to custom time series|Manual dispatch"
                },
                "ShowCaptions": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "Horizontal": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": 1.0
                }
            }
        },
        "Label": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "lbl_dispatch_options"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 15.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 21.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 918.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 36.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": ""
                },
                "TextColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 0.0,
                        "Green": 0.0,
                        "Blue": 0.0,
                        "Alpha": 255.0
                    }
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "FontSize": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "WordWrap": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "AlignRight": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "AlignTop": {
                    "Type": 2.0,
                    "Boolean": 1.0
                }
            }
        },
        "Label": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "lbl_fom_warning_message"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 657.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 60.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 381.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 83.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": ""
                },
                "TextColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 0.0,
                        "Green": 0.0,
                        "Blue": 0.0,
                        "Alpha": 255.0
                    }
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "FontSize": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "WordWrap": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "AlignRight": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "AlignTop": {
                    "Type": 2.0,
                    "Boolean": 1.0
                }
            }
        },
        "GroupBox": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "object 4"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 6.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 3.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 1042.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 162.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "Front-of-meter (FOM) Storage Dispatch Options"
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 1.0
                }
            }
        }
    },
    "VarDatabase": {
        "batt_dispatch_auto_can_charge": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Battery can charge from power generation",
            "Units": " ",
            "Group": "Battery Dispatch",
            "IndexLabels": "",
            "Flags": 3.0,
            "DefaultValue": 0.0,
            "UIObject": "CheckBox",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "batt_dispatch_auto_can_clipcharge": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Battery can charge from clipped power",
            "Units": " ",
            "Group": "Battery Dispatch",
            "IndexLabels": "",
            "Flags": 3.0,
            "DefaultValue": 0.0,
            "UIObject": "CheckBox",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "batt_dispatch_auto_can_fuelcellcharge": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Battery can charge from fuel cell",
            "Units": " ",
            "Group": "Battery Dispatch",
            "IndexLabels": "",
            "Flags": 3.0,
            "DefaultValue": 0.0,
            "UIObject": "CheckBox",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "batt_dispatch_auto_can_gridcharge": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Battery can charge from grid",
            "Units": " ",
            "Group": "Battery Dispatch",
            "IndexLabels": "",
            "Flags": 3.0,
            "DefaultValue": 0.0,
            "UIObject": "CheckBox",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "batt_dispatch_choice": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Battery dispatch option",
            "Units": " ",
            "Group": "Battery Dispatch",
            "IndexLabels": "",
            "Flags": 8.0,
            "DefaultValue": 0.0,
            "UIObject": "Default",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "batt_dispatch_choice_ui": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Battery dispatch options FOM",
            "Units": " ",
            "Group": "Battery Dispatch",
            "IndexLabels": "Automated dispatch|PV smoothing|Dispatch to custom time series|Manual dispatch",
            "Flags": 3.0,
            "DefaultValue": 3.0,
            "UIObject": "RadioChoice",
            "sscVariableName": "",
            "sscVariableValue": ""
        }
    },
    "Equations": [],
    "Callbacks": [
        "on_load{'Battery Dispatch Options FOM'} = define() ",
        "{",
        "\tshow_hide_charge_options();",
        "\tcheck_auto_ppa();",
        "\tenable_charge_from_clip();",
        "\twarning_message();",
        "\twave_batt_smoothing_msg();",
        "\tif ( technology() == 'Fuel Cell' && value('en_batt') == 0 )",
        "\t{ ",
        "\t\tmsg = 'Battery storage is not enabled. Enable battery on Battery Storage page before setting storage dispatch options.';",
        "\t\tclr = 'red';",
        "\t}",
        "\telse",
        "\t{",
        "\t\tmsg = 'The storage dispatch options determine how and when the battery charges and discharges. Choose an option below and then provide the dispatch details as appropriate.';",
        "\t\tclr = 'black';",
        "\t}",
        "\tproperty('lbl_dispatch_options','Caption',msg);",
        "\tproperty('lbl_dispatch_options','TextColour',clr);",
        "};",
        "",
        "on_change{'batt_dispatch_choice_ui'} = define() ",
        "{",
        "\tcheck_auto_ppa();",
        "\tenable_charge_from_clip();",
        "\tshow_hide_charge_options();",
        "\twave_batt_smoothing_msg();",
        "\tif (  technology() == 'Fuel Cell' )",
        "\t{",
        "\t\tcheck_fuel_cell_dispatch(); // function defined in Fuel Cell Dispatch callback",
        "\t}",
        "\tvalue('batt_dispatch_excl', value('batt_dispatch_choice_ui'));",
        "};",
        "",
        "function wave_batt_smoothing_msg()",
        "{",
        "\tcheck = value('batt_dispatch_choice_ui');",
        "\ttech = technology();",
        "\tif (check == 1 && tech == \"MEwave Battery\") ",
        "\t{",
        "\t\tproperty('lbl_fom_warning_message', 'Caption', 'The PV Smoothing dispatch option was designed for PV + battery systems with solar resource data timestep of 15 minutes or less. Using this model for wave energy converter + battery systems may lead to unexpected results.');",
        "\t\tproperty('lbl_fom_warning_message', 'TextColour', 'red');",
        "\t}",
        "}",
        "",
        "function check_auto_ppa()",
        "{",
        "\tdispatch = value('batt_dispatch_choice_ui');",
        "\tif (dispatch == 0 && value('en_batt') != 0 && financing() != \"Merchant Plant\") ",
        "\t{",
        "\t\tppa_mode = value('ppa_soln_mode');",
        "\t\tif (ppa_mode == 0) {",
        "\t\t\tmsgbox('Specify IRR Target not available for automated dispatch.\\nThe automated battery dispatch options require the Specify PPA Price option on the Revenue or Financial Parameters page.\\n\\nPlease change Specify IRR Target to Specify PPA Price and specify a PPA price and optional escalation rate to use the Automated Dispatch options.');",
        "\t\t}",
        "\t}",
        "}",
        "",
        "// hide charge options for manual dispatch",
        "function show_hide_charge_options()",
        "{",
        "\tis_dc = (value('batt_ac_or_dc' ) == 0);",
        "\toption = value('batt_dispatch_choice_ui');",
        "\tif ( technology() == 'Fuel Cell' && value('en_batt') == 0  )",
        "\t{ ",
        "\t\tenable('batt_dispatch_choice_ui',false);",
        "\t\t//Automated Dispatch Inputs",
        "\t\tenable('automated_dispatch_choice', false);",
        "\t\tenable('batt_cycle_cost', false);",
        "\t\tenable('batt_cycle_cost_choice',false);",
        "\t\tenable('batt_dispatch_update_frequency_hours', false);",
        "\t\tenable('batt_look_ahead_hours', false);",
        "\t\tenable('batt_user_specified_weather_file', false);",
        "\t\tenable('batt_select_weather_file_forecast', false);",
        "\t\t",
        "\t\t//Custom time series inputs",
        "\t\tenable('batt_custom_dispatch', false);",
        "\t\t",
        "\t}",
        "\telse",
        "\t{",
        "\t\tenable('batt_dispatch_auto_can_charge',option != 3);",
        "\t\tenable('batt_dispatch_auto_can_gridcharge', option !=3 );",
        "\t\tenable('batt_dispatch_auto_can_clipcharge', option == 0 && is_dc);",
        "\t\tshow('batt_dispatch_auto_can_fuelcellcharge', option !=3 && technology() == 'Fuel Cell' );",
        "\t}\t",
        "\tif (option == 3) { // disable these options and set to zero for manual dispatch",
        "\t\tenable('batt_dispatch_auto_can_gridcharge', false);",
        "\t\tenable('batt_dispatch_auto_can_charge', false);",
        "\t\tenable('batt_dispatch_auto_can_clipcharge', is_dc);",
        "\t}",
        "}",
        "",
        "function enable_charge_from_clip()",
        "{",
        "\t// enable charge from clipped power if dc-connected and automated dispatch",
        "\tis_dc = (value('batt_ac_or_dc' ) == 0);",
        "\tif ( is_dc && (value('batt_dispatch_choice_ui') == 0 || (value('batt_dispatch_choice_ui') == 3)))",
        "\t{ enable('batt_dispatch_auto_can_clipcharge', true); }",
        "\telse ",
        "\t{ ",
        "\t\tenable('batt_dispatch_auto_can_clipcharge',false);",
        "\t\tproperty('batt_dispatch_auto_can_clipcharge','State', 0);",
        "\t} ",
        "\twarning_message();",
        "}",
        "",
        "function warning_message() ",
        "{",
        "\tis_dc = (value('batt_ac_or_dc' ) == 0);",
        "\tcolor = 'black';",
        "\tif ( is_dc )",
        "\t{",
        "\t\tmsg = 'Battery is DC-connected.'; ",
        "\t}",
        "\telse",
        "\t{ ",
        "\t\tmsg = 'Battery is AC-connected.'; ",
        "\t}",
        "\tmsg = msg + ' Charging from clipped power is only available for automated or manual dispatch and DC-connected batteries. See input under Power Converters on Battery Cell and System page.';",
        "\tif ( value('batt_dispatch_choice_ui') == 2 ) ",
        "\t{",
        "\t\tmsg = ''; ",
        "\t}",
        "\tproperty('lbl_fom_warning_message','Caption',msg);",
        "\tproperty('lbl_fom_warning_message','TextColour',color);",
        "}",
        ""
    ]
}