Wind Farm Specifications
808
749
26
GroupBox

1
8
Name
5
9
GroupBox2
X
3
6
Y
3
117
Width
3
788
Height
3
122
Tool Tip
5
0
Caption
5
12
Wake Effects
Bold
2
1
GroupBox

1
8
Name
5
11
GroupBox222
X
3
6
Y
3
3
Width
3
788
Height
3
110
Tool Tip
5
0
Caption
5
13
System Sizing
Bold
2
1
GroupBox

1
8
Name
5
9
GroupBox4
X
3
6
Y
3
240
Width
3
788
Height
3
497
Tool Tip
5
0
Caption
5
14
Turbine Layout
Bold
2
1
Button

1
8
Name
5
26
btnOpenTurbineLocationFile
X
3
423
Y
3
267
Width
3
188
Height
3
24
Tool Tip
5
0
Caption
5
29
Import turbine layout file...
TabOrder
3
0
Numeric

1
17
Name
5
17
desired_farm_size
X
3
483
Y
3
18
Width
3
100
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
0
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Label

1
13
Name
5
14
sizing_warning
X
3
618
Y
3
15
Width
3
174
Height
3
93
Tool Tip
5
0
Caption
5
94
It is not possible to reach the desired farm size exactly with the currently selected turbine.
TextColour
4
255
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Label

1
13
Name
5
13
specify_label
X
3
618
Y
3
15
Width
3
165
Height
3
84
Tool Tip
5
0
Caption
5
77
Please specify the number of turbines using the Turbine Layout options below.
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Numeric

1
17
Name
5
15
system_capacity
X
3
483
Y
3
72
Width
3
100
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
3
Prefix
5
0
Suffix
5
1
 
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
9
Numeric

1
17
Name
5
9
wake_loss
X
3
186
Y
3
195
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
10
Numeric

1
17
Name
5
22
wind_farm_num_turbines
X
3
483
Y
3
45
Width
3
100
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
0
Format
3
0
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
8
RadioChoice

1
11
Name
5
21
wind_farm_sizing_mode
X
3
21
Y
3
24
Width
3
258
Height
3
72
Tool Tip
5
0
Selection
3
0
Items
6
3
Use a single turbine
Specify desired farm size
Specify number of turbines
ShowCaptions
2
1
Horizontal
2
0
TabOrder
3
4294967295
Choice

1
9
Name
5
20
wind_farm_wake_model
X
3
186
Y
3
141
Width
3
139
Height
3
21
Tool Tip
5
0
Items
6
4
Simple Wake Model
Park (WAsP)
Eddy-Viscosity
Constant Loss
Selection
3
4294967295
TabOrder
3
8
Numeric

1
17
Name
5
30
wind_resource_turbulence_coeff
X
3
186
Y
3
168
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
12
Image

1
8
Name
5
26
windfarm.farm.compass_rose
X
3
726
Y
3
252
Width
3
52
Height
3
55
Tool Tip
5
0
Image
7
Wind Farm Specifications_windfarm.farm.compass_rose.png
Centered
2
1
Numeric

1
17
Name
5
26
windfarm.farm.layout_angle
X
3
207
Y
3
537
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
9
Slider

1
10
Name
5
27
windfarm.farm.layout_slider
X
3
81
Y
3
561
Width
3
226
Height
3
21
Tool Tip
5
0
Value
3
10
Min
3
4294967116
Max
3
180
TabOrder
3
4294967295
Numeric

1
17
Name
5
28
windfarm.farm.number_of_rows
X
3
207
Y
3
375
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
0
Format
3
0
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4
Numeric

1
17
Name
5
20
windfarm.farm.offset
X
3
135
Y
3
477
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
7
Choice

1
9
Name
5
25
windfarm.farm.offset_type
X
3
96
Y
3
501
Width
3
139
Height
3
21
Tool Tip
5
0
Items
6
2
Every Other Row
Each Row
Selection
3
4294967295
TabOrder
3
8
Numeric

1
17
Name
5
25
windfarm.farm.row_spacing
X
3
135
Y
3
453
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
6
Choice

1
9
Name
5
19
windfarm.farm.shape
X
3
99
Y
3
399
Width
3
208
Height
3
24
Tool Tip
5
0
Items
6
2
Square / Rectangle / Parallelogram
Triangle / Trapezoid
Selection
3
4294967295
TabOrder
3
2
Numeric

1
17
Name
5
29
windfarm.farm.turbine_spacing
X
3
135
Y
3
429
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
5
Numeric

1
17
Name
5
30
windfarm.farm.turbines_per_row
X
3
207
Y
3
351
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
0
Format
3
0
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
3
RadioChoice

1
11
Name
5
32
windfarm.layout.file_or_controls
X
3
12
Y
3
258
Width
3
404
Height
3
50
Tool Tip
5
0
Selection
3
1
Items
6
2
Import wind turbine location data file
Define wind farm using layout generator (below)
ShowCaptions
2
1
Horizontal
2
0
TabOrder
3
0
Label

1
13
Name
5
23
windfarm.layout_message
X
3
24
Y
3
645
Width
3
302
Height
3
57
Tool Tip
5
0
Caption
5
14
Error messages
TextColour
4
255
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Plot

1
6
Name
5
13
windfarm_plot
X
3
348
Y
3
309
Width
3
438
Height
3
417
Tool Tip
5
0

26
adjust
3
5
Performance adjustment
 
Wind Farm
0
1
1
5
1
0
LossAdjustment
cols
3
1
Internal variable for plotting on the wind farm page
 
Wind Farm
0
12
1
1
1
1
0
Default
desired_farm_size
3
1
Desired farm size
kW
Wind Farm
0
0
1
1
1
1
0
Default
rows
3
1
Internal variable for plotting on the wind farm page
 
Wind Farm
0
12
1
1
1
1
0
Default
sizing_warning
3
1
 
 
Wind Farm
0
4
1
1
1
1
0
Default
specify_label
3
1
 
 
Wind Farm
0
4
1
1
1
1
0
Default
system_capacity
3
1
System nameplate capacity
kW
Wind Farm
0
8
1
1
1
1
0
Default
wake_loss
3
1
Constant loss
%
Wind Farm
0
2
1
1
1
1
0
Numeric
wind_farm_num_turbines
3
1
Number of turbines in farm
 
Wind Farm
0
8
1
1
1
1
0
Numeric
wind_farm_sizing_mode
3
1
 
 
Wind Farm
0
0
1
1
1
1
0
Default
wind_farm_wake_model
3
1
Wake model
 
Wind Farm
58
Simple Wake Model|Park (WAsP)|Eddy-Viscosity|Constant Loss
2
1
1
1
1
0
Choice
wind_farm_xCoord_file
3
2
 
 
Wind Farm
0
4
1
2
1
1
0
Default
wind_farm_xCoordinates
3
2
 
 
Wind Farm
0
8
1
2
1
1
0
Default
wind_farm_yCoord_file
3
2
 
 
Wind Farm
0
4
1
2
1
1
0
Default
wind_farm_yCoordinates
3
2
 
 
Wind Farm
0
8
1
2
1
1
0
Default
wind_resource_turbulence_coeff
3
1
Turbulence coefficient
 
Wind Farm
0
2
1
1
1
1
0.1
Numeric
windfarm.farm.layout_angle
3
1
Row orientation
deg
Wind Farm
0
2
1
1
1
1
0
Numeric
windfarm.farm.layout_slider
3
1
 
 
Wind Farm
0
0
1
1
1
1
0
Slider
windfarm.farm.number_of_rows
3
1
Number of rows
 
Wind Farm
0
2
1
1
1
1
4
Numeric
windfarm.farm.offset
3
1
Offset for rows
rotor diameters
Wind Farm
0
2
1
1
1
1
250
Numeric
windfarm.farm.offset_type
3
1
Offset type
 
Wind Farm
24
Every Other Row|Each Row
2
1
1
1
1
1
Choice
windfarm.farm.row_spacing
3
1
Row spacing
rotor diameters
Wind Farm
0
2
1
1
1
1
750
Numeric
windfarm.farm.shape
3
1
Shape
 
Wind Farm
0
2
1
1
1
1
0
Choice
windfarm.farm.turbine_spacing
3
1
Turbine spacing
rotor diameters
Wind Farm
0
2
1
1
1
1
500
Numeric
windfarm.farm.turbines_per_row
3
1
Turbines per row
 
Wind Farm
0
2
1
1
1
1
8
Numeric
windfarm.layout.file_or_controls
3
1
 
 
Wind Farm
86
Import wind turbine location data file|Define wind farm using layout generator (below)
0
1
1
1
1
1
RadioChoice

3422
//calculates number of turbines, xCoordinates, and yCoordinates
equations{ '$MIMO$ WindFarmCoordinates' } = define() {
	//CASE 1: layout from file
	if (${wind_farm_sizing_mode} == 2 && ${windfarm.layout.file_or_controls} == 0)
	{
		${wind_farm_num_turbines} = #${wind_farm_xCoord_file};
		${wind_farm_xCoordinates} = ${wind_farm_xCoord_file};
		${wind_farm_yCoordinates} = ${wind_farm_yCoord_file};
		return;
	}
	
	//CASE 2: automatic farm layout
	if (${wind_farm_sizing_mode} != 2)
	{
		num_turbines = 0;
		if (${wind_farm_sizing_mode} == 0) //single turbine
			num_turbines = 1;
		else //auto-sized
		{
			num = floor(${desired_farm_size} / ${wind_turbine_kw_rating});
			if (num <=1) num = 1;
			num_turbines = num;
		}
		${wind_farm_num_turbines} = num_turbines;
		
		x = alloc(num_turbines); 
		y = alloc(num_turbines);
		//assume they are laid out in roughly a square
		rows = floor(sqrt(num_turbines));
		cols = num_turbines/rows;
		while (rows * floor(cols) != num_turbines) //if not evenly divisible
		{
			rows -=1; //decrease the number of rows until it does divide evenly 
			// if num_turbines is prime, this will continue until rows = 1
			cols = num_turbines/rows;
		}
		//use default spacing assumptions, in multiples of rotor diameters
		spacing_x = 8 * ${wind_turbine_rotor_diameter};
		spacing_y = 8 * ${wind_turbine_rotor_diameter};
		x[0] = 0; y[0] = 0; //first turbine placement
		for (i = 1; i < num_turbines; i++) //remainder of turbines
		{
			x[i] = (i - cols * floor(i/cols)) *spacing_x;
			y[i] = floor(i/cols) * spacing_y;
		}	
		${wind_farm_xCoordinates} = x;
		${wind_farm_yCoordinates} = y;
		${rows} = rows;
		${cols} = cols;
		return;
	}
	
	//CASE 3: input farm layout
	shape = ${windfarm.farm.shape};
	turbines_per_row = ${windfarm.farm.turbines_per_row};
	row_count = ${windfarm.farm.number_of_rows};
	row_offset = ${windfarm.farm.offset} * ${wind_turbine_rotor_diameter};
	offset_type = ${windfarm.farm.offset_type};
	angle = pi() * ${windfarm.farm.layout_angle} / 180;
	points = 0;
	turbine_spacing = ${windfarm.farm.turbine_spacing} * ${wind_turbine_rotor_diameter};
	row_spacing = ${windfarm.farm.row_spacing} * ${wind_turbine_rotor_diameter};
	turbines_this_row = 0;

	for ( i=0; i<row_count; i++)
	{
		if (offset_type == 0)
			offset = (mod(i,2) == 0) ? 0 : row_offset;
		else
			offset = row_offset * i;

		if (shape)
			turbines_this_row = turbines_per_row - i;
		else
			turbines_this_row = turbines_per_row;

		for (j=0; j<turbines_this_row; j++)
		{
			xCoordinates[points] = ((j * turbine_spacing) + offset);
			yCoordinates[points] = (i * row_spacing);
			points++;
		}
	}

	// account for orientation of rows
	for (k=0; k<#xCoordinates; k++)
	{
		newx = (xCoordinates[k] * cos(angle)) - (yCoordinates[k] * sin(angle));
		newy = (xCoordinates[k] * sin(angle)) + (yCoordinates[k] * cos(angle));
		xCoordinates[k] = newx;
		yCoordinates[k] = newy;
	}
	${wind_farm_xCoordinates} = xCoordinates;
	${wind_farm_yCoordinates} = yCoordinates;
	${wind_farm_num_turbines} = #xCoordinates;
	return;	
};

equations{ 'system_capacity' } = define() {
	return ${wind_farm_num_turbines} * ${wind_turbine_kw_rating};
};

equations{ 'sizing_warning' } = define() {
	if (${wind_farm_sizing_mode} == 1 && ${desired_farm_size} != ${system_capacity})
		return 1;
	else
		return 0;
};

equations{ 'specify_label' } = define() {
	if (${wind_farm_sizing_mode} == 2)
		return 1;
	else
		return 0;
};
5325
function update_farm_layout_controls()
{
	weibull = (${wind_resource_model_choice} == 1);
	single = (${wind_farm_sizing_mode} == 0);
	desired = (${wind_farm_sizing_mode} == 1);
	specify = (${wind_farm_sizing_mode} == 2);
	design = (specify && ${windfarm.layout.file_or_controls} == 1);
	file_import = (specify && ${windfarm.layout.file_or_controls} == 0);
	
	enable('wind_resource_turbulence_coeff', !weibull);
	enable('wind_farm_wake_model', !single && !weibull);
	enable('windfarm.layout.file_or_controls', specify);
	enable('btnOpenTurbineLocationFile', file_import);
    enable("windfarm.farm.shape", design);
    enable("windfarm.farm.turbines_per_row", design);
    enable("windfarm.farm.number_of_rows", design);
    enable("windfarm.farm.number_of_turbines", design);
    enable("windfarm.farm.turbine_spacing", design);
    enable("windfarm.farm.row_spacing", design);
    enable("windfarm.farm.offset", design);
    enable("windfarm.farm.offset_type", design);
    enable("windfarm.farm.layout_angle", design);
    enable("windfarm.farm.layout_slider", design);
}

function plot_wind_farm()
{
	setplot("windfarm_plot");
	clearplot('windfarm_plot');
	plotopt( {"title"="Turbine Layout Map","backcolor"=[255,255,255], "popup"=true, "legend"=false}  );

	xCoordinates = ${wind_farm_xCoordinates};
	yCoordinates = ${wind_farm_yCoordinates};

	plot( xCoordinates, yCoordinates,  {"thick"=2, "type"="scatter", "scale"=true});

	width = property( 'windfarm_plot', 'width' );
	height = property( 'windfarm_plot', 'height' );
	
	xmax = max( xCoordinates );
	xmin = min( xCoordinates );
	ymax = max( yCoordinates );
	ymin = min( yCoordinates );

	ratio = width/height;
	xspan = xmax - xmin;
	yspan = ymax - ymin;

	padx = max(xspan * 0.05, 3);
	pady = max(yspan * 0.05, 3);	
	
	axis( 'x1', {'label'='meters', 'min'=floor(xmin-padx), 'max'=ceil(xmin+xspan+padx) });
	axis( 'y1', {'label'='meters', 'min'=floor(ymin-pady), 'max'=ceil(ymin+yspan+pady) });
	
	return 0;
}

on_change{'btnOpenTurbineLocationFile'} = define() {
	file = choose_file( '', 'Choose a turbine layout file', 'CSV Files (*.txt,*.csv)|*.txt;*.csv');
	if ( file != '' ) {
		file = replace(file, '\\', '/');
		fn = open(file,'r');
		
		if (!fn) {
			msgbox('SAM could not open the file.');
			return 0;
		}
		
		line="";
		i=0;
		while (read_line(fn,line)) {
			aline = split(line,',');
			// look for rows with 2 or more comma separated values, where the 
			// first char of the first value is a digit OR A NEGATIVE SIGN!!
			firstdig = ch(aline[0],0);
			if ( (isdigit(firstdig) || firstdig == '-') && #aline>1 )
			{
				replace(line,',',' ');
				pt = real_array(line);
				if (#pt>1) {
					xCoordinates[i] = pt[0];
					yCoordinates[i] = pt[1];
					i++;			
				}
 			}
		}
		close(fn);
		
		if (i>0) {
			value('wind_farm_xCoord_file', xCoordinates);
			value('wind_farm_yCoord_file', yCoordinates);
			property('windfarm.layout_message', 'Caption', "Successfully imported " + i + " coordinate pairs from the file.");
		}
		else {
			msgbox("SAM did not find any valid coordinates in the file." );
			return;
		}
	}
	else {
		msgbox("SAM could not read the turbine layout file." );
	}
};

on_load{"Wind Farm Specifications"}=define()
{
	property('windfarm.layout_message', 'Caption', "" );

	//show or hide desired farm size
	bEnableDesiredFarm = (${wind_farm_sizing_mode} == 1);
	show('desired_farm_size', bEnableDesiredFarm);
	//update all other inputs
	update_farm_layout_controls();
	show('sizing_warning', ${sizing_warning});
	show('specify_label', ${specify_label});
	//plot turbine locations (created in an equation)
	plot_wind_farm();
	
	constant_loss = (${wind_farm_wake_model} != 3);
	enable( "wind_resource_turbulence_coeff", constant_loss);
	enable( "wake_loss", !constant_loss);
};

on_change{"windfarm.layout.file_or_controls"} = define()
{
	update_farm_layout_controls();
};

on_change{"wind_farm_sizing_mode"} = define()
{
	//enable desired farm size only for option 1
	bEnableDesiredFarm = (${wind_farm_sizing_mode} == 1);
	show('desired_farm_size', bEnableDesiredFarm);
	if (bEnableDesiredFarm) // if this option was just selected
	{
		//apply calculated values to inputs
		value('windfarm.farm.turbines_per_row', ${cols});
		value('windfarm.farm.number_of_rows', ${rows});
		value('windfarm.farm.shape', 0);
		value('windfarm.farm.turbine_spacing', 8);
		value('windfarm.farm.row_spacing', 8);
		value('windfarm.farm.offset', 0);
		value('windfarm.farm.offset_type', 0);
		value('windfarm.farm.layout_angle', 0);
	}
	refresh();
	update_farm_layout_controls();
};

on_change{'wind_farm_num_turbines'} = define() {
	plot_wind_farm();
};

on_change{'windfarm.farm.layout_slider'} = define() {
	angle = ${windfarm.farm.layout_slider};
	value('windfarm.farm.layout_angle', angle );
	plot_wind_farm();
};

on_change{'desired_farm_size'} = define() {
	value('windfarm.farm.turbines_per_row', ${cols});
	value('windfarm.farm.number_of_rows', ${rows});
};

on_change{'sizing_warning'} = define() {
	show('sizing_warning', ${sizing_warning});
	refresh();
};

on_change{'specify_label'} = define() {
	show('specify_label', ${specify_label});
};

on_change{'wind_farm_wake_model'} = define() {
	constant_loss = (${wind_farm_wake_model} != 3);
	enable( "wind_resource_turbulence_coeff", constant_loss);
	enable( "wake_loss", !constant_loss);
};