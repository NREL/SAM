{
    "Name": "Inverter Temp Derate CEC DB",
    "Width": 994.0,
    "Height": 308.0,
    "FormObjects": {
        "GroupBox": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "GroupBox1"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 9.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 6.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 980.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 300.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "Inverter Temperature Derate Curves"
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 1.0
                }
            }
        },
        "Button": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "btn_update_cec_db_plot"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 24.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 267.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 135.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 28.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "Update plot"
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": -1.0
                }
            }
        },
        "Label": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "inv_derate_label"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 177.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 264.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 306.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 39.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "Table supports up to four temperature - slope pairs per row."
                },
                "TextColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 0.0,
                        "Green": 0.0,
                        "Blue": 0.0,
                        "Alpha": 255.0
                    }
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "FontSize": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "WordWrap": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "AlignRight": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "AlignTop": {
                    "Type": 2.0,
                    "Boolean": 1.0
                }
            }
        },
        "DataMatrix": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "inv_tdc_cec_db"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 21.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 39.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 476.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 223.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "PasteAppendRows": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "PasteAppendCols": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "ShowButtons": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "ShowRows": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "ShowRowLabels": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "RowLabels": {
                    "Type": 5.0,
                    "String": ""
                },
                "ShadeR0C0": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "VerticalLabel": {
                    "Type": 5.0,
                    "String": ""
                },
                "HorizontalLabel": {
                    "Type": 5.0,
                    "String": ""
                },
                "ShadeC0": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "ShowCols": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "ShowColLabels": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "ColLabels": {
                    "Type": 5.0,
                    "String": "Vdc(V),Tstart(C),Slope(1/C),Tstart(C),Slope(1/C),Tstart(C),Slope(1/C),Tstart(C),Slope(1/C)"
                },
                "NumRowsLabel": {
                    "Type": 5.0,
                    "String": "Rows:"
                },
                "NumColsLabel": {
                    "Type": 5.0,
                    "String": "Cols:"
                },
                "Layout": {
                    "Type": 3.0,
                    "Integer": 1.0
                },
                "ChoiceColumn": {
                    "Type": 3.0,
                    "Integer": -1.0
                },
                "Choices": {
                    "Type": 5.0,
                    "String": "Choice1,Choice2"
                },
                "HideColumn": {
                    "Type": 3.0,
                    "Integer": -1.0
                },
                "ShowColumn": {
                    "Type": 3.0,
                    "Integer": -1.0
                },
                "ColorMap": {
                    "Type": 2.0,
                    "Boolean": 0.0
                }
            }
        },
        "Plot": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "inv_tdc_cec_db_plot"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 504.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 27.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 469.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 262.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                }
            }
        }
    },
    "VarDatabase": {
        "inv_tdc_cec_db": {
            "Version": 4.0,
            "Type": 3.0,
            "Label": "Inv Temp Derate CEC Database",
            "Units": " ",
            "Group": "PV Inverter (CEC Database)",
            "IndexLabels": "",
            "Flags": 3.0,
            "DefaultValue": [
                [
                    1.0,
                    52.8,
                    -0.021
                ]
            ],
            "UIObject": "DataMatrix",
            "sscVariableName": "",
            "sscVariableValue": ""
        }
    },
    "Equations": [],
    "Callbacks": [
        "function inv_tdc_cec_db_update_plot()",
        "{",
        "\tVdc = [];",
        "\tT = [[]];",
        "\tslope = [[]];",
        "\t",
        "\tinput = ${inv_tdc_cec_db};",
        "\tnr = #input;",
        "\tidx=0;",
        "\twhile( idx < nr )",
        "\t{",
        "\t\tif (input[idx][0] > 0){",
        "\t\t\tVdc[idx] = input[idx][0];",
        "\t\t\tif (mod(#input[idx]-1, 2) != 0 || #input[idx] > 9) {",
        "\t\t\t\tmsgbox('Inverter Temperature Derate Table Error.\\nThe number of columns in the table is incorrect. Each row must have one Vdc value and at least one pair of Tstart-Slope values. Acceptable numbers of columns are 3, 5, 7, and 9 for up to four Tstart-Slope pairs.');",
        "\t\t\t\tproperty('inv_derate_label', 'Caption', 'Inputs are incorrect. Please check the number of columns in the table.');",
        "\t\t\t\tproperty('inv_derate_label', 'TextColour', 'red');",
        "\t\t\t\treturn;",
        "\t\t\t}",
        "\t\t\telse {",
        "\t\t\t\tproperty('inv_derate_label', 'Caption', 'Table supports up to four temperature - slope pairs per row.');",
        "\t\t\t\tproperty('inv_derate_label', 'TextColour', 'black');",
        "\t\t\t}",
        "\t\t\tfor ( p = 0; p<(#input[idx]-1)/2; p++ ){",
        "\t\t\t\tT[idx][p] = input[idx][2*p+1];",
        "\t\t\t\tif (T[idx][p] < -273) {",
        "\t\t\t\t\tmsgbox('Inverter Temperature Derate Table Error.\\nStart temp '+p+ ' of curve ' + idx+ ' is not valid.');",
        "\t\t\t\t\tproperty('inv_derate_label', 'Caption', 'Inputs are not correct. Start temp '+p+ ' of curve ' + idx+ ' is not valid');",
        "\t\t\t\t\tproperty('inv_derate_label', 'TextColour', 'red');",
        "\t\t\t\t\tT[idx][p] = 0;",
        "\t\t\t\t}",
        "\t\t\t\t",
        "\t\t\t\tslope[idx][p] = input[idx][2*p+2];",
        "\t\t\t\tif (slope[idx][p] > 0 || slope[idx][p] < -1) {",
        "\t\t\t\t\tmsgbox('Inverter Temperature Derate Table Error.\\nSlope '+p+ ' of curve ' + idx+ ' is not valid.');",
        "\t\t\t\t\tproperty('inv_derate_label', 'Caption', 'Inputs are not correct. Slope '+p+ ' of curve ' + idx+ ' is not valid.');",
        "\t\t\t\t\tproperty('inv_derate_label', 'TextColour', 'red');",
        "\t\t\t\t\tslope[idx][p] = 0;\t",
        "\t\t\t\t}",
        "\t\t\t}",
        "\t\t}",
        "\t\tidx++;",
        "\t}",
        "\t",
        "\tcurves = [ [ 1000, 25, 'black' ],",
        "\t\t\t   [ 800,  25, 'blue' ],",
        "\t\t\t   [ 600,  25, 'red' ],",
        "\t\t\t   [ 400,  25, 'forest green' ],",
        "\t\t\t   [ 200,  25, 'orange' ] ];",
        "\t\t\t   ",
        "\tsetplot( 'inv_tdc_cec_db_plot' );",
        "\tclearplot();",
        "\t",
        "\tconst np = 150;",
        "\txx = alloc(np);",
        "\tyy = alloc(np);",
        "\tfor( i=0;i<#Vdc;i++ )",
        "\t{\t",
        "\t\tnPairs = #T[i];",
        "\t",
        "\t\txx[0] = 0;",
        "\t\tyy[0] = (0 <= T[i][0] ) ? 1 : 1+slope[i][0]*(-T[i][0]);",
        "\t\tpIdx = 1;",
        "\t\twhile (pIdx*0.4 < T[i][0]){",
        "\t\t\txx[pIdx] = pIdx*0.4;",
        "\t\t\tyy[pIdx] = 1;",
        "\t\t\tpIdx++;",
        "\t\t}",
        "\t\tfor (j=0; j<nPairs; j++){",
        "\t\t\tintervalEnd = (j > #T[i] - 2) ? 60:  T[i][j+1];",
        "\t\t\twhile( pIdx*0.4 < intervalEnd){",
        "\t\t\t\txx[pIdx] = pIdx*0.4;",
        "\t\t\t\tyy[pIdx] = yy[pIdx-1] + slope[i][j]*0.4;",
        "\t\t\t\tif (yy[pIdx] <= 0) yy[pIdx] = 0;",
        "\t\t\t\tpIdx++;",
        "\t\t\t}",
        "",
        "\t\t}",
        "\t\tplot(xx,yy,{'series'=sprintf('@ %g Vdc', Vdc[i]),",
        "\t\t\t\"thick\"=1, \"scale\"=true,\"color\"=curves[i][2]});",
        "",
        "\t}",
        "\t//Make the plot",
        "\tplotopt({\"popup\"=false,\"backcolor\"=[255,255,255],\"legend\"=true, 'legendpos'='southwest'});",
        "\taxis('x1', {'label'='Ambient Temp (C)', 'min'=0, 'max'=60});",
        "\taxis('y1', {'label'='Max power / Rated power', 'min'=0, 'max'= (1.1)});",
        "",
        "}",
        "",
        "on_load{ 'Inverter Temp Derate CEC DB' } = define() {\t",
        "\tinv_tdc_cec_db_update_plot();",
        "};",
        "",
        "on_change{'btn_update_cec_db_plot'} = define() {\t",
        "\tinv_tdc_cec_db_update_plot();",
        "};"
    ]
}