Physical Trough Thermal Storage
910
437
31
GroupBox

1
8
Name
5
9
GroupBox1
X
3
6
Y
3
105
Width
3
900
Height
3
326
Tool Tip
5
0
Caption
5
14
Storage System
Bold
2
1
Numeric

1
17
Name
5
5
Q_tes
X
3
282
Y
3
126
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
3
Numeric

1
17
Name
5
22
TES_COPY_T_loop_in_des
X
3
672
Y
3
63
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
1
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
19
TES_COPY_T_loop_out
X
3
672
Y
3
36
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
1
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
20
TES_COPY_q_pb_design
X
3
282
Y
3
36
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
1
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
16
TES_COPY_tshours
X
3
282
Y
3
63
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
1
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
14
cold_tank_Thtr
X
3
672
Y
3
150
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
11
Numeric

1
17
Name
5
18
cold_tank_max_heat
X
3
672
Y
3
174
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
15
Choice

1
9
Name
5
18
combo_tes_htf_type
X
3
672
Y
3
270
Width
3
124
Height
3
21
Tool Tip
5
0
Items
6
10
Solar Salt
Caloria
Hitec XL
VP-1
Hitec
Dowtherm Q
Dowtherm RP
Therminol 59
Therminol 66
User-defined...
Selection
3
4294967295
TabOrder
3
21
Numeric

1
17
Name
5
28
csp.dtr.tes.htf_max_opt_temp
X
3
672
Y
3
342
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
16
Numeric

1
17
Name
5
28
csp.dtr.tes.htf_min_opt_temp
X
3
672
Y
3
318
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
16
Numeric

1
17
Name
5
22
csp.pt.tes.htf_density
X
3
672
Y
3
294
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
24
Numeric

1
17
Name
5
24
csp.pt.tes.tank_diameter
X
3
282
Y
3
270
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
7
Numeric

1
17
Name
5
7
dt_cold
X
3
672
Y
3
390
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
18
Numeric

1
17
Name
5
6
dt_hot
X
3
672
Y
3
366
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
17
Numeric

1
17
Name
5
11
eta_tes_htr
X
3
672
Y
3
246
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
16
Numeric

1
17
Name
5
6
h_tank
X
3
282
Y
3
174
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
5
Numeric

1
17
Name
5
10
h_tank_min
X
3
282
Y
3
198
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
6
Numeric

1
17
Name
5
13
hot_tank_Thtr
X
3
672
Y
3
198
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
12
Numeric

1
17
Name
5
17
hot_tank_max_heat
X
3
672
Y
3
222
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
15
Numeric

1
17
Name
5
20
init_hot_htf_percent
X
3
672
Y
3
126
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
11
GroupBox

1
8
Name
5
8
object 4
X
3
6
Y
3
12
Width
3
900
Height
3
87
Tool Tip
5
0
Caption
5
24
System Design Parameters
Bold
2
1
Numeric

1
17
Name
5
13
q_dot_tes_est
X
3
282
Y
3
318
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
10
MaterialProperties

1
7
Name
5
14
store_fl_props
X
3
804
Y
3
267
Width
3
59
Height
3
27
Tool Tip
5
0
TabOrder
3
22
Numeric

1
17
Name
5
10
tank_pairs
X
3
282
Y
3
246
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
1
Mode
3
0
Format
3
0
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4
CheckBox

1
9
Name
5
17
tanks_in_parallel
X
3
369
Y
3
405
Width
3
20
Height
3
24
Tool Tip
5
0
Caption
5
0
State
2
1
TabOrder
3
4294967295
Numeric

1
17
Name
5
13
tes_avail_vol
X
3
282
Y
3
150
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4
Label

1
13
Name
5
14
tes_bypass_msg
X
3
117
Y
3
375
Width
3
267
Height
3
33
Tool Tip
5
0
Caption
5
0
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Numeric

1
17
Name
5
13
tes_pump_coef
X
3
282
Y
3
342
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4
Numeric

1
17
Name
5
6
u_tank
X
3
282
Y
3
294
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
9
Numeric

1
17
Name
5
8
vol_tank
X
3
282
Y
3
222
Width
3
100
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
2

52
Q_tes
3
1
TES thermal capacity
MWt-hr
Physical Trough Thermal Storage
0
8
1
1
1
1
0
Numeric
TES_COPY_T_loop_in_des
3
1
Loop inlet HTF temperature
°C
Physical Trough Thermal Storage
0
8
1
1
1
1
293
Default
TES_COPY_T_loop_out
3
1
Loop outlet HTF temperature
°C
Physical Trough Thermal Storage
0
8
1
1
1
1
391
Default
TES_COPY_q_pb_design
3
1
Cycle thermal power
MWt
Physical Trough Thermal Storage
0
8
1
1
1
1
0
Default
TES_COPY_tshours
3
1
Hours of storage at design point
hours
Physical Trough Thermal Storage
0
8
1
1
1
1
6
Numeric
T_tank_cold_ini
3
1
Initial TES fluid temp
°C
Physical Trough Thermal Storage
0
2
1
1
1
1
300
Numeric
T_tank_hot_inlet_min
3
1
Minimum hot tank htf inlet temperature
C
Physical Trough Thermal Storage
0
2
1
1
1
1
400
Default
V_tank_hot_ini
3
1
Initial hot tank volume
m³
Physical Trough Thermal Storage
0
8
1
1
1
1
0
Default
V_tes_des
3
1
Design-point velocity to size the TES pipe diameters
m/s
Physical Trough Thermal Storage
0
2
1
1
1
1
1.85
Default
cold_tank_Thtr
3
1
Cold tank heater temperature set point
°C
Physical Trough Thermal Storage
0
2
1
1
1
1
250
Numeric
cold_tank_max_heat
3
1
Cold tank heater capacity
MWe
Physical Trough Thermal Storage
0
2
1
1
1
1
0.5
Default
combo_tes_htf_type
3
1
Storage HTF fluid
 
Physical Trough Thermal Storage
125
Hitec Solar Salt|Caloria HT 43|Hitec XL|Therminol VP-1|Hitec|Dowtherm Q|Dowtherm RP|Therminol 59|Therminol 66|User-defined...
2
1
1
1
1
3
Choice
csp.dtr.tes.fluid_sph
3
1
TES specific heat
kJ/kg-K
Physical Trough Thermal Storage
0
8
1
1
1
1
0
Numeric
csp.dtr.tes.htf_calc_temp
3
1
Fluid temperature
°C
Physical Trough Thermal Storage
0
8
1
1
1
1
0
Numeric
csp.dtr.tes.htf_max_opt_temp
3
1
Storage HTF max operating temp
°C
Physical Trough Thermal Storage
0
8
1
1
1
1
0
Numeric
csp.dtr.tes.htf_min_opt_temp
3
1
Storage HTF min operating temp
°C
Physical Trough Thermal Storage
0
8
1
1
1
1
0
Numeric
csp.dtr.tes.min_fluid_volume
3
1
Min fluid volume
m³
Physical Trough Thermal Storage
0
8
1
1
1
1
0
Numeric
csp.dtr.tes.thermal_capacity
3
1
TES thermal capacity
MWt-hr
Physical Trough Thermal Storage
0
8
1
1
1
1
0
Default
csp.pt.tes.htf_density
3
1
HTF density
kg/m³
Physical Trough Thermal Storage
0
8
1
1
1
1
0
Numeric
csp.pt.tes.tank_diameter
3
1
Tank diameter
m
Physical Trough Thermal Storage
0
8
1
1
1
1
0
Numeric
custom_tes_p_loss
3
1
TES pipe losses are based on custom lengths and coeffs
 
Physical Trough Thermal Storage
0
2
1
1
1
1
0
Default
custom_tes_pipe_sizes
3
1
Use custom SGS pipe diams, wallthks, and lengths
 
Physical Trough Thermal Storage
0
2
1
1
1
1
0
Default
dt_cold
3
1
Cold side HX approach temp
°C
Physical Trough Thermal Storage
0
8
1
1
1
1
7
Numeric
dt_hot
3
1
Hot side HX approach temp
°C
Physical Trough Thermal Storage
0
2
1
1
1
1
5
Numeric
eta_tes_htr
3
1
Tank heater efficiency
 
Physical Trough Thermal Storage
0
2
1
1
1
1
0.98
Numeric
f_tc_cold
3
1
Tank hot/cold flag
0/1
Physical Trough Thermal Storage
0
9
1
1
1
1
2
Default
h_tank
3
1
Tank height
m
Physical Trough Thermal Storage
0
2
1
1
1
1
20
Numeric
h_tank_min
3
1
Tank fluid minimum height
m
Physical Trough Thermal Storage
0
2
1
1
1
1
1
Numeric
has_hot_tank_bypass
3
1
Bypass valve connects field outlet to cold tank
-
Physical Trough Thermal Storage
0
2
1
1
1
1
0
Default
hot_tank_Thtr
3
1
Hot tank heater temperature set point
°C
Physical Trough Thermal Storage
0
2
1
1
1
1
365
Numeric
hot_tank_max_heat
3
1
Hot tank heater capacity
MWe
Physical Trough Thermal Storage
0
2
1
1
1
1
25
Numeric
hx_config
3
1
Heat exchanger configuration
 
Physical Trough Thermal Storage
0
9
1
1
1
1
2
Default
init_hot_htf_percent
3
1
Initial hot HTF percent
%
Physical Trough Thermal Storage
0
2
1
1
1
1
30
Default
is_hx
3
1
Heat exchanger no/yes flag
0/1
Physical Trough Thermal Storage
0
9
1
1
1
1
0
Default
k_tes_loss_coeffs
3
3
Minor loss coeffs for the coll, gen, and bypass loops
 
Physical Trough Thermal Storage
0
2
1
3
1
11
0 0 0 0 0 0 0 0 0 0 0 

Default
nodes
3
1
Nodes modeled in the flow path
 
Physical Trough Thermal Storage
0
9
1
1
1
1
2000
Default
q_dot_tes_est
3
1
Estimated heat loss
MWt
Physical Trough Thermal Storage
0
8
1
1
1
1
0
Numeric
store_fl_props
3
3
User-defined HTF fluid
 
Physical Trough Thermal Storage
0
1
1
3
1
1
1
MaterialProperties
store_fluid
3
1
Storage HTF fluid ID number
 
Physical Trough Thermal Storage
0
9
1
1
1
1
0
Default
t_ch_out_max
3
1
Max allowable cold side outlet temp during charge constant
 
Physical Trough Thermal Storage
0
9
1
1
1
1
500
Default
t_dis_out_min
3
1
Min allowable hot side outlet temp during discharge constant
 
Physical Trough Thermal Storage
0
9
1
1
1
1
500
Default
tank_pairs
3
1
Parallel tank pairs
 
Physical Trough Thermal Storage
0
2
1
1
1
1
1
Numeric
tanks_in_parallel
3
1
Field HTF can bypass TES to cycle
-
Physical Trough Thermal Storage
0
2
1
1
1
1
1
Default
tc_fill
3
1
Thermocline fill material constant
 
Physical Trough Thermal Storage
0
9
1
1
1
1
7
Default
tc_void
3
1
Thermocline void fraction constant
 
Physical Trough Thermal Storage
0
9
1
1
1
1
0.25
Default
tes_avail_vol
3
1
Available HTF volume
m³
Physical Trough Thermal Storage
0
8
1
1
1
1
0
Default
tes_diams
3
3
Custom SGS diameters
m
Physical Trough Thermal Storage
0
2
1
3
1
1
-1
Default
tes_pump_coef
3
1
Pumping power for HTF through storage
kJ/kg
Physical Trough Thermal Storage
0
2
1
1
1
1
0.15
Numeric
tes_type
3
1
TES type (1=two-tank, 2=thermocline)
 
Physical Trough Thermal Storage
0
9
1
1
1
1
1
Default
tes_wallthicks
3
3
Custom SGS wall thicknesses
m
Physical Trough Thermal Storage
0
2
1
3
1
1
-1
Default
u_tank
3
1
Wetted loss coefficient
Wt/m²-K
Physical Trough Thermal Storage
0
2
1
1
1
1
0.3
Numeric
vol_tank
3
1
Storage tank volume
m³
Physical Trough Thermal Storage
0
8
1
1
1
1
0
Numeric

4011
//
//  ONLY ADD UI INDICATOR, COMBO CONVERTERS, AND
//  INPUT AGGREGATOR EQUATIONS BELOW!
//
//   If the equations change an input value
//   modify the below main MIMO or add one,
//   referencing in ssc_equations.h
//


// Just combo converter
equations{ 'store_fluid' } = define() {
	return ?${combo_tes_htf_type}
	[
		18, //    18.) Nitrate Salt**
		19, //    19.) Caloria HT 43**
		20, //    20.) Hitec XL**
		21, //    21.) Therminol VP-1**
		22, //    22.) Hitec**
		23, //    23.) Dowtherm Q**
		24, //    24.) Dowtherm RP**
		30, //    30.) Therminol 59
		29, //    29.) Therminol 66    
		50  //    user defined HTF
	];
};

// Just combo converter
equations{ 'csp.dtr.tes.htf_min_opt_temp' } = define() {
	return ?${combo_tes_htf_type}
	[
		238, /* fluid num 18 */ 	
		-12, /* fluid num 19 */ 	
		120, /* fluid num 20 */ 	
		12,  /* fluid num 21 */ 	
		142, /* fluid num 22 */ 	
		-35, /* fluid num 23 */ 	
		0,   /* fluid num 24 */ 	
		-45, /* fluid num 30 */ 	
		0,   /* fluid num 29 */ 	
		0    /* user fluid */ 
	];
};

// Just combo converter
equations{ 'csp.dtr.tes.htf_max_opt_temp' } = define() {
	return ?${combo_tes_htf_type}
	[
		593,/* fluid num 18 */
		315,/* fluid num 19 */
		500,/* fluid num 20 */
		400,/* fluid num 21 */
		538,/* fluid num 22 */
		330,/* fluid num 23 */
		330,/* fluid num 24 */
		315,/* fluid num 30 */
		345,/* fluid num 29 */
		0/* user fluid */
	];
};

// Just UI indicator	
equations{ 'TES_COPY_q_pb_design' } = define(){
	return ${q_pb_design}; };

// Just UI indicator	
equations{ 'TES_COPY_tshours' } = define(){
	return ${tshours}; };
	
// Just UI indicator	
equations{ 'TES_COPY_T_loop_out' } = define(){
	return ${T_loop_out}; };

// Just UI indicator	
equations{ 'TES_COPY_T_loop_in_des' } = define(){
	return ${T_loop_in_des}; };

// Just UI indicator	
equations{ 'csp.dtr.tes.thermal_capacity' } = define(){
	return ${Q_tes}; };

// Just UI indicator
equations{ 'dt_cold' } = define() {
	return ${dt_hot}; };

// Just UI indicator
equations{ 'csp.dtr.tes.htf_calc_temp' } = define() {
	return ( ${T_loop_in_des} + ${T_loop_out} )/2; };

// Just UI indicator
equations{ 'V_tank_hot_ini' } = define() {
	return ${h_tank_min}/${h_tank}*${vol_tank}; };

// Just UI indicator
equations{ 'csp.dtr.tes.min_fluid_volume' } = define() {
	return ${vol_tank}*${h_tank_min}/${h_tank}; };

// Just UI indicators
equations{ '$MIMO$ ui_tes_calcs' } = define()
{
	obj = ssc_create();

	ssc_var(obj, "P_ref", ${q_pb_design});				//[MWe]
	ssc_var(obj, "design_eff", 1.0);					//[-]
	ssc_var(obj, "tshours", ${tshours});				//[hrs]
	ssc_var(obj, "T_htf_hot_des", ${T_loop_out});		//[C]
	ssc_var(obj, "T_htf_cold_des", ${T_loop_in_des});	//[C]
	ssc_var(obj, "store_fluid", ${store_fluid});			//[-]
	ssc_var(obj, "store_fl_props", ${store_fl_props});	//[-]
	ssc_var(obj, "h_tank_min", ${h_tank_min});			//[m]
	ssc_var(obj, "h_tank", ${h_tank});					//[m]
	ssc_var(obj, "tank_pairs", ${tank_pairs});			//[-]
	ssc_var(obj, "u_tank", ${u_tank});					//[-]
	ssc_var(obj, "field_fluid", ${Fluid});
	ssc_var(obj, "field_fl_props", ${field_fl_props});
	ssc_var(obj, "dt_hot", ${dt_hot});					//[K]

	ret = ssc_exec(obj, 'ui_tes_calcs');
	
	if(ret==0) {
		q_tes_des = ssc_var(obj, "q_tes");					//[MWt-hr]
		vol_one_temp_avail = ssc_var(obj, "tes_avail_vol");	//[m^3]
		vol_one_temp_total = ssc_var(obj, "vol_tank");		//[m^3]
		d_tank = ssc_var(obj, "csp_pt_tes_tank_diameter"); 	//[m]
		q_dot_loss = ssc_var(obj, "q_dot_tes_est");			//[MWt]
		dens = ssc_var(obj, "csp_pt_tes_htf_density");		//[kg/m^3]
		is_hx = !ssc_var(obj, "are_htfs_equal");		//[-]
	}
	else {
		q_tes_des = 1.0/0.0;
		vol_one_temp_avail = 1.0/0.0;
		vol_one_temp_total = 1.0/0.0;
		d_tank = 1.0/0.0;
		q_dot_loss = 1.0/0.0;
		dens = 1.0/0.0;
		is_hx = true;
	}
	
	${Q_tes} = q_tes_des;
	${tes_avail_vol} = vol_one_temp_avail;
	${vol_tank} = vol_one_temp_total;
	${csp.pt.tes.tank_diameter} = d_tank;
	${q_dot_tes_est} = q_dot_loss;
	${csp.pt.tes.htf_density} = dens;
	${is_hx} = is_hx;
	
	ssc_free( obj );	
};

1301
on_load{'Physical Trough Thermal Storage'} = define() {
	on_change{"combo_tes_htf_type"}();
	on_change{"is_hx"}();
	
	// constants and initial conditions
	value("tc_fill", 7);
	value("tc_void", 0.25);
	value("t_dis_out_min", 500);
	value("t_ch_out_max", 500);
	value("nodes", 2000);
	value("f_tc_cold", 2);	
};

function hx_derate_update_module() {

	is_hx = ${is_hx};

	enable('dt_hot', is_hx );
	enable('dt_cold', is_hx );
	enable('tanks_in_parallel', !is_hx);
	set_tes_bypass_msg(is_hx);
}

function hx_derate_update() {
	
	hx_derate_update_module();
}

function set_tes_bypass_msg ( v ) {
	msg = '';
	if ( v ) {
		msg = "If the storage fluid is different than the field HTF, then the field and TES must operate in parallel.";
	}
	property('tes_bypass_msg','Caption',msg);
}

on_change{"is_hx"} = define(){
	
	is_hx = ${is_hx};

	enable('dt_hot', is_hx );
	enable('dt_cold', is_hx );
	enable('tanks_in_parallel', !is_hx);
	set_tes_bypass_msg(is_hx);
};

on_change{"store_fl_props"}=define(){
	on_change{"is_hx"}();
};

on_change{"combo_tes_htf_type"}=define(){

	on_change{"is_hx"}();
	
    bUserDefined = (${combo_tes_htf_type} == 9);
    enable("store_fl_props", bUserDefined);
    enable("csp.dtr.tes.htf_min_opt_temp",!bUserDefined);
    enable("csp.dtr.tes.htf_max_opt_temp",!bUserDefined);
};