Battery Dispatch Manual
998
553
50
Label

1
13
Name
5
31
AllowChargeFromExcessSolarLabel
X
3
99
Y
3
39
Width
3
66
Height
3
42
Tool Tip
5
0
Caption
5
14
Charge from PV
TextColour
4
0
0
0
255
Bold
2
1
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Label

1
13
Name
5
21
AllowDischargingLabel
X
3
342
Y
3
36
Width
3
129
Height
3
21
Tool Tip
5
0
Caption
5
9
Discharge
TextColour
4
0
0
0
255
Bold
2
1
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Label

1
13
Name
5
15
Battery_weekday
X
3
48
Y
3
249
Width
3
90
Height
3
21
Tool Tip
5
0
Caption
5
8
Weekday 
TextColour
4
0
0
0
255
Bold
2
1
FontSize
3
0
WordWrap
2
0
AlignRight
2
0
AlignTop
2
0
Label

1
13
Name
5
15
Battery_weekend
X
3
540
Y
3
249
Width
3
90
Height
3
21
Tool Tip
5
0
Caption
5
7
Weekend
TextColour
4
0
0
0
255
Bold
2
1
FontSize
3
0
WordWrap
2
0
AlignRight
2
0
AlignTop
2
0
Label

1
13
Name
5
18
ForceChargingLabel
X
3
189
Y
3
36
Width
3
132
Height
3
21
Tool Tip
5
0
Caption
5
16
Charge from grid
TextColour
4
0
0
0
255
Bold
2
1
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Label

1
13
Name
5
29
Percent of rated to discharge
X
3
390
Y
3
57
Width
3
75
Height
3
21
Tool Tip
5
0
Caption
5
10
% capacity
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
0
AlignTop
2
0
Label

1
13
Name
5
31
Percent of rated to discharge37
X
3
237
Y
3
57
Width
3
75
Height
3
21
Tool Tip
5
0
Caption
5
10
% capacity
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
0
AlignTop
2
0
Label

1
13
Name
5
7
Period1
X
3
24
Y
3
81
Width
3
69
Height
3
24
Tool Tip
5
0
Caption
5
9
Period 1:
TextColour
4
112
219
47
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
0
AlignTop
2
0
Label

1
13
Name
5
7
Period2
X
3
24
Y
3
108
Width
3
69
Height
3
24
Tool Tip
5
0
Caption
5
9
Period 2:
TextColour
4
95
159
159
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
0
AlignTop
2
0
Label

1
13
Name
5
7
Period3
X
3
24
Y
3
135
Width
3
69
Height
3
24
Tool Tip
5
0
Caption
5
9
Period 3:
TextColour
4
142
107
35
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
0
AlignTop
2
0
Label

1
13
Name
5
7
Period4
X
3
24
Y
3
162
Width
3
69
Height
3
24
Tool Tip
5
0
Caption
5
9
Period 4:
TextColour
4
35
142
107
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
0
AlignTop
2
0
Label

1
13
Name
5
7
Period5
X
3
24
Y
3
189
Width
3
69
Height
3
24
Tool Tip
5
0
Caption
5
9
Period 5:
TextColour
4
234
234
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
0
AlignTop
2
0
Label

1
13
Name
5
7
Period6
X
3
24
Y
3
216
Width
3
69
Height
3
24
Tool Tip
5
0
Caption
5
9
Period 6:
TextColour
4
128
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
0
AlignTop
2
0
Numeric

1
17
Name
5
24
batt_discharge_percent_1
X
3
390
Y
3
81
Width
3
42
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
24
batt_discharge_percent_2
X
3
390
Y
3
108
Width
3
42
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
24
batt_discharge_percent_3
X
3
390
Y
3
135
Width
3
42
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
24
batt_discharge_percent_4
X
3
390
Y
3
162
Width
3
42
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
24
batt_discharge_percent_5
X
3
390
Y
3
189
Width
3
42
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
24
batt_discharge_percent_6
X
3
390
Y
3
216
Width
3
42
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
25
batt_gridcharge_percent_1
X
3
237
Y
3
81
Width
3
42
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
25
batt_gridcharge_percent_2
X
3
237
Y
3
108
Width
3
42
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
25
batt_gridcharge_percent_3
X
3
237
Y
3
135
Width
3
42
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
25
batt_gridcharge_percent_4
X
3
237
Y
3
162
Width
3
42
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
25
batt_gridcharge_percent_5
X
3
237
Y
3
189
Width
3
42
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
25
batt_gridcharge_percent_6
X
3
237
Y
3
216
Width
3
42
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Label

1
13
Name
5
26
batt_manual_dispatch_label
X
3
501
Y
3
42
Width
3
474
Height
3
48
Tool Tip
5
0
Caption
5
161
To activate the manual dispatch model, choose  Manual Dispatch under "Choose Dispatch Model" above. These inputs are inactive for the automated dispatch options.
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Label

1
13
Name
5
30
batt_manual_dispatch_label_fom
X
3
501
Y
3
93
Width
3
474
Height
3
48
Tool Tip
5
0
Caption
5
130
Grid charging is disallowed in the front-of-meter charging models, since the model assumes power can only be exported to the grid.
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
DiurnalPeriod

1
10
Name
5
21
dispatch_manual_sched
X
3
12
Y
3
273
Width
3
483
Height
3
270
Tool Tip
5
0
TabOrder
3
4294967295
Schedule
5
288
111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
Max
3
9
Min
3
1
DiurnalPeriod

1
10
Name
5
29
dispatch_manual_sched_weekend
X
3
501
Y
3
273
Width
3
483
Height
3
270
Tool Tip
5
0
TabOrder
3
4294967295
Schedule
5
288
111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
Max
3
9
Min
3
1
GroupBox

1
8
Name
5
8
object 4
X
3
9
Y
3
3
Width
3
985
Height
3
546
Tool Tip
5
0
Caption
5
21
Manual Dispatch Model
Bold
2
1
Label

1
13
Name
5
8
object 7
X
3
342
Y
3
57
Width
3
45
Height
3
21
Tool Tip
5
0
Caption
5
5
Allow
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
0
AlignTop
2
0
Label

1
13
Name
5
10
object 738
X
3
189
Y
3
57
Width
3
45
Height
3
21
Tool Tip
5
0
Caption
5
5
Allow
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
0
AlignTop
2
0
CheckBox

1
9
Name
5
20
pv.storage.p1.charge
X
3
123
Y
3
81
Width
3
33
Height
3
24
Tool Tip
5
0
Caption
5
0
State
2
1
TabOrder
3
4294967295
CheckBox

1
9
Name
5
23
pv.storage.p1.discharge
X
3
354
Y
3
81
Width
3
33
Height
3
24
Tool Tip
5
0
Caption
5
0
State
2
0
TabOrder
3
4294967295
CheckBox

1
9
Name
5
24
pv.storage.p1.gridcharge
X
3
201
Y
3
81
Width
3
33
Height
3
24
Tool Tip
5
0
Caption
5
0
State
2
0
TabOrder
3
4294967295
CheckBox

1
9
Name
5
20
pv.storage.p2.charge
X
3
123
Y
3
108
Width
3
33
Height
3
24
Tool Tip
5
0
Caption
5
0
State
2
1
TabOrder
3
4294967295
CheckBox

1
9
Name
5
23
pv.storage.p2.discharge
X
3
354
Y
3
108
Width
3
33
Height
3
24
Tool Tip
5
0
Caption
5
0
State
2
0
TabOrder
3
4294967295
CheckBox

1
9
Name
5
24
pv.storage.p2.gridcharge
X
3
201
Y
3
108
Width
3
33
Height
3
24
Tool Tip
5
0
Caption
5
0
State
2
1
TabOrder
3
4294967295
CheckBox

1
9
Name
5
20
pv.storage.p3.charge
X
3
123
Y
3
135
Width
3
33
Height
3
24
Tool Tip
5
0
Caption
5
0
State
2
1
TabOrder
3
4294967295
CheckBox

1
9
Name
5
23
pv.storage.p3.discharge
X
3
354
Y
3
135
Width
3
33
Height
3
24
Tool Tip
5
0
Caption
5
0
State
2
1
TabOrder
3
4294967295
CheckBox

1
9
Name
5
24
pv.storage.p3.gridcharge
X
3
201
Y
3
135
Width
3
33
Height
3
24
Tool Tip
5
0
Caption
5
0
State
2
0
TabOrder
3
4294967295
CheckBox

1
9
Name
5
20
pv.storage.p4.charge
X
3
123
Y
3
162
Width
3
33
Height
3
24
Tool Tip
5
0
Caption
5
0
State
2
0
TabOrder
3
4294967295
CheckBox

1
9
Name
5
23
pv.storage.p4.discharge
X
3
354
Y
3
162
Width
3
33
Height
3
24
Tool Tip
5
0
Caption
5
0
State
2
0
TabOrder
3
4294967295
CheckBox

1
9
Name
5
24
pv.storage.p4.gridcharge
X
3
201
Y
3
162
Width
3
33
Height
3
24
Tool Tip
5
0
Caption
5
0
State
2
0
TabOrder
3
4294967295
CheckBox

1
9
Name
5
20
pv.storage.p5.charge
X
3
123
Y
3
189
Width
3
33
Height
3
24
Tool Tip
5
0
Caption
5
0
State
2
0
TabOrder
3
4294967295
CheckBox

1
9
Name
5
23
pv.storage.p5.discharge
X
3
354
Y
3
189
Width
3
33
Height
3
24
Tool Tip
5
0
Caption
5
0
State
2
0
TabOrder
3
4294967295
CheckBox

1
9
Name
5
24
pv.storage.p5.gridcharge
X
3
201
Y
3
189
Width
3
33
Height
3
24
Tool Tip
5
0
Caption
5
0
State
2
0
TabOrder
3
4294967295
CheckBox

1
9
Name
5
20
pv.storage.p6.charge
X
3
123
Y
3
216
Width
3
33
Height
3
24
Tool Tip
5
0
Caption
5
0
State
2
0
TabOrder
3
4294967295
CheckBox

1
9
Name
5
23
pv.storage.p6.discharge
X
3
354
Y
3
216
Width
3
33
Height
3
24
Tool Tip
5
0
Caption
5
0
State
2
0
TabOrder
3
4294967295
CheckBox

1
9
Name
5
24
pv.storage.p6.gridcharge
X
3
201
Y
3
216
Width
3
33
Height
3
24
Tool Tip
5
0
Caption
5
0
State
2
0
TabOrder
3
4294967295

37
batt_discharge_percent_1
3
1
Battery discharge percent for period 1
%
Battery
0
3
1
1
1
1
25
 
batt_discharge_percent_2
3
1
Battery discharge percent for period 2
%
Battery
0
3
1
1
1
1
25
 
batt_discharge_percent_3
3
1
Battery discharge percent for period 3
%
Battery
0
3
1
1
1
1
25
 
batt_discharge_percent_4
3
1
Battery discharge percent for period 4
%
Battery
0
3
1
1
1
1
25
Default
batt_discharge_percent_5
3
1
Battery discharge percent for period 5
%
Battery
0
3
1
1
1
1
25
 
batt_discharge_percent_6
3
1
Battery discharge percent for period 6
%
Battery
0
3
1
1
1
1
25
 
batt_gridcharge_percent_1
3
1
Battery grid charge percent for period 1
%
Battery
0
3
1
1
1
1
100
Default
batt_gridcharge_percent_2
3
1
Battery grid charge percent for period 2
%
Battery
0
3
1
1
1
1
100
 
batt_gridcharge_percent_3
3
1
Battery grid charge percent for period 3
%
Battery
0
3
1
1
1
1
100
 
batt_gridcharge_percent_4
3
1
Battery grid charge percent for period 4
%
Battery
0
3
1
1
1
1
100
 
batt_gridcharge_percent_5
3
1
Battery grid charge percent for period 5
%
Battery
0
3
1
1
1
1
100
 
batt_gridcharge_percent_6
3
1
Battery grid charge percent for period 6
%
Battery
0
3
1
1
1
1
100
 
dispatch_manual_charge
3
2
 
 
Battery
0
8
1
2
1
1
0
 
dispatch_manual_discharge
3
2
 
 
Battery
0
8
1
2
1
1
0
 
dispatch_manual_gridcharge
3
2
 
 
Battery
0
8
1
2
1
1
0
 
dispatch_manual_percent_discharge
3
2
 
 
Battery
0
8
1
2
1
1
0
 
dispatch_manual_percent_gridcharge
3
2
 
 
Battery
0
8
1
2
1
1
0
 
dispatch_manual_sched
3
3
 
 
Battery
0
2
1
3
12
24
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 

DiurnalPeriod
dispatch_manual_sched_weekend
3
3
 
 
Battery
0
2
1
3
12
24
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 

DiurnalPeriod
pv.storage.p1.charge
3
1
 
 
Battery
0
0
1
1
1
1
1
Default
pv.storage.p1.discharge
3
1
 
 
Battery
0
0
1
1
1
1
0
 
pv.storage.p1.gridcharge
3
1
 
 
Battery
0
0
1
1
1
1
0
Default
pv.storage.p2.charge
3
1
 
 
Battery
0
0
1
1
1
1
1
Default
pv.storage.p2.discharge
3
1
 
 
Battery
0
0
1
1
1
1
0
 
pv.storage.p2.gridcharge
3
1
 
 
Battery
0
0
1
1
1
1
1
 
pv.storage.p3.charge
3
1
 
 
Battery
0
0
1
1
1
1
1
Default
pv.storage.p3.discharge
3
1
 
 
Battery
0
0
1
1
1
1
1
 
pv.storage.p3.gridcharge
3
1
 
 
Battery
0
0
1
1
1
1
0
 
pv.storage.p4.charge
3
1
 
 
Battery
0
0
1
1
1
1
0
Default
pv.storage.p4.discharge
3
1
 
 
Battery
0
0
1
1
1
1
0
 
pv.storage.p4.gridcharge
3
1
 
 
Battery
0
0
1
1
1
1
0
 
pv.storage.p5.charge
3
1
 
 
Battery
0
0
1
1
1
1
0
 
pv.storage.p5.discharge
3
1
 
 
Battery
0
0
1
1
1
1
0
 
pv.storage.p5.gridcharge
3
1
 
 
Battery
0
0
1
1
1
1
0
 
pv.storage.p6.charge
3
1
 
 
Battery
0
0
1
1
1
1
0
 
pv.storage.p6.discharge
3
1
 
 
Battery
0
0
1
1
1
1
0
 
pv.storage.p6.gridcharge
3
1
 
 
Battery
0
0
1
1
1
1
0
 

2263
equations{ 'dispatch_manual_charge' } = define() {
	return [ ${pv.storage.p1.charge},
	${pv.storage.p2.charge},
	${pv.storage.p3.charge},
	${pv.storage.p4.charge},
	${pv.storage.p5.charge},
	${pv.storage.p6.charge} ];
};

equations{ 'dispatch_manual_discharge' } = define() {
	return [ ${pv.storage.p1.discharge},
	${pv.storage.p2.discharge},
	${pv.storage.p3.discharge},
	${pv.storage.p4.discharge},
	${pv.storage.p5.discharge},
	${pv.storage.p6.discharge} ];
};

equations{ 'dispatch_manual_gridcharge' } = define() {
	return [ ${pv.storage.p1.gridcharge},
	${pv.storage.p2.gridcharge},
	${pv.storage.p3.gridcharge},
	${pv.storage.p4.gridcharge},
	${pv.storage.p5.gridcharge},
	${pv.storage.p6.gridcharge} ];
};
equations{ 'dispatch_manual_percent_discharge'} = define() {
	count = 0;
	discharge_array = ${dispatch_manual_discharge};
	for (i = 0; i != #discharge_array; i++)
	{
		ret_array[count] = 0;
		if (discharge_array[i] == 1)
		{
			/* It would be nice if this worked
			str2return = sprintf('batt_discharge_percent_%d',i+1);
			ret_array[count] = env(str2return);
			*/
		
			if (i == 0)
				ret_array[count] = ${batt_discharge_percent_1};
			else if (i == 1)
				ret_array[count] = ${batt_discharge_percent_2};
			else if (i == 2)
				ret_array[count] = ${batt_discharge_percent_3};
			else if (i == 3)
				ret_array[count] = ${batt_discharge_percent_4};		
			else if (i == 4)
				ret_array[count] = ${batt_discharge_percent_5};	
			else if (i == 5)
				ret_array[count] = ${batt_discharge_percent_6};	
			count++;
		}
	}
	return ret_array;
};
equations{ 'dispatch_manual_percent_gridcharge'} = define() {
	count = 0;
	gridcharge_array = ${dispatch_manual_gridcharge};
	for (i = 0; i != #gridcharge_array; i++)
	{
		ret_array[count] = 0;
		if (gridcharge_array[i] == 1)
		{
			if (i == 0)
				ret_array[count] = ${batt_gridcharge_percent_1};
			else if (i == 1)
				ret_array[count] = ${batt_gridcharge_percent_2};
			else if (i == 2)
				ret_array[count] = ${batt_gridcharge_percent_3};
			else if (i == 3)
				ret_array[count] = ${batt_gridcharge_percent_4};		
			else if (i == 4)
				ret_array[count] = ${batt_gridcharge_percent_5};	
			else if (i == 5)
				ret_array[count] = ${batt_gridcharge_percent_6};	
			count++;
		}
	}
	return ret_array;
};

5956
on_load{'Battery Dispatch Manual'}=define()
{	
	show_label();
	toggle_dispatch();
		
	on_change{'pv.storage.p1.discharge'};
	on_change{'pv.storage.p2.discharge'};
	on_change{'pv.storage.p3.discharge'};
	on_change{'pv.storage.p4.discharge'};
	on_change{'pv.storage.p5.discharge'};
	on_change{'pv.storage.p6.discharge'};
	
	on_change{'pv.storage.p1.gridcharge'};
	on_change{'pv.storage.p2.gridcharge'};
	on_change{'pv.storage.p3.gridcharge'};
	on_change{'pv.storage.p4.gridcharge'};
	on_change{'pv.storage.p5.gridcharge'};
	on_change{'pv.storage.p6.gridcharge'};

};

on_change{'pv.storage.p1.discharge'}=define(){toggle_discharge_percent();};
on_change{'pv.storage.p2.discharge'}=define(){toggle_discharge_percent();};
on_change{'pv.storage.p3.discharge'}=define(){toggle_discharge_percent();};
on_change{'pv.storage.p4.discharge'}=define(){toggle_discharge_percent();};
on_change{'pv.storage.p5.discharge'}=define(){toggle_discharge_percent();};
on_change{'pv.storage.p6.discharge'}=define(){toggle_discharge_percent();};

on_change{'pv.storage.p1.gridcharge'}=define(){toggle_gridcharge_percent();};
on_change{'pv.storage.p2.gridcharge'}=define(){toggle_gridcharge_percent();};
on_change{'pv.storage.p3.gridcharge'}=define(){toggle_gridcharge_percent();};
on_change{'pv.storage.p4.gridcharge'}=define(){toggle_gridcharge_percent();};
on_change{'pv.storage.p5.gridcharge'}=define(){toggle_gridcharge_percent();};
on_change{'pv.storage.p6.gridcharge'}=define(){toggle_gridcharge_percent();};

function behind_the_meter()
{
	btm = false;
	if (financing() == 'Residential' || 
		financing() == 'Commercial' || 
		financing() == 'Third Party')
		btm = true;
	return btm;
}

function show_label()
{
	// behind the meter
	btm_label = false;
	if (behind_the_meter())
		btm_label = true;
		
	show('batt_manual_dispatch_label', btm_label);
	show('batt_manual_dispatch_label_fom', !btm_label);
}
function toggle_discharge_percent()
{
	enable('batt_discharge_percent_1', (value('pv.storage.p1.discharge')==1));
	enable('batt_discharge_percent_2', (value('pv.storage.p2.discharge')==1));
	enable('batt_discharge_percent_3', (value('pv.storage.p3.discharge')==1));
	enable('batt_discharge_percent_4', (value('pv.storage.p4.discharge')==1));
	enable('batt_discharge_percent_5', (value('pv.storage.p5.discharge')==1));
	enable('batt_discharge_percent_6', (value('pv.storage.p6.discharge')==1));
}
function toggle_gridcharge_percent()
{
	enable('batt_gridcharge_percent_1', (value('pv.storage.p1.gridcharge')==1));
	enable('batt_gridcharge_percent_2', (value('pv.storage.p2.gridcharge')==1));
	enable('batt_gridcharge_percent_3', (value('pv.storage.p3.gridcharge')==1));
	enable('batt_gridcharge_percent_4', (value('pv.storage.p4.gridcharge')==1));
	enable('batt_gridcharge_percent_5', (value('pv.storage.p5.gridcharge')==1));
	enable('batt_gridcharge_percent_6', (value('pv.storage.p6.gridcharge')==1));
}
function toggle_dispatch()
{
	allow_grid_charge = true;
	allow_pv_charge = true;
	allow_discharge = true;
	
	front_of_meter = !behind_the_meter();
	if (front_of_meter == true)
	{
		mode = ${batt_dispatch_choice};
		if (mode == 4)
		{
			allow_grid_charge = true;
			enable_manual_inputs(true, allow_pv_charge, allow_grid_charge, allow_discharge);
			toggle_discharge_percent();
			toggle_gridcharge_percent();
		}
		else
			enable_manual_inputs(false, false, false, false);
	}
	else
	{
		mode = ${batt_dispatch_choice};

		if (mode != 4)
			enable_manual_inputs(false, false, false, false);
		else
		{
			enable_manual_inputs(true, allow_pv_charge, allow_grid_charge, allow_discharge );
			toggle_discharge_percent();
			toggle_gridcharge_percent();
		}
		toggle_dispatch_target();
		toggle_custom_dispatch();
	}
}
function toggle_dispatch_target()
{
	mode = ${batt_dispatch_choice};
	if (mode != 2)
		enable_target_inputs(false);
	else
		enable_target_inputs(true);
}
function enable_grid_charge(on_off)
{
	if (!on_off && !behind_the_meter())
	{
		value('pv.storage.p1.gridcharge',0);
		value('pv.storage.p2.gridcharge',0);
		value('pv.storage.p3.gridcharge',0);
		value('pv.storage.p4.gridcharge',0);
		value('pv.storage.p5.gridcharge',0);
		value('pv.storage.p6.gridcharge',0);
	}
	
	enable('pv.storage.p1.gridcharge',on_off);
	enable('pv.storage.p2.gridcharge',on_off);
	enable('pv.storage.p3.gridcharge',on_off);
	enable('pv.storage.p4.gridcharge',on_off);
	enable('pv.storage.p5.gridcharge',on_off);
	enable('pv.storage.p6.gridcharge',on_off);
	enable('batt_gridcharge_percent_1',on_off);
	enable('batt_gridcharge_percent_2',on_off);
	enable('batt_gridcharge_percent_3',on_off);
	enable('batt_gridcharge_percent_4',on_off);
	enable('batt_gridcharge_percent_5',on_off);
	enable('batt_gridcharge_percent_6',on_off);
}
function enable_pv_charge(on_off)
{
	enable('pv.storage.p1.charge',on_off);
	enable('pv.storage.p2.charge',on_off);
	enable('pv.storage.p3.charge',on_off);
	enable('pv.storage.p4.charge',on_off);
	enable('pv.storage.p5.charge',on_off);
	enable('pv.storage.p6.charge',on_off);
}
function enable_discharge(on_off)
{
	enable('pv.storage.p1.discharge',on_off);
	enable('pv.storage.p2.discharge',on_off);
	enable('pv.storage.p3.discharge',on_off);
	enable('pv.storage.p4.discharge',on_off);
	enable('pv.storage.p5.discharge',on_off);
	enable('pv.storage.p6.discharge',on_off);
	enable('batt_discharge_percent_1',on_off);
	enable('batt_discharge_percent_2',on_off);
	enable('batt_discharge_percent_3',on_off);
	enable('batt_discharge_percent_4',on_off);
	enable('batt_discharge_percent_5',on_off);
	enable('batt_discharge_percent_6',on_off);
}

function enable_manual_inputs(on_off, allow_pv_charge, allow_grid_charge, allow_discharge)
{
	enable_pv_charge(allow_pv_charge);
	enable_grid_charge(allow_grid_charge);
	enable_discharge(allow_discharge);
	
	enable('dispatch_manual_sched',on_off);
	enable('dispatch_manual_sched_weekend',on_off);
	enable('batt_dispatch_auto_can_charge', !on_off);
	enable('batt_dispatch_auto_can_gridcharge', !on_off);
}