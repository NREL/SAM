PVWatts
590
943
40
GroupBox

1
8
Name
5
9
GroupBox1
X
3
9
Y
3
6
Width
3
572
Height
3
176
Tool Tip
5
0
Caption
5
17
System Parameters
Bold
2
1
Numeric

1
17
Name
5
12
ac_nameplate
X
3
204
Y
3
114
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4
LossAdjustment

1
7
Name
5
6
adjust
X
3
24
Y
3
855
Width
3
294
Height
3
72
Tool Tip
5
0
TabOrder
3
24
Choice

1
9
Name
5
10
array_type
X
3
384
Y
3
207
Width
3
174
Height
3
24
Tool Tip
5
0
Items
6
5
Fixed open rack
Fixed roof mount
1-axis tracking
1-axis backtracking
2-axis tracking
Selection
3
4294967295
TabOrder
3
6
Numeric

1
17
Name
5
7
azimuth
X
3
384
Y
3
261
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
8
CheckBox

1
9
Name
5
18
batt_simple_enable
X
3
378
Y
3
858
Width
3
177
Height
3
24
Tool Tip
5
0
Caption
5
21
Enable simple battery
State
2
1
TabOrder
3
4294967295
Numeric

1
17
Name
5
11
dc_ac_ratio
X
3
204
Y
3
87
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
3
Button

1
8
Name
5
13
edit_3d_scene
X
3
321
Y
3
705
Width
3
210
Height
3
30
Tool Tip
5
0
Caption
5
27
Open 3D shade calculator...
TabOrder
3
4294967295
CheckBox

1
9
Name
5
11
en_snowloss
X
3
27
Y
3
741
Width
3
173
Height
3
24
Tool Tip
5
0
Caption
5
20
Estimate snow losses
State
2
1
TabOrder
3
4294967295
CheckBox

1
9
Name
5
19
en_user_spec_losses
X
3
222
Y
3
408
Width
3
24
Height
3
24
Tool Tip
5
0
Caption
5
0
State
2
0
TabOrder
3
20
Numeric

1
17
Name
5
3
gcr
X
3
384
Y
3
288
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
9
Numeric

1
17
Name
5
7
inv_eff
X
3
204
Y
3
141
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
5
Numeric

1
17
Name
5
8
loss_age
X
3
456
Y
3
540
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
18
Numeric

1
17
Name
5
10
loss_avail
X
3
456
Y
3
567
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
19
Numeric

1
17
Name
5
9
loss_conn
X
3
456
Y
3
459
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
15
Numeric

1
17
Name
5
8
loss_lid
X
3
456
Y
3
486
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
16
Numeric

1
17
Name
5
13
loss_mismatch
X
3
156
Y
3
540
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
13
Numeric

1
17
Name
5
14
loss_nameplate
X
3
456
Y
3
513
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
17
Numeric

1
17
Name
5
12
loss_shading
X
3
156
Y
3
486
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
11
Numeric

1
17
Name
5
9
loss_snow
X
3
156
Y
3
513
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
12
Numeric

1
17
Name
5
12
loss_soiling
X
3
156
Y
3
459
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
10
Numeric

1
17
Name
5
11
loss_wiring
X
3
156
Y
3
567
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
14
Numeric

1
17
Name
5
6
losses
X
3
456
Y
3
597
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
22
Numeric

1
17
Name
5
11
losses_user
X
3
456
Y
3
408
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
21
Choice

1
9
Name
5
11
module_type
X
3
204
Y
3
60
Width
3
141
Height
3
24
Tool Tip
5
0
Items
6
3
Standard
Premium
Thin film
Selection
3
4294967295
TabOrder
3
2
Label

1
13
Name
5
16
msg_pvwatts_snow
X
3
204
Y
3
741
Width
3
348
Height
3
48
Tool Tip
5
0
Caption
5
0
TextColour
4
255
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Image

1
8
Name
5
9
object 12
X
3
27
Y
3
216
Width
3
190
Height
3
102
Tool Tip
5
0
Image
7
PVWatts_object 12.png
Centered
2
1
Divider

1
10
Name
5
9
object 21
X
3
75
Y
3
435
Width
3
477
Height
3
22
Tool Tip
5
0
Orientation
3
0
Colour
4
120
120
120
255
Caption
5
30
Specify System Loss Categories
Bold
2
1
Divider

1
10
Name
5
9
object 22
X
3
27
Y
3
789
Width
3
525
Height
3
19
Tool Tip
5
0
Orientation
3
0
Colour
4
120
120
120
255
Caption
5
19
System Availability
Bold
2
1
Divider

1
10
Name
5
11
object 2228
X
3
27
Y
3
351
Width
3
525
Height
3
16
Tool Tip
5
0
Orientation
3
0
Colour
4
120
120
120
255
Caption
5
13
System Losses
Bold
2
1
Divider

1
10
Name
5
13
object 222823
X
3
27
Y
3
624
Width
3
525
Height
3
16
Tool Tip
5
0
Orientation
3
0
Colour
4
120
120
120
255
Caption
5
16
Shading and Snow
Bold
2
1
GroupBox

1
8
Name
5
8
object 4
X
3
9
Y
3
336
Width
3
573
Height
3
597
Tool Tip
5
0
Caption
5
6
Losses
Bold
2
1
GroupBox

1
8
Name
5
10
object 430
X
3
9
Y
3
186
Width
3
573
Height
3
144
Tool Tip
5
0
Caption
5
24
Orientation and Tracking
Bold
2
1
Label

1
13
Name
5
8
object 7
X
3
30
Y
3
366
Width
3
528
Height
3
39
Tool Tip
5
0
Caption
5
125
System losses account for performance losses you would expect in a real system that are not explicitly calculated by PVWatts.
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Label

1
13
Name
5
12
object 73132
X
3
30
Y
3
645
Width
3
519
Height
3
57
Tool Tip
5
0
Caption
5
143
Shading losses are for shading by nearby objects. PVWatts calculates self-shading losses based on the system design and tracking options above.
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Label

1
13
Name
5
13
object 731324
X
3
30
Y
3
810
Width
3
546
Height
3
42
Tool Tip
5
0
Caption
5
96
System availability losses reduce the system output to represent system outages or other events.
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Label

1
13
Name
5
10
object 735
X
3
348
Y
3
15
Width
3
231
Height
3
159
Tool Tip
5
0
Caption
5
255
SAM uses PVWatts Version 7, which is different from the online PVWatts Calculator version. SAM's results will likely be different from the online calculator's results until the online calculator is updated. See Help for information about PVWatts versions.
TextColour
4
255
128
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
ShadingFactors

1
9
Name
5
7
shading
X
3
180
Y
3
705
Width
3
135
Height
3
30
Tool Tip
5
0
ShowDBOptions
2
0
Description
5
0
TabOrder
3
23
Numeric

1
17
Name
5
15
system_capacity
X
3
204
Y
3
33
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
1
Numeric

1
17
Name
5
4
tilt
X
3
384
Y
3
234
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
7

27
ac_nameplate
3
1
Rated inverter size
kWac
PVWatts
0
8
1
1
1
1
0
Numeric
adjust
3
5
Performance adjustment factors
 
PVWatts
0
1
1
5
1
0
LossAdjustment
array_type
3
1
Array type
 
PVWatts
84
Fixed open rack|Fixed roof mount|1-axis tracking|1-axis backtracking|2-axis tracking
2
1
1
1
1
0
Choice
azimuth
3
1
Azimuth
degrees
PVWatts
0
2
1
1
1
1
180
Numeric
batt_simple_enable
3
1
Enable simple battery
 
PVWatts
0
13
1
1
1
1
0
Default
dc_ac_ratio
3
1
DC to AC ratio
 
PVWatts
0
2
1
1
1
1
1.1
Numeric
en_snowloss
3
1
Estimate losses from snow
 
PVWatts
0
3
1
1
1
1
0
Default
en_user_spec_losses
3
1
Specify total system loss
 
PVWatts
0
8
1
1
1
1
0
CheckBox
gcr
3
1
Ground coverage ratio
 
PVWatts
0
2
1
1
1
1
0.4
Numeric
inv_eff
3
1
Inverter efficiency
%
PVWatts
0
2
1
1
1
1
96
Numeric
loss_age
3
1
Age
%
PVWatts
0
2
1
1
1
1
0
Numeric
loss_avail
3
1
Availability
%
PVWatts
0
2
1
1
1
1
3
Numeric
loss_conn
3
1
Connections
%
PVWatts
0
2
1
1
1
1
0.5
Numeric
loss_lid
3
1
Light-induced degradation
%
PVWatts
0
2
1
1
1
1
1.5
Numeric
loss_mismatch
3
1
Mismatch
%
PVWatts
0
2
1
1
1
1
2
Numeric
loss_nameplate
3
1
Nameplate
%
PVWatts
0
2
1
1
1
1
1
Numeric
loss_shading
3
1
Shading
%
PVWatts
0
2
1
1
1
1
3
Numeric
loss_snow
3
1
Snow
%
PVWatts
0
2
1
1
1
1
0
Numeric
loss_soiling
3
1
Soiling
%
PVWatts
0
2
1
1
1
1
2
Numeric
loss_wiring
3
1
Wiring
%
PVWatts
0
2
1
1
1
1
2
Numeric
losses
3
1
Total system losses
%
PVWatts
0
8
1
1
1
1
14
Numeric
losses_user
3
1
Total loss
%
PVWatts
0
2
1
1
1
1
14
Numeric
module_type
3
1
Module type
 
PVWatts
26
Standard|Premium|Thin film
2
1
1
1
1
0
Choice
shading
3
5
Edit shading losses
 
PVWatts
0
2
1
5
1
0
ShadingFactors
shading_3d_scene
3
6
3D shading scene
 
PVWatts
0
0
1
6
0
Default
system_capacity
3
1
System nameplate capacity
kWdc
PVWatts
0
2
1
1
1
1
4
Numeric
tilt
3
1
Tilt
degrees
PVWatts
0
2
1
1
1
1
42.82
Numeric

493
equations{'ac_nameplate'} = define() {
	return ${system_capacity}/${dc_ac_ratio};
};

equations{ 'losses' } = define() {
	if( ${en_user_spec_losses} ) return ${losses_user};
	else return 100* (1 - (1-0.01*${loss_soiling})
					*(1-0.01*${loss_shading})
					*(1-0.01*${loss_snow})
					*(1-0.01*${loss_mismatch})
					*(1-0.01*${loss_wiring})
					*(1-0.01*${loss_conn})
					*(1-0.01*${loss_lid})
					*(1-0.01*${loss_nameplate})
					*(1-0.01*${loss_age})
					*(1-0.01*${loss_avail}) );
};

2731
function pvwatts_ui_update() {
	arr = ${array_type};
	enable( 'gcr', (arr==0||arr==2||arr==3) );
	enable( 'tilt', (arr!=4));
	enable( 'azimuth', (arr!=4));
	
	enul = ${en_user_spec_losses};
	enable( 'losses_user',  enul);	
	losses = [ 'soiling', 'shading', 'snow', 'mismatch', 'wiring', 'conn', 'lid', 'nameplate', 'age', 'avail' ];
	for( i=0;i<#losses;i++ )
		enable( 'loss_' + losses[i], !enul );
	
	snow_loss_checks();	
		
}

function snow_loss_checks () {
	msg_snow = '';
	if ( isnan(value('annual_snow')) == true && value('en_snowloss') == 1 ) {
		msg_snow = 'Weather file does not have snow depth data required to model snow losses. See Help for more information.';
	}
	property('msg_pvwatts_snow','Caption',msg_snow);
	
	if ( value('en_snowloss') == 1 && 
	     value('loss_snow') !=0 && 
	     isnan(value('annual_snow')) == false && 
	     value('en_user_spec_losses') == 0 )
	{
		msgbox('Snow loss warning!\nThe snow loss model is enabled and the Snow input is set to ' + value('loss_snow') + '%. Set Snow to zero to avoid double-counting snow losses. Ignore this message to include losses from both the snow model and the Snow input value.');
	}
}

// do this here instead of equations so
// versions.lk will work for opening files
// older than 2018.11.11
function check_batt_config() {
	 t = technology();
	 if ( t == 'PVWatts Battery' ) 
	 { value('batt_simple_enable', 1); }
	 else 
	 { value('batt_simple_enable', 0); }
 	show( 'batt_simple_enable', 0 ); // hidden variable set by equations
	refresh();
}

on_load{'PVWatts'} = define() {
	pvwatts_ui_update();
	check_batt_config();
};

on_change{'array_type'} = define() {
	pvwatts_ui_update();
};

on_change{'en_user_spec_losses'} = define() {
	pvwatts_ui_update();
};

on_change{'en_snowloss'} = define() {
	snow_loss_checks();	
};

on_change{'loss_snow'} = define() {
	snow_loss_checks();
};

on_change{'edit_3d_scene'} = define() {
	minute_step = 60;
	if (varinfo("wf_nrecords"))
	{
		nrec = value("wf_nrecords");
		if (!isnan(nrec) && (nrec > 0))
		{
			minute_step = 60 * 8760 / nrec;
		}
	}

	x = editscene3d( 'shading_3d_scene', 
		value('lat'), value('lon'), value('tz'), 
		value('city') + ', ' + value('state')  , minute_step);
// update 60 to timestep from weather file.	
	if ( x.ierr == 0 )
	{	
		timestep = x.losses;
//		msgbox("timestep = " + to_string(timestep));
//		msgbox("x = " + to_string(x));
		if (yesno('Update timeseries and diffuse shading losses with calculated values from 3D scene?'))
		{
			shad = value('shading');
			shad.en_timestep = true;
			shad.timestep = timestep;
			// diffuse
			shad.en_diff = true;
			shad.diff = x.diffuse[0];

			value('shading', shad );	
		}
	}
	else
	{
		msgbox('Internal error: ' + x.message);
	}
};

