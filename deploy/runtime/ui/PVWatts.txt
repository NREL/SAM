PVWatts
587
764
32
GroupBox

1
8
Name
5
9
GroupBox1
X
3
9
Y
3
12
Width
3
572
Height
3
170
Tool Tip
5
0
Caption
5
17
System Parameters
Bold
2
1
Numeric

1
17
Name
5
12
ac_nameplate
X
3
249
Y
3
114
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4
LossAdjustment

1
7
Name
5
6
adjust
X
3
273
Y
3
675
Width
3
294
Height
3
78
Tool Tip
5
0
TabOrder
3
24
Choice

1
9
Name
5
10
array_type
X
3
384
Y
3
207
Width
3
174
Height
3
24
Tool Tip
5
0
Items
6
5
Fixed open rack
Fixed roof mount
1 Axis Tracking
1 Axis Backtracking
2 Axis Tracking
Selection
3
4294967295
TabOrder
3
6
Numeric

1
17
Name
5
7
azimuth
X
3
384
Y
3
261
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
8
Numeric

1
17
Name
5
11
dc_ac_ratio
X
3
249
Y
3
87
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
3
Button

1
8
Name
5
13
edit_3d_scene
X
3
336
Y
3
618
Width
3
210
Height
3
24
Tool Tip
5
0
Caption
5
27
Open 3D shade calculator...
TabOrder
3
4294967295
CheckBox

1
9
Name
5
19
en_user_spec_losses
X
3
201
Y
3
528
Width
3
24
Height
3
24
Tool Tip
5
0
Caption
5
0
State
2
0
TabOrder
3
20
Numeric

1
17
Name
5
3
gcr
X
3
384
Y
3
288
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
9
Numeric

1
17
Name
5
7
inv_eff
X
3
249
Y
3
141
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
5
Numeric

1
17
Name
5
8
loss_age
X
3
459
Y
3
450
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
18
Numeric

1
17
Name
5
10
loss_avail
X
3
459
Y
3
477
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
19
Numeric

1
17
Name
5
9
loss_conn
X
3
459
Y
3
369
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
15
Numeric

1
17
Name
5
8
loss_lid
X
3
459
Y
3
396
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
16
Numeric

1
17
Name
5
13
loss_mismatch
X
3
171
Y
3
450
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
13
Numeric

1
17
Name
5
14
loss_nameplate
X
3
459
Y
3
423
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
17
Numeric

1
17
Name
5
12
loss_shading
X
3
171
Y
3
396
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
11
Numeric

1
17
Name
5
9
loss_snow
X
3
171
Y
3
423
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
12
Numeric

1
17
Name
5
12
loss_soiling
X
3
171
Y
3
369
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
10
Numeric

1
17
Name
5
11
loss_wiring
X
3
171
Y
3
477
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
14
Numeric

1
17
Name
5
6
losses
X
3
459
Y
3
570
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
22
Numeric

1
17
Name
5
11
losses_user
X
3
459
Y
3
528
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
21
Choice

1
9
Name
5
11
module_type
X
3
249
Y
3
60
Width
3
174
Height
3
24
Tool Tip
5
0
Items
6
3
Standard
Premium
Thin film
Selection
3
4294967295
TabOrder
3
2
Image

1
8
Name
5
9
object 12
X
3
27
Y
3
216
Width
3
190
Height
3
102
Tool Tip
5
0
Image
7
PVWatts_object 12.png
Centered
2
1
Divider

1
10
Name
5
9
object 22
X
3
21
Y
3
654
Width
3
525
Height
3
19
Tool Tip
5
0
Orientation
3
0
Colour
4
120
120
120
255
Caption
5
19
System Availability
Bold
2
1
Divider

1
10
Name
5
11
object 2228
X
3
21
Y
3
603
Width
3
525
Height
3
16
Tool Tip
5
0
Orientation
3
0
Colour
4
120
120
120
255
Caption
5
7
Shading
Bold
2
1
GroupBox

1
8
Name
5
8
object 4
X
3
9
Y
3
336
Width
3
573
Height
3
423
Tool Tip
5
0
Caption
5
6
Losses
Bold
2
1
GroupBox

1
8
Name
5
10
object 430
X
3
9
Y
3
186
Width
3
573
Height
3
144
Tool Tip
5
0
Caption
5
11
Orientation
Bold
2
1
Label

1
13
Name
5
8
object 7
X
3
33
Y
3
675
Width
3
228
Height
3
84
Tool Tip
5
0
Caption
5
96
System availability losses reduce the system output to represent system outages or other events.
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
ShadingFactors

1
9
Name
5
7
shading
X
3
192
Y
3
618
Width
3
135
Height
3
24
Tool Tip
5
0
ShowDBOptions
2
0
Description
5
0
TabOrder
3
23
Numeric

1
17
Name
5
15
system_capacity
X
3
249
Y
3
33
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
1
Numeric

1
17
Name
5
4
tilt
X
3
384
Y
3
234
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
7

25
ac_nameplate
3
1
Rated inverter size
kWac
PVWatts
0
8
1
1
1
1
0
Numeric
adjust
3
5
Performance adjustment factors
 
PVWatts
0
1
1
5
1
0
LossAdjustment
array_type
3
1
Array type
 
PVWatts
84
Fixed open rack|Fixed roof mount|1 Axis Tracking|1 Axis Backtracking|2 Axis Tracking
2
1
1
1
1
0
Choice
azimuth
3
1
Azimuth
degrees
PVWatts
0
2
1
1
1
1
180
Numeric
dc_ac_ratio
3
1
DC to AC ratio
 
PVWatts
0
2
1
1
1
1
1.1
Numeric
en_user_spec_losses
3
1
Enable user specified losses
 
PVWatts
0
8
1
1
1
1
0
CheckBox
gcr
3
1
Ground coverage ratio
 
PVWatts
0
2
1
1
1
1
0.4
Numeric
inv_eff
3
1
Inverter efficiency
%
PVWatts
0
2
1
1
1
1
96
Numeric
loss_age
3
1
Age
%
PVWatts
0
2
1
1
1
1
0
Numeric
loss_avail
3
1
Availability
%
PVWatts
0
2
1
1
1
1
3
Numeric
loss_conn
3
1
Connections
%
PVWatts
0
2
1
1
1
1
0.5
Numeric
loss_lid
3
1
Light-induced degradation
%
PVWatts
0
2
1
1
1
1
1.5
Numeric
loss_mismatch
3
1
Mismatch
%
PVWatts
0
2
1
1
1
1
2
Numeric
loss_nameplate
3
1
Nameplate
%
PVWatts
0
2
1
1
1
1
1
Numeric
loss_shading
3
1
Shading
%
PVWatts
0
2
1
1
1
1
3
Numeric
loss_snow
3
1
Snow
%
PVWatts
0
2
1
1
1
1
0
Numeric
loss_soiling
3
1
Soiling
%
PVWatts
0
2
1
1
1
1
2
Numeric
loss_wiring
3
1
Wiring
%
PVWatts
0
2
1
1
1
1
2
Numeric
losses
3
1
Total system losses
%
PVWatts
0
8
1
1
1
1
14
Numeric
losses_user
3
1
User-specified total system losses
%
PVWatts
0
2
1
1
1
1
14
Numeric
module_type
3
1
Module type
 
PVWatts
26
Standard|Premium|Thin film
2
1
1
1
1
0
Choice
shading
3
5
Edit shading losses
 
PVWatts
0
2
1
5
1
0
ShadingFactors
shading_3d_scene
3
6
3D shading scene
 
PVWatts
0
0
1
6
0
Default
system_capacity
3
1
System nameplate capacity
kWdc
PVWatts
0
2
1
1
1
1
4
Numeric
tilt
3
1
Tilt
degrees
PVWatts
0
2
1
1
1
1
42.82
Numeric

494
equations{'ac_nameplate'} = define() {
	return ${system_capacity}/${dc_ac_ratio};
};

equations{ 'losses' } = define() {
	if( ${en_user_spec_losses} ) return ${losses_user};
	else return 100* (1 - (1-0.01*${loss_soiling})
					*(1-0.01*${loss_shading})
					*(1-0.01*${loss_snow})
					*(1-0.01*${loss_mismatch})
					*(1-0.01*${loss_wiring})
					*(1-0.01*${loss_conn})
					*(1-0.01*${loss_lid})
					*(1-0.01*${loss_nameplate})
					*(1-0.01*${loss_age})
					*(1-0.01*${loss_avail}) );
};


1456
function pvwatts_ui_update() {
	arr = ${array_type};
	enable( 'gcr', (arr==2||arr==3) );
	enable( 'tilt', (arr!=4));
	enable( 'azimuth', (arr!=4));
	
	enul = ${en_user_spec_losses};
	enable( 'losses_user',  enul);	
	losses = [ 'soiling', 'shading', 'snow', 'mismatch', 'wiring', 'conn', 'lid', 'nameplate', 'age', 'avail' ];
	for( i=0;i<#losses;i++ )
		enable( 'loss_' + losses[i], !enul );
}

on_load{'PVWatts'} = define() {
	pvwatts_ui_update();
};

on_change{'array_type'} = define() {
	pvwatts_ui_update();
};

on_change{'en_user_spec_losses'} = define() {
	pvwatts_ui_update();
};

on_change{'edit_3d_scene'} = define() {
	minute_step = 60;
	if (varinfo("wf_nrecords"))
	{
		nrec = value("wf_nrecords");
		if (!isnan(nrec) && (nrec > 0))
		{
			minute_step = 60 * 8760 / nrec;
		}
	}

	x = editscene3d( 'shading_3d_scene', 
		value('lat'), value('lon'), value('tz'), 
		value('city') + ', ' + value('state')  , minute_step);
// update 60 to timestep from weather file.	
	if ( x.ierr == 0 )
	{	
		timestep = x.losses;
//		msgbox("timestep = " + to_string(timestep));
//		msgbox("x = " + to_string(x));
		if (yesno('Update timeseries and diffuse shading losses with calculated values from 3D scene?'))
		{
			shad = value('shading');
			shad.en_timestep = true;
			shad.timestep = timestep;
			// diffuse
			shad.en_diff = true;
			shad.diff = x.diffuse[0];

			value('shading', shad );	
		}
	}
	else
	{
		msgbox('Internal error: ' + x.message);
	}
};

