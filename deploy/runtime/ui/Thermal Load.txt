Thermal Load
848
573
52
GroupBox

1
8
Name
5
9
GroupBox1
X
3
12
Y
3
9
Width
3
824
Height
3
554
Tool Tip
5
0
Caption
5
17
Thermal Load Data
Bold
2
1
Label

1
13
Name
5
6
Label1
X
3
93
Y
3
219
Width
3
68
Height
3
21
Tool Tip
5
0
Caption
5
3
Jan
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
1
AlignTop
2
0
Label

1
13
Name
5
7
Label11
X
3
93
Y
3
243
Width
3
68
Height
3
21
Tool Tip
5
0
Caption
5
3
Feb
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
1
AlignTop
2
0
Label

1
13
Name
5
8
Label111
X
3
93
Y
3
267
Width
3
68
Height
3
21
Tool Tip
5
0
Caption
5
3
Mar
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
1
AlignTop
2
0
Label

1
13
Name
5
9
Label1111
X
3
93
Y
3
291
Width
3
68
Height
3
21
Tool Tip
5
0
Caption
5
3
Apr
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
1
AlignTop
2
0
Label

1
13
Name
5
10
Label11111
X
3
93
Y
3
315
Width
3
68
Height
3
21
Tool Tip
5
0
Caption
5
3
May
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
1
AlignTop
2
0
Label

1
13
Name
5
11
Label111111
X
3
93
Y
3
339
Width
3
68
Height
3
21
Tool Tip
5
0
Caption
5
3
Jun
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
1
AlignTop
2
0
Label

1
13
Name
5
12
Label1111111
X
3
93
Y
3
363
Width
3
68
Height
3
21
Tool Tip
5
0
Caption
5
3
Jul
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
1
AlignTop
2
0
Label

1
13
Name
5
13
Label11111111
X
3
93
Y
3
387
Width
3
68
Height
3
21
Tool Tip
5
0
Caption
5
3
Aug
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
1
AlignTop
2
0
Label

1
13
Name
5
14
Label111111111
X
3
93
Y
3
411
Width
3
68
Height
3
21
Tool Tip
5
0
Caption
5
3
Sep
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
1
AlignTop
2
0
Label

1
13
Name
5
15
Label1111111111
X
3
93
Y
3
435
Width
3
68
Height
3
21
Tool Tip
5
0
Caption
5
3
Oct
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
1
AlignTop
2
0
Label

1
13
Name
5
16
Label11111111111
X
3
93
Y
3
459
Width
3
68
Height
3
21
Tool Tip
5
0
Caption
5
3
Nov
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
1
AlignTop
2
0
Label

1
13
Name
5
17
Label111111111111
X
3
93
Y
3
516
Width
3
68
Height
3
21
Tool Tip
5
0
Caption
5
6
Annual
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
1
AlignTop
2
0
Label

1
13
Name
5
19
Label11111111111138
X
3
93
Y
3
483
Width
3
68
Height
3
21
Tool Tip
5
0
Caption
5
3
Dec
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
1
AlignTop
2
0
Label

1
13
Name
5
6
Label2
X
3
108
Y
3
195
Width
3
137
Height
3
21
Tool Tip
5
0
Caption
5
20
Thermal load (kWh-t)
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
1
AlignTop
2
0
Label

1
13
Name
5
7
Label21
X
3
246
Y
3
195
Width
3
80
Height
3
21
Tool Tip
5
0
Caption
5
11
Peak (kW-t)
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
1
AlignTop
2
0
Label

1
13
Name
5
6
Label4
X
3
465
Y
3
357
Width
3
311
Height
3
88
Tool Tip
5
0
Caption
5
144
The thermal load is assumed to be a heating load that can be partially or fully offset by heat generated by a combined heat and power process.  
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Label

1
13
Name
5
7
Label41
X
3
462
Y
3
234
Width
3
311
Height
3
112
Tool Tip
5
0
Caption
5
191
In Value mode, the growth rate applies to the previous year's annual kWh-t load starting in Year 2. In Schedule mode, each year's rate applies to the Year 1 kWh-t value. See Help for details.
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
CheckBox

1
9
Name
5
25
normalize_to_thermal_bill
X
3
414
Y
3
45
Width
3
405
Height
3
24
Tool Tip
5
0
Caption
5
55
Normalize supplied load profile to monthly thermal data
State
2
1
TabOrder
3
4294967295
Divider

1
10
Name
5
9
object 22
X
3
36
Y
3
162
Width
3
369
Height
3
25
Tool Tip
5
0
Orientation
3
0
Colour
4
120
120
120
255
Caption
5
20
Monthly Load Summary
Bold
2
1
Divider

1
10
Name
5
10
object 229
X
3
441
Y
3
171
Width
3
351
Height
3
16
Tool Tip
5
0
Orientation
3
0
Colour
4
120
120
120
255
Caption
5
17
Annual Adjustment
Bold
2
1
Numeric

1
17
Name
5
9
thermal_1
X
3
165
Y
3
219
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
Numeric

1
17
Name
5
10
thermal_10
X
3
165
Y
3
435
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
Numeric

1
17
Name
5
10
thermal_11
X
3
165
Y
3
459
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
Numeric

1
17
Name
5
10
thermal_12
X
3
165
Y
3
483
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
Numeric

1
17
Name
5
9
thermal_2
X
3
165
Y
3
243
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
Numeric

1
17
Name
5
9
thermal_3
X
3
165
Y
3
267
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
Numeric

1
17
Name
5
9
thermal_4
X
3
165
Y
3
291
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
Numeric

1
17
Name
5
9
thermal_5
X
3
165
Y
3
315
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
Numeric

1
17
Name
5
9
thermal_6
X
3
165
Y
3
339
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
Numeric

1
17
Name
5
9
thermal_7
X
3
165
Y
3
363
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
Numeric

1
17
Name
5
9
thermal_8
X
3
165
Y
3
387
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
Numeric

1
17
Name
5
9
thermal_9
X
3
165
Y
3
411
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
Numeric

1
17
Name
5
19
thermal_annual_peak
X
3
246
Y
3
516
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
MonthlyFactor

1
8
Name
5
17
thermal_bill_data
X
3
633
Y
3
75
Width
3
102
Height
3
24
Tool Tip
5
0
Description
5
26
Monthly heat usage (kWh-t)
TabOrder
3
4294967295
Numeric

1
17
Name
5
25
thermal_load_annual_total
X
3
165
Y
3
516
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
SchedNumeric

1
12
Name
5
23
thermal_load_escalation
X
3
564
Y
3
201
Width
3
100
Height
3
21
Tool Tip
5
0
Label
5
5
Value
UseSchedule
2
0
ScheduleOnly
2
0
FixedLength
3
4294967295
Description
5
110
Type a load growth rate (%) for each year. Each year's growth rate applies to the total annual load in Year 1.
TabOrder
3
4294967295
DataArray

1
10
Name
5
22
thermal_load_user_data
X
3
234
Y
3
45
Width
3
119
Height
3
24
Tool Tip
5
0
Mode
3
1
Label
5
19
Thermal load (kW-t)
Description
5
174
The thermal load is specified as the average thermal power over the time interval.  For hourly load data, this is equivalent to entering thermal usage in each hour, in kWh-t.
TabOrder
3
3
Numeric

1
17
Name
5
14
thermal_peak_1
X
3
246
Y
3
219
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
Numeric

1
17
Name
5
15
thermal_peak_10
X
3
246
Y
3
435
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
Numeric

1
17
Name
5
15
thermal_peak_11
X
3
246
Y
3
459
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
Numeric

1
17
Name
5
15
thermal_peak_12
X
3
246
Y
3
483
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
Numeric

1
17
Name
5
14
thermal_peak_2
X
3
246
Y
3
243
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
Numeric

1
17
Name
5
14
thermal_peak_3
X
3
246
Y
3
267
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
Numeric

1
17
Name
5
14
thermal_peak_4
X
3
246
Y
3
291
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
Numeric

1
17
Name
5
14
thermal_peak_5
X
3
246
Y
3
315
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
Numeric

1
17
Name
5
14
thermal_peak_6
X
3
246
Y
3
339
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
Numeric

1
17
Name
5
14
thermal_peak_7
X
3
246
Y
3
363
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
Numeric

1
17
Name
5
14
thermal_peak_8
X
3
246
Y
3
387
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
Numeric

1
17
Name
5
14
thermal_peak_9
X
3
246
Y
3
411
Width
3
79
Height
3
21
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
0
Decimals
3
2
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
0
Numeric

1
17
Name
5
20
thermal_scale_factor
X
3
234
Y
3
75
Width
3
118
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
0
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4
Button

1
8
Name
5
27
visualize_thermal_load_data
X
3
303
Y
3
123
Width
3
224
Height
3
24
Tool Tip
5
0
Caption
5
17
View load data...
TabOrder
3
0

32
normalize_to_thermal_bill
3
1
 
 
Thermal Load
0
0
1
1
1
1
0
Default
thermal_1
3
1
 
 
Thermal Load
0
8
1
1
1
1
0
Default
thermal_10
3
1
 
 
Thermal Load
0
8
1
1
1
1
0
Default
thermal_11
3
1
 
 
Thermal Load
0
8
1
1
1
1
0
Default
thermal_12
3
1
 
 
Thermal Load
0
8
1
1
1
1
0
Default
thermal_2
3
1
 
 
Thermal Load
0
8
1
1
1
1
0
Default
thermal_3
3
1
 
 
Thermal Load
0
8
1
1
1
1
0
Default
thermal_4
3
1
 
 
Thermal Load
0
8
1
1
1
1
0
Default
thermal_5
3
1
 
 
Thermal Load
0
8
1
1
1
1
0
Default
thermal_6
3
1
 
 
Thermal Load
0
8
1
1
1
1
0
Default
thermal_7
3
1
 
 
Thermal Load
0
8
1
1
1
1
0
Default
thermal_8
3
1
 
 
Thermal Load
0
8
1
1
1
1
0
Default
thermal_9
3
1
 
 
Thermal Load
0
8
1
1
1
1
0
Default
thermal_annual_peak
3
1
Annual Peak
kW-t
Thermal Load
0
9
1
1
1
1
0
Default
thermal_bill_data
3
2
Monthly heat usage
kWh-t
Thermal Load
0
0
1
2
1
12
300 300 300 300 300 400 500 500 400 300 300 300 

Default
thermal_load
3
2
Thermal load power
kW-t
Thermal Load
0
8
1
2
1
1
0
Default
thermal_load_annual_total
3
1
Annual thermal load
kWh-t
Thermal Load
0
9
1
1
1
1
0
Default
thermal_load_escalation
3
2
Load growth rate
%/yr
Thermal Load
0
2
1
2
1
1
0
Default
thermal_load_user_data
3
2
Heat usage
kW-t
Thermal Load
21
Thermal load (kW-t)|1
0
1
2
1
1
0
DataArray
thermal_peak_1
3
1
 
 
Thermal Load
0
8
1
1
1
1
0
Default
thermal_peak_10
3
1
 
 
Thermal Load
0
8
1
1
1
1
0
Default
thermal_peak_11
3
1
 
 
Thermal Load
0
8
1
1
1
1
0
Default
thermal_peak_12
3
1
 
 
Thermal Load
0
8
1
1
1
1
0
Default
thermal_peak_2
3
1
 
 
Thermal Load
0
8
1
1
1
1
0
Default
thermal_peak_3
3
1
 
 
Thermal Load
0
8
1
1
1
1
0
Default
thermal_peak_4
3
1
 
 
Thermal Load
0
8
1
1
1
1
0
Default
thermal_peak_5
3
1
 
 
Thermal Load
0
8
1
1
1
1
0
Default
thermal_peak_6
3
1
 
 
Thermal Load
0
8
1
1
1
1
0
Default
thermal_peak_7
3
1
 
 
Thermal Load
0
8
1
1
1
1
0
Default
thermal_peak_8
3
1
 
 
Thermal Load
0
8
1
1
1
1
0
Default
thermal_peak_9
3
1
 
 
Thermal Load
0
8
1
1
1
1
0
Default
thermal_scale_factor
3
1
Scaling factor (optional)
 
Thermal Load
0
2
1
1
1
1
1
Default

2793
equations{ '$MIMO$ thermalload' } = define() {

	const nday = [31,28,31,30,31,30,31,31,30,31,30,31];
	const calc_monthly = define( load, mload, mpeak )	{
		// load is in kW-t
		// mload is kWh-t
		// mpeak is kW-t

		nsub = #load/8760; // number of subhourly steps per hour
		tshr = 1.0/nsub; // timestep in hours
		
		//CALCULATE MONTHLY SUMS AND PEAKS
		c=0;
		for (m=0;m<12;m++)
		{
			mpeak[m]=0.0;
			mload[m]=0.0;
			for (d=0;d<nday[m];d++)
			{
				for (h=0;h<24;h++)
				{
					for (jj=0;jj<nsub;jj++ )
					{
						mload[m] += load[c] * tshr;
						
						if (load[c] > mpeak[m])
							mpeak[m] = load[c];
							
						c++;
					}
				}			
			}
		}
	};
	
	// arrays for monthly load (kWh) and peak (kW)
	mload = alloc(12);
	mpeak = alloc(12);
	
	// READ IN USER SUPPLIED DATA (8760 or multiple of 8760)
	load = ${thermal_load_user_data};
	len = #load;
	nsub = len/8760;
	tshr = 1.0/nsub; // timestep in hours
	
	if(mod(len, 8760) != 0)
	{
		msgbox("Hourly thermal load data must be a multiple of 8760. Current length = %d\n", len);
		return false;
	}
		
	//APPLY MONTHLY LOAD SCALING- WILL OVERWRITE SCALING FACTOR	
	if ( ${normalize_to_thermal_bill} )
	{
		// determine monthly load
		calc_monthly( load, mload, mpeak );
		
		scale = alloc(12);
		ubd = ${thermal_bill_data};
		//compute the scaling factor necessary for each month
		for (m=0; m<12; m++)
			if (mload[m] > 0) //error checking
				scale[m] = ubd[m] / mload[m];
		
			
		// apply monthly scaling factors
		c=0;
		for (m=0;m<12;m++)
		{
			for (d=0;d<nday[m];d++)
			{
				for (h=0;h<24;h++)
				{
					for( jj=0;jj<nsub;jj++ )
					{
						load[c] *= scale[m];
						c++;
					}
				}
			}
		}		
	}
	else
	{
		// scale load profile with value provided by user
		scale = ${thermal_scale_factor};
		for (i=0;i<len;i++)
			load[i] *= scale;
	}
	
	
	// determine monthly loads and peaks from
	// preprocessed load array (load)
	calc_monthly( load, mload, mpeak );		

	// save outputs to variables in UI
	${thermal_1} = mload[0];
	${thermal_peak_1} = mpeak[0];
	${thermal_2} = mload[1];
	${thermal_peak_2} = mpeak[1];
	${thermal_3} = mload[2];
	${thermal_peak_3} = mpeak[2];
	${thermal_4} = mload[3];
	${thermal_peak_4} = mpeak[3];
	${thermal_5} = mload[4];
	${thermal_peak_5} = mpeak[4];
	${thermal_6} = mload[5];
	${thermal_peak_6} = mpeak[5];
	${thermal_7} = mload[6];
	${thermal_peak_7} = mpeak[6];
	${thermal_8} = mload[7];
	${thermal_peak_8} = mpeak[7];
	${thermal_9} = mload[8];
	${thermal_peak_9} = mpeak[8];
	${thermal_10} = mload[9];
	${thermal_peak_10} = mpeak[9];
	${thermal_11} = mload[10];
	${thermal_peak_11} = mpeak[10];
	${thermal_12} = mload[11];
	${thermal_peak_12} = mpeak[11];
	${thermal_load} = load;
	${thermal_load_annual_total} = sum(load)*tshr;
	${thermal_annual_peak} = max(load);

	return 0;
};
762

on_load{'Thermal Load'} = define() {
	on_change{'normalize_to_thermal_bill'}();
};

on_change{'normalize_to_thermal_bill'} = define() {
	norm = ${normalize_to_thermal_bill};
	enable( 'thermal_bill_data', norm );
	enable( 'thermal_scale_factor', !norm);
};

on_change{'visualize_thermal_load_data'} = define() {
	sc = ${thermal_scale_factor};
	norm = ${normalize_to_thermal_bill};
	
	L = ${thermal_load};
	ts = 1.0/(#L / 8760); // timestep in hours
	if ( sc == 1.0 && !norm )
	{
		dview( 1, ts, "Thermal Load", 
			"Thermal load power", "kW-t", 1.0, ${thermal_load});
	}
	else
	{
		dview( 2, ts, "Thermal Load",
		"User-entered thermal load power", "kW-t", 1.0, ${thermal_load_user_data},
		"Scaled thermal load power", "kW-t", 1.0, ${thermal_load} );
			
	}
};
