# ARCH argument like arm64, armv7, armv7s, x86_64

VPATH = ../shared

# OS building
MYARCH=darwin-x86_64

# Default NDK installation location for Android Studio 2.3
NDK = /Users/imacuser/Library/Android/sdk/ndk-bundle



# based on Android-23 for Samsung Galaxy 5
PLATFORMVER=android-13
TOOLCHAINPREFIX=x86_64
GCCPREFIX=arm-linux-androideabi
TOOLCHAINPREFIX=x86_64
GCCPREFIX=x86_64-linux-android
GCCVER=4.9
ARCHPREFIX=arch-arm
ARCHPREFIX=arch-x86
#ARCH=armeabi-v7a

CC=${NDK}/toolchains/${TOOLCHAINPREFIX}-${GCCVER}/prebuilt/${MYARCH}/bin/${GCCPREFIX}-gcc
CXX=${NDK}/toolchains/${TOOLCHAINPREFIX}-${GCCVER}/prebuilt/${MYARCH}/bin/${GCCPREFIX}-g++
RANLIB=${NDK}/toolchains/${TOOLCHAINPREFIX}-${GCCVER}/prebuilt/${MYARCH}/bin/${GCCPREFIX}-ranlib
AR=${NDK}/toolchains/${TOOLCHAINPREFIX}-${GCCVER}/prebuilt/${MYARCH}/bin/${GCCPREFIX}-ar


CFLAGS = --sysroot=/Users/imacuser/Library/Android/sdk/ndk-bundle/platforms/android-13/arch-arm -fPIC -g -DANDROID -ffunction-sections -funwind-tables -fstack-protector-strong -no-canonical-prefixes -march=armv7-a -mfloat-abi=softfp -mfpu=vfpv3-d16 -mthumb -Wa,--noexecstack -Wformat -Werror=format-security   -std=gnu++11 -O0 -O0  -Wl,--build-id -Wl,--warn-shared-textrel -Wl,--fatal-warnings -Wl,--fix-cortex-a8 -Wl,--no-undefined -Wl,-z,noexecstack -Wl,-z,relro -Wl,-z,now -Wl,--build-id -Wl,--warn-shared-textrel -Wl,--fatal-warnings -Wl,--fix-cortex-a8 -Wl,--no-undefined -Wl,-z,noexecstack -Wl,-z,relro -Wl,-z,now -isystem${NDK}/platforms/${PLATFORMVER}/arch-arm/usr/include -isystem${NDK}/sources/cxx-stl/gnu-libstdc++/${GCCVER}/include -isystem${NDK}/sources/cxx-stl/gnu-libstdc++/${GCCVER}/libs/${ARCH}/include


CFLAGS = --sysroot=${NDK}/platforms/${PLATFORMVER}/${ARCHPREFIX} -fPIC -g -DANDROID -ffunction-sections -funwind-tables -fstack-protector-strong -no-canonical-prefixes -Wa,--noexecstack -Wformat -Werror=format-security   -std=gnu++11 -O0 -O0  -Wl,--build-id -Wl,--warn-shared-textrel -Wl,--fatal-warnings -Wl,--fix-cortex-a8 -Wl,--no-undefined -Wl,-z,noexecstack -Wl,-z,relro -Wl,-z,now -Wl,--build-id -Wl,--warn-shared-textrel -Wl,--fatal-warnings -Wl,--fix-cortex-a8 -Wl,--no-undefined -Wl,-z,noexecstack -Wl,-z,relro -Wl,-z,now -isystem${NDK}/platforms/${PLATFORMVER}/${ARCHPREFIX}/usr/include -isystem${NDK}/sources/cxx-stl/gnu-libstdc++/${GCCVER}/include -isystem${NDK}/sources/cxx-stl/gnu-libstdc++/${GCCVER}/libs/${ARCH}/include


CXXFLAGS = $(CFLAGS) -std=gnu++11 



OBJECTS = \
	lsqfit.o \
	lib_snowmodel.o \
	lib_iec61853.o \
	lib_cec6par.o \
	lib_financial.o \
	lib_geothermal.o \
	lib_irradproc.o \
	lib_physics.o \
	lib_powerblock.o \
	lib_power_electronics.o \
	lib_pvinv.o \
	lib_pvmodel.o \
	lib_pvshade.o \
	lib_pvwatts.o \
	lib_sandia.o \
	lib_util.o \
	lib_weatherfile.o \
	lib_windfile.o \
	lib_wind_obos.o \
	lib_windwatts.o \
	lib_battery.o \
	lib_battery_dispatch.o \
	lib_miniz.o \
	lib_pv_shade_loss_mpp.o


TARGET=shared_${ARCH}.a

$(TARGET):$(OBJECTS)
	$(AR) rs $(TARGET) $(OBJECTS)

clean:
	rm -rf $(TARGET) $(OBJECTS)

